<!doctype html>
<html lang="vi">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GameShop - Mua BÃ¡n TÃ i Khoáº£n Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .bounce {
            animation: bounce 0.6s ease-in-out;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-full"><!-- Navigation -->
  <nav class="bg-black/20 backdrop-blur-md border-b border-white/10 sticky top-0 z-50">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
     <div class="flex items-center space-x-8">
      <div class="text-2xl font-bold text-white">
       ğŸ® GameShop
      </div>
      <div class="hidden md:flex space-x-6"><button onclick="showPage('home')" class="text-white hover:text-blue-300 transition-colors">Trang chá»§</button> <button onclick="showPage('categories')" class="text-white hover:text-blue-300 transition-colors">Danh má»¥c</button> <button onclick="showPage('sell')" class="text-white hover:text-blue-300 transition-colors">ÄÄƒng bÃ¡n</button>
      </div>
     </div>
     <div class="flex items-center space-x-4">
      <div id="userInfo" class="hidden items-center space-x-4"><span id="userBalance" class="text-yellow-300 font-semibold"></span> <button onclick="showPage('cart')" class="relative text-white hover:text-blue-300"> ğŸ›’ <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-xs rounded-full px-1">0</span> </button> <button onclick="showPage('messages')" class="relative text-white hover:text-blue-300"> ğŸ’¬ <span id="messageCount" class="absolute -top-2 -right-2 bg-red-500 text-xs rounded-full px-1 hidden">0</span> </button> <button onclick="showPage('profile')" class="text-white hover:text-blue-300">ğŸ‘¤ TÃ i khoáº£n</button> <button id="adminBtn" onclick="showPage('admin')" class="hidden text-yellow-300 hover:text-yellow-100">ğŸ‘‘ Quáº£n trá»‹</button> <button onclick="logout()" class="text-red-300 hover:text-red-100">ÄÄƒng xuáº¥t</button>
      </div>
      <div id="authButtons" class="flex space-x-2"><button onclick="showPage('login')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">ÄÄƒng nháº­p</button> <button onclick="showPage('register')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">ÄÄƒng kÃ½</button>
      </div>
     </div>
    </div>
   </div>
  </nav><!-- Main Content -->
  <div id="mainContent" class="max-w-7xl mx-auto px-4 py-8"><!-- Home Page -->
   <div id="homePage" class="page"><!-- Banner -->
    <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl p-8 mb-8 text-white">
     <h1 class="text-4xl font-bold mb-4">ChÃ o má»«ng Ä‘áº¿n GameShop! ğŸ®</h1>
     <p class="text-xl mb-6">NÆ¡i mua bÃ¡n tÃ i khoáº£n game uy tÃ­n #1 Viá»‡t Nam</p><button onclick="showPage('categories')" class="bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors"> KhÃ¡m phÃ¡ ngay </button>
    </div><!-- Featured Products -->
    <div class="mb-8">
     <h2 class="text-2xl font-bold text-white mb-6">ğŸ”¥ Sáº£n pháº©m ná»•i báº­t</h2>
     <div id="featuredProducts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><!-- Products will be loaded here -->
     </div>
    </div><!-- Game Categories -->
    <div>
     <h2 class="text-2xl font-bold text-white mb-6">ğŸ¯ Danh má»¥c game</h2>
     <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="filterByGame('LiÃªn QuÃ¢n')">
       <div class="text-4xl mb-2">
        âš”ï¸
       </div>
       <div class="text-white font-semibold">
        LiÃªn QuÃ¢n
       </div>
       <div class="text-gray-300 text-sm" id="lienquan-count">
        0 tÃ i khoáº£n
       </div>
      </div>
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="filterByGame('PUBG')">
       <div class="text-4xl mb-2">
        ğŸ”«
       </div>
       <div class="text-white font-semibold">
        PUBG
       </div>
       <div class="text-gray-300 text-sm" id="pubg-count">
        0 tÃ i khoáº£n
       </div>
      </div>
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="filterByGame('Free Fire')">
       <div class="text-4xl mb-2">
        ğŸ”¥
       </div>
       <div class="text-white font-semibold">
        Free Fire
       </div>
       <div class="text-gray-300 text-sm" id="freefire-count">
        0 tÃ i khoáº£n
       </div>
      </div>
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="filterByGame('Genshin')">
       <div class="text-4xl mb-2">
        âœ¨
       </div>
       <div class="text-white font-semibold">
        Genshin
       </div>
       <div class="text-gray-300 text-sm" id="genshin-count">
        0 tÃ i khoáº£n
       </div>
      </div>
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="filterByGame('Minecraft')">
       <div class="text-4xl mb-2">
        ğŸ§±
       </div>
       <div class="text-white font-semibold">
        Minecraft
       </div>
       <div class="text-gray-300 text-sm" id="minecraft-count">
        0 tÃ i khoáº£n
       </div>
      </div>
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="filterByGame('Roblox')">
       <div class="text-4xl mb-2">
        ğŸ²
       </div>
       <div class="text-white font-semibold">
        Roblox
       </div>
       <div class="text-gray-300 text-sm" id="roblox-count">
        0 tÃ i khoáº£n
       </div>
      </div>
     </div>
    </div>
   </div><!-- Login Page -->
   <div id="loginPage" class="page hidden">
    <div class="max-w-md mx-auto bg-white/10 backdrop-blur-md rounded-2xl p-8">
     <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ” ÄÄƒng nháº­p</h2>
     <form id="loginForm" onsubmit="handleLogin(event)">
      <div class="mb-4"><label class="block text-white mb-2">Email</label> <input type="email" id="loginEmail" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div>
      <div class="mb-6"><label class="block text-white mb-2">Máº­t kháº©u</label> <input type="password" id="loginPassword" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors"> ÄÄƒng nháº­p </button>
     </form>
     <div class="mt-4 text-center space-y-2"><button onclick="showPage('register')" class="block text-blue-300 hover:text-blue-100">ChÆ°a cÃ³ tÃ i khoáº£n? ÄÄƒng kÃ½ ngay</button> <button onclick="showPage('forgot')" class="block text-yellow-300 hover:text-yellow-100">ğŸ”‘ QuÃªn máº­t kháº©u?</button>
     </div>
    </div>
   </div><!-- Forgot Password Page -->
   <div id="forgotPage" class="page hidden">
    <div class="max-w-md mx-auto bg-white/10 backdrop-blur-md rounded-2xl p-8">
     <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ”‘ QuÃªn máº­t kháº©u</h2><!-- Step 1: Enter Email -->
     <div id="forgotStep1">
      <p class="text-gray-300 text-center mb-6">Nháº­p email Ä‘Ã£ Ä‘Äƒng kÃ½ Ä‘á»ƒ láº¥y láº¡i máº­t kháº©u</p>
      <form id="forgotEmailForm" onsubmit="handleForgotPassword(event)">
       <div class="mb-6"><label class="block text-white mb-2">Email Ä‘Ã£ Ä‘Äƒng kÃ½</label> <input type="email" id="forgotEmail" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Nháº­p email cá»§a báº¡n...">
       </div><button type="submit" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white py-3 rounded-lg font-semibold transition-colors"> ğŸ” TÃ¬m tÃ i khoáº£n </button>
      </form>
     </div><!-- Step 2: OTP Verification -->
     <div id="forgotStep2" class="hidden">
      <div class="bg-green-500/20 border border-green-500/50 rounded-lg p-4 mb-4">
       <p class="text-green-200 text-center">âœ… TÃ¬m tháº¥y tÃ i khoáº£n!</p>
       <p class="text-green-300 text-center text-sm mt-1">MÃ£ OTP Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n</p>
      </div>
      <div class="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4 mb-4">
       <p class="text-yellow-200 text-center">MÃ£ OTP cá»§a báº¡n: <span id="forgotOtpCode" class="font-bold text-yellow-100"></span></p>
       <p class="text-yellow-300 text-center text-sm">Thá»i gian cÃ²n láº¡i: <span id="forgotOtpTimer" class="font-bold">60</span>s</p>
      </div>
      <form id="forgotOtpForm" onsubmit="verifyForgotOTP(event)">
       <div class="mb-4"><label class="block text-white mb-2">Nháº­p mÃ£ OTP</label> <input type="text" id="forgotOtpInput" required maxlength="6" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none text-center text-2xl tracking-widest" placeholder="000000">
       </div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors"> âœ… XÃ¡c thá»±c OTP </button>
      </form>
     </div><!-- Step 3: Reset Password -->
     <div id="forgotStep3" class="hidden">
      <div class="bg-green-500/20 border border-green-500/50 rounded-lg p-4 mb-4">
       <p class="text-green-200 text-center">ğŸ‰ XÃ¡c thá»±c thÃ nh cÃ´ng!</p>
       <p class="text-green-300 text-center text-sm mt-1">BÃ¢y giá» báº¡n cÃ³ thá»ƒ Ä‘áº·t máº­t kháº©u má»›i</p>
      </div>
      <form id="resetPasswordForm" onsubmit="handleResetPassword(event)">
       <div class="mb-4"><label class="block text-white mb-2">Máº­t kháº©u má»›i</label> <input type="password" id="newPasswordReset" required minlength="6" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Nháº­p máº­t kháº©u má»›i...">
       </div>
       <div class="mb-6"><label class="block text-white mb-2">XÃ¡c nháº­n máº­t kháº©u má»›i</label> <input type="password" id="confirmPasswordReset" required minlength="6" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Nháº­p láº¡i máº­t kháº©u má»›i...">
       </div><button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors"> ğŸ”’ Äáº·t láº¡i máº­t kháº©u </button>
      </form>
     </div>
     <div class="mt-4 text-center"><button onclick="showPage('login')" class="text-blue-300 hover:text-blue-100">â† Quay láº¡i Ä‘Äƒng nháº­p</button>
     </div>
    </div>
   </div><!-- Register Page -->
   <div id="registerPage" class="page hidden">
    <div class="max-w-md mx-auto bg-white/10 backdrop-blur-md rounded-2xl p-8">
     <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ“ ÄÄƒng kÃ½</h2>
     <form id="registerForm" onsubmit="handleRegister(event)">
      <div class="mb-4"><label class="block text-white mb-2">Há» tÃªn</label> <input type="text" id="registerName" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div>
      <div class="mb-4"><label class="block text-white mb-2">Email</label> <input type="email" id="registerEmail" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div>
      <div class="mb-4"><label class="block text-white mb-2">Máº­t kháº©u</label> <input type="password" id="registerPassword" required minlength="8" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Tá»‘i thiá»ƒu 8 kÃ½ tá»±...">
       <div class="mt-2 text-sm">
        <div class="text-gray-300 mb-1">
         Máº­t kháº©u pháº£i cÃ³:
        </div>
        <div id="passwordRequirements" class="space-y-1 text-xs">
         <div id="req-length" class="text-red-400">
          â€¢ Ãt nháº¥t 8 kÃ½ tá»±
         </div>
         <div id="req-uppercase" class="text-red-400">
          â€¢ Ãt nháº¥t 1 chá»¯ hoa (A-Z)
         </div>
         <div id="req-number" class="text-red-400">
          â€¢ Ãt nháº¥t 1 sá»‘ (0-9)
         </div>
         <div id="req-special" class="text-red-400">
          â€¢ Ãt nháº¥t 1 kÃ½ tá»± Ä‘áº·c biá»‡t (!@#$%^&amp;*)
         </div>
        </div>
       </div>
      </div>
      <div class="mb-6"><label class="block text-white mb-2">XÃ¡c nháº­n máº­t kháº©u</label> <input type="password" id="confirmPassword" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div><button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors"> ÄÄƒng kÃ½ </button>
     </form>
     <div id="otpSection" class="hidden mt-6">
      <div class="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4 mb-4">
       <p class="text-yellow-200 text-center"> <span id="otpCode" class="font-bold text-yellow-100"></span></p>
       <p class="text-yellow-300 text-center text-sm">Thá»i gian cÃ²n láº¡i: <span id="otpTimer" class="font-bold">60</span>s</p>
      </div><input type="text" id="otpInput" placeholder="Nháº­p mÃ£ OTP" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none mb-4"> <button onclick="verifyOTP()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors"> XÃ¡c thá»±c OTP </button>
     </div>
    </div>
   </div><!-- Categories Page -->
   <div id="categoriesPage" class="page hidden">
    <div class="mb-6">
     <h2 class="text-3xl font-bold text-white mb-4">ğŸ® Danh má»¥c sáº£n pháº©m</h2>
     <div class="flex flex-wrap gap-2 mb-6"><button onclick="filterProducts('all')" class="filter-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Táº¥t cáº£</button> <button onclick="filterProducts('LiÃªn QuÃ¢n')" class="filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">LiÃªn QuÃ¢n</button> <button onclick="filterProducts('PUBG')" class="filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">PUBG</button> <button onclick="filterProducts('Free Fire')" class="filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Free Fire</button> <button onclick="filterProducts('Genshin')" class="filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Genshin</button>
     </div>
    </div>
    <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"><!-- Products will be loaded here -->
    </div>
   </div><!-- Sell Page -->
   <div id="sellPage" class="page hidden">
    <div class="max-w-2xl mx-auto bg-white/10 backdrop-blur-md rounded-2xl p-8">
     <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ’° ÄÄƒng bÃ¡n tÃ i khoáº£n</h2>
     <form id="sellForm" onsubmit="handleSellAccount(event)">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
       <div><label class="block text-white mb-2">TÃªn game</label> <select id="sellGame" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none"> <option value="">Chá»n game</option> <option value="LiÃªn QuÃ¢n">LiÃªn QuÃ¢n Mobile</option> <option value="PUBG">PUBG Mobile</option> <option value="Free Fire">Free Fire</option> <option value="Genshin">Genshin Impact</option> <option value="Minecraft">Minecraft</option> <option value="Roblox">Roblox</option> </select>
       </div>
       <div><label class="block text-white mb-2">GiÃ¡ bÃ¡n (VNÄ)</label> <input type="number" id="sellPrice" required min="1000" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
       </div>
      </div>
      <div class="mt-6"><label class="block text-white mb-2">MÃ´ táº£ tÃ i khoáº£n</label> <textarea id="sellDescription" required rows="4" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="MÃ´ táº£ chi tiáº¿t vá» tÃ i khoáº£n..."></textarea>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
       <div><label class="block text-white mb-2">TÃ i khoáº£n</label> <input type="text" id="sellUsername" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
       </div>
       <div><label class="block text-white mb-2">Máº­t kháº©u</label> <input type="password" id="sellPassword" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
       </div>
      </div>
      <div class="mt-6"><label class="block text-white mb-2">HÃ¬nh áº£nh tÃ i khoáº£n</label> <input type="file" id="sellImage" accept="image/*" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
      </div><button type="submit" class="w-full mt-6 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors"> ÄÄƒng bÃ¡n tÃ i khoáº£n </button>
     </form>
    </div>
   </div><!-- Cart Page -->
   <div id="cartPage" class="page hidden">
    <div class="max-w-4xl mx-auto">
     <h2 class="text-3xl font-bold text-white mb-6">ğŸ›’ Giá» hÃ ng cá»§a báº¡n</h2>
     <div id="cartItems" class="space-y-4 mb-6"><!-- Cart items will be loaded here -->
     </div>
     <div class="bg-white/10 backdrop-blur-md rounded-xl p-6">
      <div class="flex justify-between items-center text-white text-xl font-bold mb-4"><span>Tá»•ng cá»™ng:</span> <span id="cartTotal">0 VNÄ</span>
      </div><button onclick="checkout()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors"> Thanh toÃ¡n </button>
     </div>
    </div>
   </div><!-- Messages Page -->
   <div id="messagesPage" class="page hidden">
    <div class="max-w-4xl mx-auto">
     <h2 class="text-3xl font-bold text-white mb-6">ğŸ’¬ Tin nháº¯n</h2>
     <div class="bg-white/10 backdrop-blur-md rounded-xl p-6 h-[600px] flex flex-col"><!-- Chat Header -->
      <div class="border-b border-white/20 pb-4 mb-4">
       <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center">
         ğŸ‘‘
        </div>
        <div>
         <div class="text-white font-semibold">
          Há»— trá»£ khÃ¡ch hÃ ng
         </div>
         <div class="text-green-400 text-sm">
          â— Äang hoáº¡t Ä‘á»™ng
         </div>
        </div>
       </div>
      </div><!-- Messages Container -->
      <div id="messagesContainer" class="flex-1 overflow-y-auto space-y-4 mb-4 pr-2">
       <div class="flex items-start space-x-3">
        <div class="w-8 h-8 bg-yellow-600 rounded-full flex items-center justify-center text-sm">
         ğŸ‘‘
        </div>
        <div class="bg-white/20 rounded-lg p-3 max-w-xs">
         <div class="text-white text-sm">
          Xin chÃ o! TÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?
         </div>
         <div class="text-gray-400 text-xs mt-1">
          HÃ´m nay
         </div>
        </div>
       </div>
      </div><!-- Message Input -->
      <form id="messageForm" onsubmit="sendMessage(event)" class="flex space-x-3"><input type="text" id="messageInput" placeholder="Nháº­p tin nháº¯n..." required class="flex-1 px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none"> <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> Gá»­i </button>
      </form>
     </div>
    </div>
   </div><!-- Profile Page -->
   <div id="profilePage" class="page hidden">
    <div class="max-w-4xl mx-auto">
     <h2 class="text-3xl font-bold text-white mb-6">ğŸ‘¤ TÃ i khoáº£n cá»§a tÃ´i</h2>
     <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="bg-white/10 backdrop-blur-md rounded-xl p-6">
       <h3 class="text-xl font-bold text-white mb-4">ThÃ´ng tin cÃ¡ nhÃ¢n</h3>
       <div id="userProfileInfo" class="space-y-3 text-white"><!-- User info will be loaded here -->
       </div><button onclick="showRechargeForm()" class="w-full mt-4 bg-yellow-600 hover:bg-yellow-700 text-white py-2 rounded-lg font-semibold transition-colors"> ğŸ’° Náº¡p tiá»n </button> <button onclick="showChangePasswordForm()" class="w-full mt-2 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-semibold transition-colors"> ğŸ”’ Äá»•i máº­t kháº©u </button>
      </div>
      <div class="lg:col-span-2">
       <div class="bg-white/10 backdrop-blur-md rounded-xl p-6 mb-6">
        <h3 class="text-xl font-bold text-white mb-4">ğŸ“‹ Lá»‹ch sá»­ mua hÃ ng</h3>
        <div id="purchaseHistory" class="space-y-3"><!-- Purchase history will be loaded here -->
        </div>
       </div>
       <div class="bg-white/10 backdrop-blur-md rounded-xl p-6">
        <h3 class="text-xl font-bold text-white mb-4">ğŸ® TÃ i khoáº£n Ä‘ang bÃ¡n</h3>
        <div id="sellingAccounts" class="space-y-3"><!-- Selling accounts will be loaded here -->
        </div>
       </div>
      </div>
     </div>
     <div id="adminVietqr" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">ğŸ¦ Quáº£n lÃ½ VietQR</h3><!-- VietQR Overview -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
       <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrTotalTransactions">
         0
        </div>
        <div class="text-green-100 text-sm">
         Tá»•ng giao dá»‹ch
        </div>
       </div>
       <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrTotalAmount">
         0 VNÄ
        </div>
        <div class="text-blue-100 text-sm">
         Tá»•ng sá»‘ tiá»n
        </div>
       </div>
       <div class="bg-gradient-to-r from-yellow-600 to-orange-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrPendingCount">
         0
        </div>
        <div class="text-yellow-100 text-sm">
         Äang chá»
        </div>
       </div>
       <div class="bg-gradient-to-r from-red-600 to-pink-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrTodayCount">
         0
        </div>
        <div class="text-red-100 text-sm">
         HÃ´m nay
        </div>
       </div>
      </div><!-- VietQR Filters -->
      <div class="flex flex-wrap gap-2 mb-6"><button onclick="filterVietQRTransactions('all')" class="vietqr-filter-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Táº¥t cáº£</button> <button onclick="filterVietQRTransactions('pending')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Äang chá»</button> <button onclick="filterVietQRTransactions('completed')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ThÃ nh cÃ´ng</button> <button onclick="filterVietQRTransactions('expired')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Háº¿t háº¡n</button> <button onclick="filterVietQRTransactions('large')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Giao dá»‹ch lá»›n (â‰¥5M)</button>
      </div><!-- VietQR Transactions List -->
      <div id="vietqrTransactionsList" class="space-y-3"><!-- VietQR transactions will be loaded here -->
      </div><!-- VietQR Settings -->
      <div class="mt-8 bg-white/5 rounded-lg p-6">
       <h4 class="text-lg font-bold text-white mb-4">âš™ï¸ CÃ i Ä‘áº·t VietQR</h4>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-4">
         <div><label class="block text-white mb-2">ğŸ¦ TÃ i khoáº£n nháº­n tiá»n</label> <input type="text" value="1038189785" readonly class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/30">
          <div class="text-gray-400 text-sm mt-1">
           Vietcombank - GAMESHOP VIETNAM
          </div>
         </div>
         <div><label class="block text-white mb-2">â° Thá»i gian háº¿t háº¡n QR (phÃºt)</label> <input type="number" value="15" min="5" max="60" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
         </div>
        </div>
        <div class="space-y-4">
         <div><label class="block text-white mb-2">ğŸš¨ NgÆ°á»¡ng cáº£nh bÃ¡o giao dá»‹ch lá»›n (VNÄ)</label> <input type="number" value="5000000" min="1000000" step="1000000" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
         </div>
         <div><label class="block text-white mb-2">ğŸ”„ Giá»›i háº¡n táº¡o QR (láº§n/phÃºt/user)</label> <input type="number" value="5" min="1" max="20" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
         </div>
        </div>
       </div>
       <div class="mt-6 flex justify-center"><button onclick="saveVietQRSettings()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> ğŸ’¾ LÆ°u cÃ i Ä‘áº·t </button>
       </div>
      </div>
     </div>
     <div id="adminSecurity" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-2xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">ğŸ›¡ï¸ Quáº£n lÃ½ báº£o máº­t</h3><!-- Security Overview -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
       <div class="bg-gradient-to-r from-red-600 to-red-700 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="blockedIPCount">
         0
        </div>
        <div class="text-red-100 text-sm">
         IP bá»‹ cháº·n
        </div>
       </div>
       <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="securityAlertCountDisplay">
         0
        </div>
        <div class="text-yellow-100 text-sm">
         Cáº£nh bÃ¡o chÆ°a xá»­ lÃ½
        </div>
       </div>
       <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="totalFailedAttempts">
         0
        </div>
        <div class="text-blue-100 text-sm">
         Láº§n thá»­ tháº¥t báº¡i hÃ´m nay
        </div>
       </div>
      </div><!-- Security Tabs -->
      <div class="flex flex-wrap gap-2 mb-6"><button onclick="showSecurityTab('alerts')" class="security-tab-btn bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">ğŸš¨ Cáº£nh bÃ¡o</button> <button onclick="showSecurityTab('blocked')" class="security-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ”’ IP bá»‹ cháº·n</button> <button onclick="showSecurityTab('logs')" class="security-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ“‹ Nháº­t kÃ½</button> <button onclick="showSecurityTab('settings')" class="security-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">âš™ï¸ CÃ i Ä‘áº·t</button>
      </div><!-- Security Alerts Tab -->
      <div id="securityAlertsTab" class="security-tab">
       <h4 class="text-lg font-bold text-white mb-4">ğŸš¨ Cáº£nh bÃ¡o báº£o máº­t</h4>
       <div id="securityAlertsList" class="space-y-3"><!-- Security alerts will be loaded here -->
       </div>
      </div><!-- Blocked IPs Tab -->
      <div id="securityBlockedTab" class="security-tab hidden">
       <h4 class="text-lg font-bold text-white mb-4">ğŸ”’ Danh sÃ¡ch IP bá»‹ cháº·n</h4>
       <div id="blockedIPsList" class="space-y-3"><!-- Blocked IPs will be loaded here -->
       </div>
      </div><!-- Security Logs Tab -->
      <div id="securityLogsTab" class="security-tab hidden">
       <h4 class="text-lg font-bold text-white mb-4">ğŸ“‹ Nháº­t kÃ½ báº£o máº­t</h4>
       <div class="mb-4 flex flex-wrap gap-2"><button onclick="filterSecurityLogs('all')" class="log-filter-btn bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">Táº¥t cáº£</button> <button onclick="filterSecurityLogs('login')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">ÄÄƒng nháº­p</button> <button onclick="filterSecurityLogs('failed_login')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">Tháº¥t báº¡i</button> <button onclick="filterSecurityLogs('ip_blocked')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">Cháº·n IP</button> <button onclick="filterSecurityLogs('purchase')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">Mua hÃ ng</button>
       </div>
       <div id="securityLogsList" class="space-y-3 max-h-[500px] overflow-y-auto"><!-- Security logs will be loaded here -->
       </div>
      </div><!-- Security Settings Tab -->
      <div id="securitySettingsTab" class="security-tab hidden">
       <h4 class="text-lg font-bold text-white mb-6">âš™ï¸ CÃ i Ä‘áº·t báº£o máº­t</h4><!-- Current Settings -->
       <div class="bg-white/5 rounded-lg p-6 mb-6">
        <h5 class="text-white font-semibold mb-4">ğŸ“Š Cáº¥u hÃ¬nh hiá»‡n táº¡i</h5>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
         <div class="bg-white/5 rounded-lg p-3">
          <div class="text-gray-300">
           Sá»‘ láº§n thá»­ tá»‘i Ä‘a:
          </div>
          <div class="text-white font-bold text-lg">
           ${THROTTLE_CONFIG.maxAttempts} láº§n
          </div>
         </div>
         <div class="bg-white/5 rounded-lg p-3">
          <div class="text-gray-300">
           Khung thá»i gian:
          </div>
          <div class="text-white font-bold text-lg">
           ${THROTTLE_CONFIG.timeWindow / 60000} phÃºt
          </div>
         </div>
         <div class="bg-white/5 rounded-lg p-3">
          <div class="text-gray-300">
           Thá»i gian cháº·n:
          </div>
          <div class="text-white font-bold text-lg">
           ${THROTTLE_CONFIG.blockDuration / 60000} phÃºt
          </div>
         </div>
        </div>
       </div><!-- Slack Integration Status -->
       <div class="bg-white/5 rounded-lg p-6 mb-6">
        <h5 class="text-white font-semibold mb-4">ğŸ“± TÃ­ch há»£p Slack</h5>
        <div class="flex items-center space-x-3">
         <div class="w-3 h-3 bg-green-500 rounded-full"></div>
         <div class="text-green-300">
          Äang hoáº¡t Ä‘á»™ng - Gá»­i cáº£nh bÃ¡o tá»± Ä‘á»™ng
         </div>
        </div>
        <div class="text-gray-400 text-sm mt-2">
         KÃªnh: #security-alerts | Webhook: ÄÃ£ cáº¥u hÃ¬nh
        </div>
       </div><!-- Manual IP Block -->
       <div class="bg-white/5 rounded-lg p-6">
        <h5 class="text-white font-semibold mb-4">ğŸš« Cháº·n IP thá»§ cÃ´ng</h5>
        <form onsubmit="manualBlockIP(event)" class="space-y-4">
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label class="block text-white mb-2">IP Address</label> <input type="text" id="manualBlockIPInput" required placeholder="192.168.1.100" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
          </div>
          <div><label class="block text-white mb-2">LÃ½ do cháº·n</label> <input type="text" id="manualBlockReason" required placeholder="Hoáº¡t Ä‘á»™ng Ä‘Ã¡ng ngá»" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
          </div>
         </div><button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> ğŸš« Cháº·n IP </button>
        </form>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Admin Page -->
   <div id="adminPage" class="page hidden">
    <div class="max-w-6xl mx-auto">
     <h2 class="text-3xl font-bold text-white mb-6">ğŸ‘‘ Quáº£n trá»‹ viÃªn</h2>
     <div class="flex flex-wrap gap-2 mb-6"><button onclick="showAdminTab('users')" class="admin-tab-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">ğŸ‘¥ NgÆ°á»i dÃ¹ng</button> <button onclick="showAdminTab('recharges')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ’µ Náº¡p tiá»n</button> <button onclick="showAdminTab('products')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ® Chá» duyá»‡t</button> <button onclick="showAdminTab('approved')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">âœ… ÄÃ£ duyá»‡t</button> <button onclick="showAdminTab('quicksell')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">âš¡ ÄÄƒng bÃ¡n nhanh</button> <button onclick="showAdminTab('messages')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors relative"> ğŸ’¬ Tin nháº¯n <span id="adminMessageCount" class="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full px-1 hidden">0</span> </button> <button onclick="showAdminTab('withdraw')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ¦ RÃºt tiá»n</button> <button onclick="showAdminTab('jiro')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ” File Jiro</button> <button onclick="showAdminTab('vietqr')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ¦ VietQR</button> <button onclick="showAdminTab('security')" class="admin-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors relative"> ğŸ›¡ï¸ Báº£o máº­t <span id="securityAlertCount" class="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full px-1 hidden">0</span> </button>
     </div>
     <div id="adminUsers" class="admin-tab bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">Danh sÃ¡ch ngÆ°á»i dÃ¹ng</h3>
      <div id="usersList" class="space-y-3"><!-- Users list will be loaded here -->
      </div>
     </div>
     <div id="adminRecharges" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">YÃªu cáº§u náº¡p tiá»n</h3>
      <div id="rechargesList" class="space-y-3"><!-- Recharges list will be loaded here -->
      </div>
     </div>
     <div id="adminProducts" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">ğŸ® Sáº£n pháº©m chá» duyá»‡t</h3>
      <div id="productsList" class="space-y-3"><!-- Products list will be loaded here -->
      </div>
     </div>
     <div id="adminApproved" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">âœ… Sáº£n pháº©m Ä‘Ã£ duyá»‡t</h3>
      <div class="mb-4 flex flex-wrap gap-2"><button onclick="filterApprovedProducts('all')" class="approved-filter-btn bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">Táº¥t cáº£</button> <button onclick="filterApprovedProducts('available')" class="approved-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">Äang bÃ¡n</button> <button onclick="filterApprovedProducts('sold')" class="approved-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">ÄÃ£ bÃ¡n</button>
      </div>
      <div id="approvedProductsList" class="space-y-3"><!-- Approved products list will be loaded here -->
      </div>
     </div>
     <div id="adminMessages" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">ğŸ’¬ Quáº£n lÃ½ tin nháº¯n</h3>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]"><!-- Users List -->
       <div class="bg-white/5 rounded-lg p-4">
        <h4 class="text-white font-semibold mb-4">ğŸ‘¥ Danh sÃ¡ch ngÆ°á»i dÃ¹ng</h4>
        <div id="chatUsersList" class="space-y-2 overflow-y-auto h-[500px]"><!-- Users will be loaded here -->
        </div>
       </div><!-- Chat Area -->
       <div class="lg:col-span-2 bg-white/5 rounded-lg p-4 flex flex-col">
        <div id="adminChatHeader" class="border-b border-white/20 pb-3 mb-4 hidden">
         <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center">
           ğŸ‘¤
          </div>
          <div>
           <div id="selectedUserName" class="text-white font-semibold"></div>
           <div id="selectedUserEmail" class="text-gray-400 text-sm"></div>
          </div>
         </div>
        </div>
        <div id="adminChatPlaceholder" class="flex-1 flex items-center justify-center text-gray-400">
         Chá»n má»™t ngÆ°á»i dÃ¹ng Ä‘á»ƒ báº¯t Ä‘áº§u trÃ² chuyá»‡n
        </div>
        <div id="adminMessagesContainer" class="flex-1 overflow-y-auto space-y-3 mb-4 hidden"><!-- Messages will be loaded here -->
        </div>
        <form id="adminMessageForm" onsubmit="sendAdminMessage(event)" class="hidden">
         <div class="flex space-x-3"><input type="text" id="adminMessageInput" placeholder="Nháº­p tin nháº¯n..." required class="flex-1 px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none"> <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> Gá»­i </button>
         </div>
        </form>
       </div>
      </div>
     </div>
     <div id="adminQuicksell" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">âš¡ ÄÄƒng bÃ¡n nhanh</h3>
      <form id="adminSellForm" onsubmit="handleAdminSell(event)" class="max-w-4xl">
       <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><!-- Left Column -->
        <div class="space-y-4">
         <div><label class="block text-white mb-2 font-semibold">ğŸ® TÃªn game</label> <select id="adminSellGame" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none"> <option value="">Chá»n game</option> <option value="LiÃªn QuÃ¢n">âš”ï¸ LiÃªn QuÃ¢n Mobile</option> <option value="PUBG">ğŸ”« PUBG Mobile</option> <option value="Free Fire">ğŸ”¥ Free Fire</option> <option value="Genshin">âœ¨ Genshin Impact</option> <option value="Minecraft">ğŸ§± Minecraft</option> <option value="Roblox">ğŸ² Roblox</option> </select>
         </div>
         <div><label class="block text-white mb-2 font-semibold">ğŸ’° GiÃ¡ bÃ¡n (VNÄ)</label> <input type="number" id="adminSellPrice" required min="1000" step="1000" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Nháº­p giÃ¡ bÃ¡n...">
         </div>
         <div><label class="block text-white mb-2 font-semibold">ğŸ“ MÃ´ táº£ tÃ i khoáº£n</label> <textarea id="adminSellDescription" required rows="4" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="MÃ´ táº£ chi tiáº¿t vá» tÃ i khoáº£n (rank, skin, váº­t pháº©m...)"></textarea>
         </div>
         <div><label class="block text-white mb-2 font-semibold">ğŸ–¼ï¸ HÃ¬nh áº£nh tÃ i khoáº£n</label> <input type="file" id="adminSellImage" accept="image/*" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-600 file:text-white file:cursor-pointer hover:file:bg-blue-700">
          <p class="text-gray-400 text-sm mt-1">Chá»n hÃ¬nh áº£nh minh há»a cho tÃ i khoáº£n</p>
         </div>
        </div><!-- Right Column -->
        <div class="space-y-4">
         <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-4">
          <h4 class="text-yellow-300 font-semibold mb-2">ğŸ” ThÃ´ng tin Ä‘Äƒng nháº­p</h4>
          <p class="text-yellow-200 text-sm">ThÃ´ng tin nÃ y sáº½ Ä‘Æ°á»£c mÃ£ hÃ³a vÃ  chá»‰ hiá»ƒn thá»‹ cho ngÆ°á»i mua</p>
         </div>
         <div><label class="block text-white mb-2 font-semibold">ğŸ‘¤ TÃ i khoáº£n</label> <input type="text" id="adminSellUsername" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Username/Email Ä‘Äƒng nháº­p">
         </div>
         <div><label class="block text-white mb-2 font-semibold">ğŸ”’ Máº­t kháº©u</label> <input type="password" id="adminSellPassword" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Máº­t kháº©u Ä‘Äƒng nháº­p">
         </div>
         <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
          <h4 class="text-green-300 font-semibold mb-2">âš¡ ÄÄƒng bÃ¡n nhanh</h4>
          <p class="text-green-200 text-sm mb-3">Sáº£n pháº©m sáº½ Ä‘Æ°á»£c Ä‘Äƒng bÃ¡n ngay láº­p tá»©c mÃ  khÃ´ng cáº§n chá» duyá»‡t</p>
          <ul class="text-green-200 text-sm space-y-1">
           <li>âœ… Hiá»ƒn thá»‹ ngay trÃªn trang chá»§</li>
           <li>âœ… Xuáº¥t hiá»‡n trong danh má»¥c sáº£n pháº©m</li>
           <li>âœ… CÃ³ thá»ƒ mua ngay láº­p tá»©c</li>
          </ul>
         </div>
        </div>
       </div>
       <div class="mt-8 flex justify-center"><button type="submit" class="bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg"> âš¡ ÄÄƒng bÃ¡n ngay láº­p tá»©c </button>
       </div>
      </form>
     </div>
     <div id="adminJiro" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">ğŸ” Quáº£n lÃ½ File Jiro.txt</h3><!-- File Info -->
      <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-xl p-6 mb-6">
       <div class="text-center">
        <div class="text-white text-lg mb-2">
         ğŸ“ ThÃ´ng tin file jiro.txt
        </div>
        <div id="jiroFileStats" class="text-white text-sm">
         <div>
          Tá»•ng sá»‘ tÃ i khoáº£n: <span id="jiroAccountCount" class="font-bold">0</span>
         </div>
         <div>
          Cáº­p nháº­t láº§n cuá»‘i: <span id="jiroLastUpdate" class="font-bold">ChÆ°a cÃ³ dá»¯ liá»‡u</span>
         </div>
        </div>
       </div>
      </div><!-- Action Buttons -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><button onclick="viewJiroFile()" class="bg-blue-600 hover:bg-blue-700 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg"> ğŸ‘ï¸ Xem ná»™i dung file </button> <button onclick="downloadJiroFile()" class="bg-green-600 hover:bg-green-700 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg"> ğŸ“¥ Táº£i xuá»‘ng file </button> <button onclick="clearJiroFile()" class="bg-red-600 hover:bg-red-700 text-white py-4 px-6 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg"> ğŸ—‘ï¸ XÃ³a toÃ n bá»™ </button>
      </div><!-- File Description -->
      <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-6">
       <div class="flex items-start space-x-3">
        <div class="text-yellow-400 text-2xl">
         â„¹ï¸
        </div>
        <div>
         <div class="text-yellow-300 font-semibold mb-3">
          Vá» file jiro.txt:
         </div>
         <ul class="text-yellow-200 text-sm space-y-2">
          <li>â€¢ <strong>Má»¥c Ä‘Ã­ch:</strong> LÆ°u trá»¯ máº­t kháº©u bÄƒm SHA256 cá»§a táº¥t cáº£ tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½</li>
          <li>â€¢ <strong>Báº£o máº­t:</strong> Máº­t kháº©u Ä‘Æ°á»£c bÄƒm khÃ´ng thá»ƒ Ä‘áº£o ngÆ°á»£c, Ä‘áº£m báº£o an toÃ n tuyá»‡t Ä‘á»‘i</li>
          <li>â€¢ <strong>Tá»± Ä‘á»™ng:</strong> Má»—i khi cÃ³ tÃ i khoáº£n má»›i Ä‘Äƒng kÃ½, máº­t kháº©u sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c lÆ°u vÃ o file</li>
          <li>â€¢ <strong>Äá»‹nh dáº¡ng:</strong> Email, Hash SHA256, thá»i gian táº¡o, nguá»“n dá»¯ liá»‡u</li>
          <li>â€¢ <strong>Quyá»n truy cáº­p:</strong> Chá»‰ admin má»›i cÃ³ thá»ƒ xem vÃ  táº£i file nÃ y</li>
         </ul>
        </div>
       </div>
      </div><!-- Recent Entries -->
      <div class="mt-6">
       <h4 class="text-lg font-bold text-white mb-4">ğŸ“‹ CÃ¡c má»¥c gáº§n Ä‘Ã¢y</h4>
       <div id="recentJiroEntries" class="space-y-3"><!-- Recent entries will be loaded here -->
       </div>
      </div>
     </div>
     <div id="adminWithdraw" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">ğŸ¦ RÃºt tiá»n vá» ngÃ¢n hÃ ng</h3><!-- Admin Balance Display -->
      <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-xl p-6 mb-6">
       <div class="text-center">
        <div class="text-white text-lg mb-2">
         ğŸ’° Sá»‘ dÆ° hiá»‡n táº¡i
        </div>
        <div id="adminCurrentBalance" class="text-white text-3xl font-bold mb-2">
         0 VNÄ
        </div>
        <div class="text-green-200 text-sm">
         CÃ³ thá»ƒ rÃºt toÃ n bá»™ sá»‘ dÆ°
        </div>
       </div>
      </div><!-- Withdrawal Form -->
      <form id="withdrawForm" onsubmit="handleWithdraw(event)" class="max-w-2xl mx-auto">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div><label class="block text-white mb-2 font-semibold">ğŸ’µ Sá»‘ tiá»n rÃºt (VNÄ)</label> <input type="number" id="withdrawAmount" required min="50000" step="1000" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Nháº­p sá»‘ tiá»n muá»‘n rÃºt...">
         <p class="text-gray-400 text-sm mt-1">Tá»‘i thiá»ƒu: 50,000 VNÄ</p>
        </div>
        <div><label class="block text-white mb-2 font-semibold">ğŸ¦ NgÃ¢n hÃ ng</label> <select id="withdrawBank" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none"> <option value="">Chá»n ngÃ¢n hÃ ng</option> <option value="vietcombank">Vietcombank</option> <option value="techcombank">Techcombank</option> <option value="bidv">BIDV</option> <option value="vietinbank">VietinBank</option> <option value="agribank">Agribank</option> <option value="mbbank">MB Bank</option> <option value="acb">ACB</option> <option value="tpbank">TPBank</option> <option value="sacombank">Sacombank</option> <option value="vpbank">VPBank</option> </select>
        </div>
       </div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div><label class="block text-white mb-2 font-semibold">ğŸ”¢ Sá»‘ tÃ i khoáº£n</label> <input type="text" id="withdrawAccountNumber" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Nháº­p sá»‘ tÃ i khoáº£n...">
        </div>
        <div><label class="block text-white mb-2 font-semibold">ğŸ‘¤ TÃªn chá»§ tÃ i khoáº£n</label> <input type="text" id="withdrawAccountName" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="TÃªn chá»§ tÃ i khoáº£n...">
        </div>
       </div>
       <div class="mb-6"><label class="block text-white mb-2 font-semibold">ğŸ“ Ghi chÃº (tÃ¹y chá»n)</label> <textarea id="withdrawNote" rows="3" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Ghi chÃº thÃªm vá» giao dá»‹ch..."></textarea>
       </div><!-- Quick Amount Buttons -->
       <div class="mb-6">
        <div class="text-white mb-3 font-semibold">
         âš¡ Chá»n nhanh:
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3"><button type="button" onclick="setWithdrawAmount(1000000)" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm transition-colors"> 1,000,000 VNÄ </button> <button type="button" onclick="setWithdrawAmount(5000000)" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm transition-colors"> 5,000,000 VNÄ </button> <button type="button" onclick="setWithdrawAmount(10000000)" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm transition-colors"> 10,000,000 VNÄ </button> <button type="button" onclick="setWithdrawAllAmount()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg text-sm transition-colors"> RÃºt háº¿t </button>
        </div>
       </div><!-- Warning Notice -->
       <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-6">
        <div class="flex items-start space-x-3">
         <div class="text-yellow-400 text-xl">
          âš ï¸
         </div>
         <div>
          <div class="text-yellow-300 font-semibold mb-2">
           LÆ°u Ã½ quan trá»ng:
          </div>
          <ul class="text-yellow-200 text-sm space-y-1">
           <li>â€¢ Giao dá»‹ch rÃºt tiá»n sáº½ Ä‘Æ°á»£c xá»­ lÃ½ trong 1-3 ngÃ y lÃ m viá»‡c</li>
           <li>â€¢ Vui lÃ²ng kiá»ƒm tra ká»¹ thÃ´ng tin tÃ i khoáº£n ngÃ¢n hÃ ng</li>
           <li>â€¢ PhÃ­ rÃºt tiá»n: 0% (miá»…n phÃ­ hoÃ n toÃ n)</li>
           <li>â€¢ KhÃ´ng thá»ƒ há»§y giao dá»‹ch sau khi xÃ¡c nháº­n</li>
          </ul>
         </div>
        </div>
       </div>
       <div class="flex justify-center"><button type="submit" class="bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg"> ğŸ¦ Táº¡o lá»‡nh rÃºt tiá»n </button>
       </div>
      </form><!-- Withdrawal History -->
      <div class="mt-8">
       <h4 class="text-xl font-bold text-white mb-4">ğŸ“‹ Lá»‹ch sá»­ rÃºt tiá»n</h4>
       <div id="withdrawalHistory" class="space-y-3"><!-- Withdrawal history will be loaded here -->
       </div>
      </div>
     </div>
     <div id="adminVietqr" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">ğŸ¦ Quáº£n lÃ½ VietQR</h3><!-- VietQR Overview -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
       <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrTotalTransactions">
         0
        </div>
        <div class="text-green-100 text-sm">
         Tá»•ng giao dá»‹ch
        </div>
       </div>
       <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrTotalAmount">
         0 VNÄ
        </div>
        <div class="text-blue-100 text-sm">
         Tá»•ng sá»‘ tiá»n
        </div>
       </div>
       <div class="bg-gradient-to-r from-yellow-600 to-orange-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrPendingCount">
         0
        </div>
        <div class="text-yellow-100 text-sm">
         Äang chá»
        </div>
       </div>
       <div class="bg-gradient-to-r from-red-600 to-pink-600 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="vietqrTodayCount">
         0
        </div>
        <div class="text-red-100 text-sm">
         HÃ´m nay
        </div>
       </div>
      </div><!-- VietQR Filters -->
      <div class="flex flex-wrap gap-2 mb-6"><button onclick="filterVietQRTransactions('all')" class="vietqr-filter-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Táº¥t cáº£</button> <button onclick="filterVietQRTransactions('pending')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Äang chá»</button> <button onclick="filterVietQRTransactions('completed')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ThÃ nh cÃ´ng</button> <button onclick="filterVietQRTransactions('expired')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Háº¿t háº¡n</button> <button onclick="filterVietQRTransactions('large')" class="vietqr-filter-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">Giao dá»‹ch lá»›n (â‰¥5M)</button>
      </div><!-- VietQR Transactions List -->
      <div id="vietqrTransactionsList" class="space-y-3"><!-- VietQR transactions will be loaded here -->
      </div><!-- VietQR Settings -->
      <div class="mt-8 bg-white/5 rounded-lg p-6">
       <h4 class="text-lg font-bold text-white mb-4">âš™ï¸ CÃ i Ä‘áº·t VietQR</h4>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-4">
         <div><label class="block text-white mb-2">ğŸ¦ TÃ i khoáº£n nháº­n tiá»n</label> <input type="text" value="1038189785" readonly class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/30">
          <div class="text-gray-400 text-sm mt-1">
           Vietcombank - GAMESHOP VIETNAM
          </div>
         </div>
         <div><label class="block text-white mb-2">â° Thá»i gian háº¿t háº¡n QR (phÃºt)</label> <input type="number" value="15" min="5" max="60" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
         </div>
        </div>
        <div class="space-y-4">
         <div><label class="block text-white mb-2">ğŸš¨ NgÆ°á»¡ng cáº£nh bÃ¡o giao dá»‹ch lá»›n (VNÄ)</label> <input type="number" value="5000000" min="1000000" step="1000000" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
         </div>
         <div><label class="block text-white mb-2">ğŸ”„ Giá»›i háº¡n táº¡o QR (láº§n/phÃºt/user)</label> <input type="number" value="5" min="1" max="20" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none">
         </div>
        </div>
       </div>
       <div class="mt-6 flex justify-center"><button onclick="saveVietQRSettings()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> ğŸ’¾ LÆ°u cÃ i Ä‘áº·t </button>
       </div>
      </div>
     </div>
     <div id="adminSecurity" class="admin-tab hidden bg-white/10 backdrop-blur-md rounded-2xl p-6">
      <h3 class="text-xl font-bold text-white mb-6">ğŸ›¡ï¸ Quáº£n lÃ½ báº£o máº­t</h3><!-- Security Overview -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
       <div class="bg-gradient-to-r from-red-600 to-red-700 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="blockedIPCount">
         0
        </div>
        <div class="text-red-100 text-sm">
         IP bá»‹ cháº·n
        </div>
       </div>
       <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="securityAlertCountDisplay">
         0
        </div>
        <div class="text-yellow-100 text-sm">
         Cáº£nh bÃ¡o chÆ°a xá»­ lÃ½
        </div>
       </div>
       <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-4 text-center">
        <div class="text-white text-2xl font-bold" id="totalFailedAttempts">
         0
        </div>
        <div class="text-blue-100 text-sm">
         Láº§n thá»­ tháº¥t báº¡i hÃ´m nay
        </div>
       </div>
      </div><!-- Security Tabs -->
      <div class="flex flex-wrap gap-2 mb-6"><button onclick="showSecurityTab('alerts')" class="security-tab-btn bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">ğŸš¨ Cáº£nh bÃ¡o</button> <button onclick="showSecurityTab('blocked')" class="security-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ”’ IP bá»‹ cháº·n</button> <button onclick="showSecurityTab('logs')" class="security-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">ğŸ“‹ Nháº­t kÃ½</button> <button onclick="showSecurityTab('settings')" class="security-tab-btn bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-colors">âš™ï¸ CÃ i Ä‘áº·t</button>
      </div><!-- Security Alerts Tab -->
      <div id="securityAlertsTab" class="security-tab">
       <h4 class="text-lg font-bold text-white mb-4">ğŸš¨ Cáº£nh bÃ¡o báº£o máº­t</h4>
       <div id="securityAlertsList" class="space-y-3"><!-- Security alerts will be loaded here -->
       </div>
      </div><!-- Blocked IPs Tab -->
      <div id="securityBlockedTab" class="security-tab hidden">
       <h4 class="text-lg font-bold text-white mb-4">ğŸ”’ Danh sÃ¡ch IP bá»‹ cháº·n</h4>
       <div id="blockedIPsList" class="space-y-3"><!-- Blocked IPs will be loaded here -->
       </div>
      </div><!-- Security Logs Tab -->
      <div id="securityLogsTab" class="security-tab hidden">
       <h4 class="text-lg font-bold text-white mb-4">ğŸ“‹ Nháº­t kÃ½ báº£o máº­t</h4>
       <div class="mb-4 flex flex-wrap gap-2"><button onclick="filterSecurityLogs('all')" class="log-filter-btn bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">Táº¥t cáº£</button> <button onclick="filterSecurityLogs('login')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">ÄÄƒng nháº­p</button> <button onclick="filterSecurityLogs('failed_login')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">Tháº¥t báº¡i</button> <button onclick="filterSecurityLogs('ip_blocked')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">Cháº·n IP</button> <button onclick="filterSecurityLogs('purchase')" class="log-filter-btn bg-white/20 text-white px-3 py-1 rounded text-sm hover:bg-white/30 transition-colors">Mua hÃ ng</button>
       </div>
       <div id="securityLogsList" class="space-y-3 max-h-[500px] overflow-y-auto"><!-- Security logs will be loaded here -->
       </div>
      </div><!-- Security Settings Tab -->
      <div id="securitySettingsTab" class="security-tab hidden">
       <h4 class="text-lg font-bold text-white mb-6">âš™ï¸ CÃ i Ä‘áº·t báº£o máº­t</h4><!-- Current Settings -->
       <div class="bg-white/5 rounded-lg p-6 mb-6">
        <h5 class="text-white font-semibold mb-4">ğŸ“Š Cáº¥u hÃ¬nh hiá»‡n táº¡i</h5>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
         <div class="bg-white/5 rounded-lg p-3">
          <div class="text-gray-300">
           Sá»‘ láº§n thá»­ tá»‘i Ä‘a:
          </div>
          <div class="text-white font-bold text-lg">
           ${THROTTLE_CONFIG.maxAttempts} láº§n
          </div>
         </div>
         <div class="bg-white/5 rounded-lg p-3">
          <div class="text-gray-300">
           Khung thá»i gian:
          </div>
          <div class="text-white font-bold text-lg">
           ${THROTTLE_CONFIG.timeWindow / 60000} phÃºt
          </div>
         </div>
         <div class="bg-white/5 rounded-lg p-3">
          <div class="text-gray-300">
           Thá»i gian cháº·n:
          </div>
          <div class="text-white font-bold text-lg">
           ${THROTTLE_CONFIG.blockDuration / 60000} phÃºt
          </div>
         </div>
        </div>
       </div><!-- Slack Integration Status -->
       <div class="bg-white/5 rounded-lg p-6 mb-6">
        <h5 class="text-white font-semibold mb-4">ğŸ“± TÃ­ch há»£p Slack</h5>
        <div class="flex items-center space-x-3">
         <div class="w-3 h-3 bg-green-500 rounded-full"></div>
         <div class="text-green-300">
          Äang hoáº¡t Ä‘á»™ng - Gá»­i cáº£nh bÃ¡o tá»± Ä‘á»™ng
         </div>
        </div>
        <div class="text-gray-400 text-sm mt-2">
         KÃªnh: #security-alerts | Webhook: ÄÃ£ cáº¥u hÃ¬nh
        </div>
       </div><!-- Manual IP Block -->
       <div class="bg-white/5 rounded-lg p-6">
        <h5 class="text-white font-semibold mb-4">ğŸš« Cháº·n IP thá»§ cÃ´ng</h5>
        <form onsubmit="manualBlockIP(event)" class="space-y-4">
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label class="block text-white mb-2">IP Address</label> <input type="text" id="manualBlockIPInput" required placeholder="192.168.1.100" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
          </div>
          <div><label class="block text-white mb-2">LÃ½ do cháº·n</label> <input type="text" id="manualBlockReason" required placeholder="Hoáº¡t Ä‘á»™ng Ä‘Ã¡ng ngá»" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
          </div>
         </div><button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> ğŸš« Cháº·n IP </button>
        </form>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Recharge Modal -->
   <div id="rechargeModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
     <h3 class="text-2xl font-bold text-white mb-6 text-center">ğŸ’° Náº¡p tiá»n</h3>
     <form id="rechargeForm" onsubmit="handleRecharge(event)">
      <div class="mb-4"><label class="block text-white mb-2">Sá»‘ tiá»n (VNÄ)</label> <select id="rechargeAmount" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none"> <option value="">Chá»n má»‡nh giÃ¡</option> <option value="50000">50,000 VNÄ</option> <option value="100000">100,000 VNÄ</option> <option value="200000">200,000 VNÄ</option> <option value="500000">500,000 VNÄ</option> <option value="1000000">1,000,000 VNÄ</option> </select>
      </div>
      <div class="mb-4"><label class="block text-white mb-2">PhÆ°Æ¡ng thá»©c</label> <select id="rechargeMethod" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-blue-400 focus:outline-none"> <option value="">Chá»n phÆ°Æ¡ng thá»©c</option> <option value="vietqr">ğŸ¦ VietQR - QuÃ©t mÃ£ QR (Tá»± Ä‘á»™ng)</option> <option value="momo">VÃ­ MoMo</option> <option value="bank">Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng</option> <option value="card">Tháº» game</option> </select>
      </div>
      <div class="mb-6"><label class="block text-white mb-2">Ghi chÃº</label> <textarea id="rechargeNote" rows="3" class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none" placeholder="Ghi chÃº thÃªm (tÃ¹y chá»n)"></textarea>
      </div>
      <div class="flex space-x-3"><button type="button" onclick="hideRechargeForm()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors"> Há»§y </button> <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors"> Gá»­i yÃªu cáº§u </button>
      </div>
     </form>
    </div>
   </div><!-- Change Password Modal -->
   <div id="changePasswordModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
     <h3 class="text-2xl font-bold text-white mb-6 text-center">ğŸ”’ Äá»•i máº­t kháº©u</h3>
     <form id="changePasswordForm" onsubmit="handleChangePassword(event)">
      <div class="mb-4"><label class="block text-white mb-2">Máº­t kháº©u cÅ©</label> <input type="password" id="oldPassword" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div>
      <div class="mb-4"><label class="block text-white mb-2">Máº­t kháº©u má»›i</label> <input type="password" id="newPassword" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div>
      <div class="mb-6"><label class="block text-white mb-2">XÃ¡c nháº­n máº­t kháº©u má»›i</label> <input type="password" id="confirmNewPassword" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
      </div>
      <div class="flex space-x-3"><button type="button" onclick="hideChangePasswordForm()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors"> Há»§y </button> <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors"> Äá»•i máº­t kháº©u </button>
      </div>
     </form>
    </div>
   </div><!-- VietQR Payment Modal -->
   <div id="vietqrModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-lg w-full mx-4">
     <div class="text-center mb-6">
      <h3 class="text-2xl font-bold text-white mb-2">ğŸ¦ Thanh toÃ¡n VietQR</h3>
      <div class="text-gray-300">
       QuÃ©t mÃ£ QR Ä‘á»ƒ náº¡p tiá»n tá»± Ä‘á»™ng
      </div>
     </div><!-- Payment Info -->
     <div class="bg-gradient-to-r from-blue-600 to-green-600 rounded-xl p-4 mb-6">
      <div class="text-center text-white">
       <div class="text-lg font-bold mb-1">
        Sá»‘ tiá»n náº¡p
       </div>
       <div id="vietqrAmount" class="text-3xl font-bold text-yellow-300">
        0 VNÄ
       </div>
       <div class="text-sm mt-1">
        MÃ£ giao dá»‹ch: <span id="vietqrOrderId" class="font-mono">NAP000000</span>
       </div>
      </div>
     </div><!-- QR Code -->
     <div class="bg-white rounded-xl p-6 mb-6 text-center">
      <div id="vietqrCode" class="flex items-center justify-center min-h-[200px]">
       <div class="text-gray-500">
        Äang táº¡o mÃ£ QR...
       </div>
      </div>
     </div><!-- Bank Info -->
     <div class="bg-white/5 rounded-lg p-4 mb-6">
      <div class="text-white text-sm space-y-2">
       <div class="flex justify-between"><span class="text-gray-300">NgÃ¢n hÃ ng:</span> <span class="font-semibold">Vietcombank</span>
       </div>
       <div class="flex justify-between"><span class="text-gray-300">Sá»‘ tÃ i khoáº£n:</span> <span class="font-mono">1038189785</span>
       </div>
       <div class="flex justify-between"><span class="text-gray-300">Chá»§ tÃ i khoáº£n:</span> <span>GAMESHOP VIETNAM</span>
       </div>
       <div class="flex justify-between"><span class="text-gray-300">Ná»™i dung:</span> <span id="vietqrContent" class="font-mono text-yellow-300">NAP000000</span>
       </div>
      </div>
     </div><!-- Timer -->
     <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-6">
      <div class="flex items-center justify-center space-x-3">
       <div class="text-yellow-300">
        â°
       </div>
       <div class="text-yellow-200"><span>MÃ£ QR cÃ³ hiá»‡u lá»±c trong: </span> <span id="vietqrTimer" class="font-bold text-yellow-100">15:00</span>
       </div>
      </div>
     </div><!-- Status -->
     <div id="vietqrStatus" class="text-center mb-6">
      <div class="text-blue-300 animate-pulse">
       ğŸ”„ Äang chá» thanh toÃ¡n...
      </div>
      <div class="text-gray-400 text-sm mt-2">
       QuÃ©t mÃ£ QR báº±ng app ngÃ¢n hÃ ng Ä‘á»ƒ thanh toÃ¡n
      </div>
     </div><!-- Actions -->
     <div class="flex space-x-3"><button onclick="refreshVietQR()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors"> ğŸ”„ LÃ m má»›i QR </button> <button onclick="hideVietQRModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors"> ÄÃ³ng </button>
     </div><!-- Instructions -->
     <div class="mt-6 text-center">
      <div class="text-gray-400 text-sm">
       <div class="mb-2">
        ğŸ“± HÆ°á»›ng dáº«n thanh toÃ¡n:
       </div>
       <div class="text-left space-y-1">
        <div>
         1. Má»Ÿ app ngÃ¢n hÃ ng trÃªn Ä‘iá»‡n thoáº¡i
        </div>
        <div>
         2. Chá»n "QuÃ©t mÃ£ QR" hoáº·c "Chuyá»ƒn tiá»n QR"
        </div>
        <div>
         3. QuÃ©t mÃ£ QR trÃªn mÃ n hÃ¬nh
        </div>
        <div>
         4. XÃ¡c nháº­n thÃ´ng tin vÃ  thanh toÃ¡n
        </div>
        <div>
         5. Sá»‘ dÆ° sáº½ Ä‘Æ°á»£c cáº­p nháº­t tá»± Ä‘á»™ng
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Footer -->
  <footer class="bg-black/30 backdrop-blur-md border-t border-white/10 mt-16">
   <div class="max-w-7xl mx-auto px-4 py-12">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
     <div>
      <h3 class="text-xl font-bold text-white mb-4">ğŸ® GameShop</h3>
      <p class="text-gray-300">Ná»n táº£ng mua bÃ¡n tÃ i khoáº£n game uy tÃ­n vÃ  an toÃ n nháº¥t Viá»‡t Nam.</p>
     </div>
     <div>
      <h4 class="font-semibold text-white mb-4">Dá»‹ch vá»¥</h4>
      <ul class="space-y-2 text-gray-300">
       <li><a href="#" class="hover:text-white transition-colors">Mua tÃ i khoáº£n</a></li>
       <li><a href="#" class="hover:text-white transition-colors">BÃ¡n tÃ i khoáº£n</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Náº¡p tiá»n</a></li>
       <li><a href="#" class="hover:text-white transition-colors">Há»— trá»£</a></li>
      </ul>
     </div>
     <div>
      <h4 class="font-semibold text-white mb-4">LiÃªn há»‡ NHOM05-BMTT</h4>
      <ul class="space-y-2 text-gray-300">
       <li>ğŸ“§ support@gameshop.vn</li>
       <li>ğŸ“ 0327499496</li>
       <li>ğŸ“ TP HCM, Viá»‡t Nam</li>
      </ul>
     </div>
     <div>
      <h4 class="font-semibold text-white mb-4">Máº¡ng xÃ£ há»™i</h4>
      <div class="flex space-x-4"><a href="#" class="text-2xl hover:text-blue-400 transition-colors">ğŸ“˜</a> <a href="#" class="text-2xl hover:text-pink-400 transition-colors">ğŸ“·</a> <a href="#" class="text-2xl hover:text-blue-300 transition-colors">ğŸ¦</a> <a href="#" class="text-2xl hover:text-red-400 transition-colors">ğŸ“º</a>
      </div>
     </div>
    </div>
    <div class="border-t border-white/10 mt-8 pt-8 text-center text-gray-300">
     <p>Â© 2025 GameShop. Táº¥t cáº£ quyá»n Ä‘Æ°á»£c báº£o lÆ°u.</p>
    </div>
   </div>
  </footer>
  <script>
        // Global variables
        let currentUser = null;
        let cart = [];
        let products = [];
        let users = [];
        let recharges = [];
        let messages = [];
        let withdrawals = [];
        let selectedChatUser = null;
        let otpCode = '';
        let otpTimer = null;
        let pendingUser = null;
        let forgotOtpCode = '';
        let forgotOtpTimer = null;
        let forgotPasswordUser = null;
        
        // VietQR variables
        let vietqrTimer = null;
        let vietqrCheckTimer = null;
        let currentVietQROrder = null;
        let vietqrRateLimit = JSON.parse(localStorage.getItem('vietqrRateLimit') || '{}');

        // IP Throttling System
        let ipThrottleData = JSON.parse(localStorage.getItem('gameShopIPThrottle') || '{}');
        let blockedIPs = JSON.parse(localStorage.getItem('gameShopBlockedIPs') || '{}');
        let securityAlerts = JSON.parse(localStorage.getItem('gameShopSecurityAlerts') || '[]');
        let blockCountdownTimer = null;
        
        // Throttling configuration
        const THROTTLE_CONFIG = {
            maxAttempts: 5,
            timeWindow: 10 * 60 * 1000, // 10 minutes
            blockDuration: 5 * 60 * 1000 // 5 minutes
        };

        // Password strength validation
        function validatePasswordStrength(password) {
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };
            
            const isValid = Object.values(requirements).every(req => req);
            
            let message = '';
            if (!requirements.length) message = 'Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±';
            else if (!requirements.uppercase) message = 'Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 1 chá»¯ hoa';
            else if (!requirements.number) message = 'Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 1 sá»‘';
            else if (!requirements.special) message = 'Máº­t kháº©u pháº£i cÃ³ Ã­t nháº¥t 1 kÃ½ tá»± Ä‘áº·c biá»‡t';
            
            return { isValid, requirements, message };
        }

        function updatePasswordRequirements(password) {
            const validation = validatePasswordStrength(password);
            
            // Update requirement indicators
            document.getElementById('req-length').className = validation.requirements.length ? 'text-green-400' : 'text-red-400';
            document.getElementById('req-uppercase').className = validation.requirements.uppercase ? 'text-green-400' : 'text-red-400';
            document.getElementById('req-number').className = validation.requirements.number ? 'text-green-400' : 'text-red-400';
            document.getElementById('req-special').className = validation.requirements.special ? 'text-green-400' : 'text-red-400';
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Add password strength checker
            const passwordInput = document.getElementById('registerPassword');
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    updatePasswordRequirements(this.value);
                });
            }
        });

        function initializeApp() {
            loadData();
            createDefaultAdmin();
            updateUI();
            loadFeaturedProducts();
            loadProducts();
        }

        function loadData() {
            // Load users
            const savedUsers = localStorage.getItem('gameShopUsers');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            }

            // Load products
            const savedProducts = localStorage.getItem('gameShopProducts');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
            } else {
                // Start with empty products array
                products = [];
                saveProducts();
            }

            // Load recharges
            const savedRecharges = localStorage.getItem('gameShopRecharges');
            if (savedRecharges) {
                recharges = JSON.parse(savedRecharges);
            }

            // Load current user
            const savedCurrentUser = localStorage.getItem('gameShopCurrentUser');
            if (savedCurrentUser) {
                currentUser = JSON.parse(savedCurrentUser);
            }

            // Load cart
            const savedCart = localStorage.getItem('gameShopCart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }

            // Load messages
            const savedMessages = localStorage.getItem('gameShopMessages');
            if (savedMessages) {
                messages = JSON.parse(savedMessages);
            }

            // Load withdrawals
            const savedWithdrawals = localStorage.getItem('gameShopWithdrawals');
            if (savedWithdrawals) {
                withdrawals = JSON.parse(savedWithdrawals);
            }
        }

        function createDefaultAdmin() {
            const adminExists = users.find(user => user.email === 'admin@gameshop.vn');
            if (!adminExists) {
                const adminUser = {
                    id: Date.now(),
                    name: 'Quáº£n trá»‹ viÃªn',
                    email: 'admin@gameshop.vn',
                    password: CryptoJS.SHA256('admin123').toString(),
                    role: 'admin',
                    balance: 0,
                    createdAt: new Date().toISOString()
                };
                users.push(adminUser);
                saveUsers();
            }
        }

        function saveUsers() {
            localStorage.setItem('gameShopUsers', JSON.stringify(users));
        }

        function saveProducts() {
            localStorage.setItem('gameShopProducts', JSON.stringify(products));
        }

        function saveRecharges() {
            localStorage.setItem('gameShopRecharges', JSON.stringify(recharges));
        }

        function saveCurrentUser() {
            localStorage.setItem('gameShopCurrentUser', JSON.stringify(currentUser));
        }

        function saveCart() {
            localStorage.setItem('gameShopCart', JSON.stringify(cart));
        }

        function saveMessages() {
            localStorage.setItem('gameShopMessages', JSON.stringify(messages));
        }

        function saveWithdrawals() {
            localStorage.setItem('gameShopWithdrawals', JSON.stringify(withdrawals));
        }

        // IP Throttling Functions
        function saveIPThrottleData() {
            localStorage.setItem('gameShopIPThrottle', JSON.stringify(ipThrottleData));
            localStorage.setItem('gameShopBlockedIPs', JSON.stringify(blockedIPs));
            localStorage.setItem('gameShopSecurityAlerts', JSON.stringify(securityAlerts));
        }

        function getCurrentIP() {
            // In a real application, this would be the actual client IP
            // For demo purposes, we'll use a simulated IP based on browser fingerprint
            return 'demo_' + (localStorage.getItem('demoIP') || generateDemoIP());
        }

        function generateDemoIP() {
            const ip = `192.168.1.${Math.floor(Math.random() * 254) + 1}`;
            localStorage.setItem('demoIP', ip);
            return ip;
        }

        function recordFailedLogin(email) {
            const ip = getCurrentIP();
            const now = Date.now();
            
            // Initialize IP data if not exists
            if (!ipThrottleData[ip]) {
                ipThrottleData[ip] = {
                    attempts: [],
                    totalAttempts: 0
                };
            }
            
            // Add current attempt
            ipThrottleData[ip].attempts.push(now);
            ipThrottleData[ip].totalAttempts++;
            
            // Clean old attempts (outside time window)
            ipThrottleData[ip].attempts = ipThrottleData[ip].attempts.filter(
                timestamp => (now - timestamp) <= THROTTLE_CONFIG.timeWindow
            );
            
            const recentAttempts = ipThrottleData[ip].attempts.length;
            
            // Check if should block IP
            if (recentAttempts >= THROTTLE_CONFIG.maxAttempts) {
                blockIP(ip, recentAttempts, email);
                return true; // IP is now blocked
            }
            
            saveIPThrottleData();
            return false; // IP not blocked yet
        }

        function blockIP(ip, attemptCount, lastAttemptedEmail) {
            const now = Date.now();
            
            // Block the IP
            blockedIPs[ip] = {
                blockedAt: now,
                reason: 'Too many failed login attempts',
                attemptCount: attemptCount,
                lastAttemptedEmail: lastAttemptedEmail,
                unblocked: false
            };
            
            // Create security alert
            const alert = {
                id: Date.now(),
                type: 'IP_BLOCKED',
                ip: ip,
                reason: `IP blocked due to ${attemptCount} failed login attempts in ${THROTTLE_CONFIG.timeWindow / 60000} minutes`,
                attemptCount: attemptCount,
                lastAttemptedEmail: lastAttemptedEmail,
                timestamp: new Date().toISOString(),
                acknowledged: false
            };
            
            securityAlerts.push(alert);
            
            // Log security event
            logSecurityEvent('ip_blocked', {
                ip: ip,
                attemptCount: attemptCount,
                lastAttemptedEmail: lastAttemptedEmail,
                blocked: true,
                timestamp: new Date().toISOString()
            });
            
            // Send Slack alert (simulated)
            sendSlackAlert(ip, attemptCount, lastAttemptedEmail);
            
            saveIPThrottleData();
            
            console.log(`ğŸš¨ SECURITY ALERT: IP ${ip} has been blocked due to ${attemptCount} failed login attempts`);
        }

        function isIPBlocked(ip) {
            if (!blockedIPs[ip] || blockedIPs[ip].unblocked) {
                return false;
            }
            
            const now = Date.now();
            const blockTime = blockedIPs[ip].blockedAt;
            const timeSinceBlock = now - blockTime;
            
            // Check if block has expired
            if (timeSinceBlock >= THROTTLE_CONFIG.blockDuration) {
                // Auto-unblock
                blockedIPs[ip].unblocked = true;
                blockedIPs[ip].autoUnblockedAt = now;
                saveIPThrottleData();
                
                logSecurityEvent('ip_unblocked', {
                    ip: ip,
                    reason: 'Auto-unblocked after timeout',
                    timestamp: new Date().toISOString()
                });
                
                return false;
            }
            
            return true;
        }

        function getIPStatus(ip) {
            if (!blockedIPs[ip] || blockedIPs[ip].unblocked) {
                return { blocked: false };
            }
            
            const now = Date.now();
            const blockTime = blockedIPs[ip].blockedAt;
            const timeSinceBlock = now - blockTime;
            const timeUntilUnblock = THROTTLE_CONFIG.blockDuration - timeSinceBlock;
            
            if (timeUntilUnblock <= 0) {
                return { blocked: false };
            }
            
            return {
                blocked: true,
                timeUntilUnblock: timeUntilUnblock,
                minutesLeft: Math.ceil(timeUntilUnblock / 60000)
            };
        }

        function unblockIP(ip) {
            if (blockedIPs[ip] && !blockedIPs[ip].unblocked) {
                blockedIPs[ip].unblocked = true;
                blockedIPs[ip].unblockedAt = Date.now();
                blockedIPs[ip].unblockedBy = currentUser ? currentUser.email : 'system';
                
                saveIPThrottleData();
                
                logSecurityEvent('ip_unblocked', {
                    ip: ip,
                    unblockedBy: currentUser ? currentUser.email : 'system',
                    timestamp: new Date().toISOString()
                });
                
                return true;
            }
            return false;
        }

        function cleanExpiredThrottleData() {
            const now = Date.now();
            
            // Clean old attempt records
            Object.keys(ipThrottleData).forEach(ip => {
                if (ipThrottleData[ip].attempts) {
                    ipThrottleData[ip].attempts = ipThrottleData[ip].attempts.filter(
                        timestamp => (now - timestamp) <= THROTTLE_CONFIG.timeWindow
                    );
                    
                    // Remove IP data if no recent attempts
                    if (ipThrottleData[ip].attempts.length === 0) {
                        delete ipThrottleData[ip];
                    }
                }
            });
            
            saveIPThrottleData();
        }

        function sendSlackAlert(ip, attemptCount, lastAttemptedEmail) {
            // Simulate Slack webhook call
            const slackMessage = {
                text: `ğŸš¨ SECURITY ALERT: IP blocked due to failed logins`,
                attachments: [{
                    color: 'danger',
                    fields: [
                        { title: 'IP Address', value: ip, short: true },
                        { title: 'Failed Attempts', value: attemptCount.toString(), short: true },
                        { title: 'Time Window', value: '10 minutes', short: true },
                        { title: 'Block Duration', value: '5 minutes', short: true },
                        { title: 'Last Email Attempted', value: lastAttemptedEmail || 'N/A', short: false },
                        { title: 'Timestamp', value: new Date().toLocaleString('vi-VN'), short: false }
                    ]
                }]
            };
            
            // In a real application, this would be an actual HTTP request to Slack
            console.log('ğŸ“± Slack Alert Sent:', slackMessage);
            
            // Show simulated Slack notification in UI
            showToast(`ğŸ“± Slack Alert: IP ${ip} blocked (${attemptCount} failed attempts)`, 'error');
        }

        function showIPBlockedWarning(ip, status) {
            // Hide login form
            document.getElementById('loginPage').innerHTML = `
                <div class="max-w-md mx-auto bg-red-900/20 backdrop-blur-md rounded-2xl p-8 border-2 border-red-500/50">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">ğŸš¨</div>
                        <h2 class="text-3xl font-bold text-red-300 mb-2">IP bá»‹ cháº·n táº¡m thá»i</h2>
                        <p class="text-red-200">QuÃ¡ nhiá»u láº§n Ä‘Äƒng nháº­p tháº¥t báº¡i</p>
                    </div>
                    
                    <div class="bg-red-800/30 border border-red-500/50 rounded-lg p-4 mb-6">
                        <div class="text-red-200 text-sm space-y-2">
                            <div><strong>IP cá»§a báº¡n:</strong> <span class="font-mono">${ip}</span></div>
                            <div><strong>LÃ½ do:</strong> ÄÄƒng nháº­p sai quÃ¡ ${THROTTLE_CONFIG.maxAttempts} láº§n trong ${THROTTLE_CONFIG.timeWindow / 60000} phÃºt</div>
                            <div><strong>Thá»i gian cháº·n:</strong> ${THROTTLE_CONFIG.blockDuration / 60000} phÃºt</div>
                        </div>
                    </div>
                    
                    <div class="text-center mb-6">
                        <div class="text-red-300 text-lg font-bold mb-2">Thá»i gian cÃ²n láº¡i:</div>
                        <div id="blockCountdown" class="text-4xl font-mono text-red-100 bg-red-800/50 rounded-lg py-4">
                            ${Math.ceil(status.timeUntilUnblock / 1000 / 60)}:00
                        </div>
                    </div>
                    
                    <div class="bg-yellow-800/30 border border-yellow-500/50 rounded-lg p-4 mb-6">
                        <div class="text-yellow-200 text-sm">
                            <div class="font-semibold mb-2">ğŸ’¡ Lá»i khuyÃªn:</div>
                            <ul class="space-y-1 text-xs">
                                <li>â€¢ Kiá»ƒm tra láº¡i email vÃ  máº­t kháº©u</li>
                                <li>â€¢ Sá»­ dá»¥ng tÃ­nh nÄƒng "QuÃªn máº­t kháº©u" náº¿u cáº§n</li>
                                <li>â€¢ Äá»£i háº¿t thá»i gian cháº·n Ä‘á»ƒ thá»­ láº¡i</li>
                                <li>â€¢ LiÃªn há»‡ há»— trá»£ náº¿u váº¥n Ä‘á» váº«n tiáº¿p diá»…n</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="showPage('home')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            ğŸ  Vá» trang chá»§
                        </button>
                        <button onclick="showPage('forgot')" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            ğŸ”‘ QuÃªn máº­t kháº©u
                        </button>
                    </div>
                </div>
            `;
            
            startBlockCountdown(status.timeUntilUnblock);
        }

        function startBlockCountdown(timeLeft) {
            const countdownElement = document.getElementById('blockCountdown');
            if (!countdownElement) return;
            
            // Clear existing timer
            if (blockCountdownTimer) {
                clearInterval(blockCountdownTimer);
            }
            
            blockCountdownTimer = setInterval(() => {
                timeLeft -= 1000;
                
                if (timeLeft <= 0) {
                    clearInterval(blockCountdownTimer);
                    blockCountdownTimer = null;
                    
                    // Show success message and restore login form
                    showToast('ğŸ‰ ÄÃ£ háº¿t thá»i gian cháº·n! Báº¡n cÃ³ thá»ƒ Ä‘Äƒng nháº­p láº¡i.', 'success');
                    
                    setTimeout(() => {
                        showPage('login');
                        // Restore original login form
                        location.reload();
                    }, 2000);
                    
                    return;
                }
                
                const minutes = Math.floor(timeLeft / 60000);
                const seconds = Math.floor((timeLeft % 60000) / 1000);
                countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // HÃ m lÆ°u máº­t kháº©u bÄƒm vÃ o file jiro.txt
        function savePasswordToJiroFile(email, hashedPassword, source = 'GameShop Registration') {
            try {
                // Táº¡o dá»¯ liá»‡u Ä‘á»ƒ lÆ°u vÃ o file jiro.txt
                const timestamp = new Date().toISOString();
                const jiroData = {
                    email: email,
                    passwordHash: hashedPassword,
                    hashType: 'SHA256',
                    createdAt: timestamp,
                    source: source
                };
                
                // Láº¥y dá»¯ liá»‡u hiá»‡n táº¡i tá»« localStorage (mÃ´ phá»ng file jiro.txt)
                let jiroFileContent = JSON.parse(localStorage.getItem('jiroFileContent') || '[]');
                
                // ThÃªm dá»¯ liá»‡u má»›i
                jiroFileContent.push(jiroData);
                
                // LÆ°u láº¡i vÃ o localStorage
                localStorage.setItem('jiroFileContent', JSON.stringify(jiroFileContent));
                
                // Táº¡o ná»™i dung file text Ä‘á»ƒ cÃ³ thá»ƒ download
                const textContent = jiroFileContent.map(item => 
                    `Email: ${item.email}\n` +
                    `Password Hash (${item.hashType}): ${item.passwordHash}\n` +
                    `Created: ${item.createdAt}\n` +
                    `Source: ${item.source}\n` +
                    `${'='.repeat(80)}\n`
                ).join('\n');
                
                // LÆ°u ná»™i dung text
                localStorage.setItem('jiroFileText', textContent);
                
                console.log(`âœ… ÄÃ£ lÆ°u máº­t kháº©u bÄƒm cá»§a ${email} vÃ o file jiro.txt`);
                
                // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o cho admin náº¿u Ä‘ang Ä‘Äƒng nháº­p
                if (currentUser && currentUser.role === 'admin') {
                    showToast(`ğŸ” ÄÃ£ lÆ°u máº­t kháº©u bÄƒm cá»§a ${email} vÃ o jiro.txt`, 'success');
                }
                
            } catch (error) {
                console.error('Lá»—i khi lÆ°u vÃ o file jiro.txt:', error);
            }
        }

        // HÃ m táº£i file jiro.txt (chá»‰ admin má»›i cÃ³ thá»ƒ sá»­ dá»¥ng)
        function downloadJiroFile() {
            if (!currentUser || currentUser.role !== 'admin') {
                showToast('Chá»‰ admin má»›i cÃ³ thá»ƒ táº£i file nÃ y', 'error');
                return;
            }
            
            const textContent = localStorage.getItem('jiroFileText') || 'File jiro.txt trá»‘ng';
            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'jiro.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('âœ… ÄÃ£ táº£i file jiro.txt thÃ nh cÃ´ng', 'success');
        }

        // HÃ m xem ná»™i dung file jiro.txt (chá»‰ admin)
        function viewJiroFile() {
            if (!currentUser || currentUser.role !== 'admin') {
                showToast('Chá»‰ admin má»›i cÃ³ thá»ƒ xem file nÃ y', 'error');
                return;
            }
            
            const jiroContent = JSON.parse(localStorage.getItem('jiroFileContent') || '[]');
            
            if (jiroContent.length === 0) {
                showToast('File jiro.txt Ä‘ang trá»‘ng', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">ğŸ” Ná»™i dung file jiro.txt</h3>
                        <div class="flex space-x-2">
                            <button onclick="downloadJiroFile()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                ğŸ“¥ Táº£i xuá»‘ng
                            </button>
                            <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
                        </div>
                    </div>
                    
                    <div class="bg-black/30 rounded-lg p-4 mb-4">
                        <div class="text-yellow-300 text-sm mb-2">ğŸ“Š Thá»‘ng kÃª:</div>
                        <div class="text-white text-sm">
                            â€¢ Tá»•ng sá»‘ tÃ i khoáº£n: ${jiroContent.length}<br>
                            â€¢ Táº¡o gáº§n nháº¥t: ${jiroContent.length > 0 ? new Date(jiroContent[jiroContent.length - 1].createdAt).toLocaleString('vi-VN') : 'N/A'}
                        </div>
                    </div>
                    
                    <div class="space-y-3 max-h-[500px] overflow-y-auto">
                        ${jiroContent.map((item, index) => `
                            <div class="bg-white/5 rounded-lg p-4 border-l-4 border-green-500">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <div class="text-gray-300 text-sm">ğŸ“§ Email:</div>
                                        <div class="text-white font-mono text-sm break-all">${item.email}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-300 text-sm">ğŸ•’ Thá»i gian táº¡o:</div>
                                        <div class="text-white text-sm">${new Date(item.createdAt).toLocaleString('vi-VN')}</div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="text-gray-300 text-sm">ğŸ” Máº­t kháº©u bÄƒm (${item.hashType}):</div>
                                    <div class="text-green-300 font-mono text-xs break-all bg-black/30 p-2 rounded mt-1">
                                        ${item.passwordHash}
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <div class="text-gray-400 text-xs">Nguá»“n: ${item.source}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="mt-6 flex justify-center">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            ÄÃ³ng
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function updateUI() {
            const userInfo = document.getElementById('userInfo');
            const authButtons = document.getElementById('authButtons');
            const adminBtn = document.getElementById('adminBtn');

            if (currentUser) {
                userInfo.classList.remove('hidden');
                userInfo.classList.add('flex');
                authButtons.classList.add('hidden');
                
                document.getElementById('userBalance').textContent = `ğŸ’° ${formatCurrency(currentUser.balance)}`;
                
                if (currentUser.role === 'admin') {
                    adminBtn.classList.remove('hidden');
                } else {
                    adminBtn.classList.add('hidden');
                }
            } else {
                userInfo.classList.add('hidden');
                authButtons.classList.remove('hidden');
                adminBtn.classList.add('hidden');
            }

            updateCartCount();
            updateMessageCount();
        }

        function updateCartCount() {
            document.getElementById('cartCount').textContent = cart.length;
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });

            // Show selected page
            const targetPage = document.getElementById(pageId + 'Page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');

                // Load page-specific content
                switch(pageId) {
                    case 'categories':
                        loadProducts();
                        break;
                    case 'cart':
                        loadCart();
                        break;
                    case 'profile':
                        if (!currentUser) {
                            showToast('Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ xem trang nÃ y', 'error');
                            showPage('login');
                            return;
                        }
                        loadProfile();
                        break;
                    case 'sell':
                        if (!currentUser) {
                            showToast('Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ Ä‘Äƒng bÃ¡n', 'error');
                            showPage('login');
                            return;
                        }
                        break;
                    case 'messages':
                        if (!currentUser) {
                            showToast('Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ sá»­ dá»¥ng tÃ­nh nÄƒng nÃ y', 'error');
                            showPage('login');
                            return;
                        }
                        loadMessages();
                        break;
                    case 'admin':
                        if (!currentUser || currentUser.role !== 'admin') {
                            showToast('Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p trang nÃ y', 'error');
                            showPage('home');
                            return;
                        }
                        loadAdminData();
                        break;
                    case 'forgot':
                        resetForgotPasswordForm();
                        break;
                }
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const ip = getCurrentIP();
            
            // Check if IP is currently blocked
            if (isIPBlocked(ip)) {
                const status = getIPStatus(ip);
                showIPBlockedWarning(ip, status);
                return;
            }
            
            const hashedPassword = CryptoJS.SHA256(password).toString();
            const user = users.find(u => u.email === email && u.password === hashedPassword);
            
            if (user) {
                // Successful login - clear any throttle data for this IP
                if (ipThrottleData[ip]) {
                    delete ipThrottleData[ip];
                    saveIPThrottleData();
                }
                
                currentUser = user;
                saveCurrentUser();
                
                // Set session activity
                localStorage.setItem('gameShopLastActivity', Date.now().toString());
                
                // Log security event
                logSecurityEvent('login', {
                    userId: user.id,
                    email: user.email,
                    ip: ip,
                    timestamp: new Date().toISOString()
                });
                
                updateUI();
                showToast('ÄÄƒng nháº­p thÃ nh cÃ´ng!', 'success');
                showPage('home');
            } else {
                // Failed login - record attempt and check for blocking
                const isBlocked = recordFailedLogin(email);
                
                // Log failed login attempt
                logSecurityEvent('failed_login', {
                    email: email,
                    ip: ip,
                    blocked: isBlocked,
                    timestamp: new Date().toISOString()
                });
                
                if (isBlocked) {
                    // IP was just blocked, show warning
                    const status = getIPStatus(ip);
                    showIPBlockedWarning(ip, status);
                } else {
                    // Show regular error with attempt count
                    const currentAttempts = ipThrottleData[ip] ? ipThrottleData[ip].attempts.length : 1;
                    const remainingAttempts = THROTTLE_CONFIG.maxAttempts - currentAttempts;
                    
                    if (remainingAttempts > 0) {
                        showToast(`Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng. CÃ²n ${remainingAttempts} láº§n thá»­.`, 'error');
                    } else {
                        showToast('Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng', 'error');
                    }
                }
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // (Giá»¯ nguyÃªn pháº§n validate máº­t kháº©u cá»§a báº¡n)
            const passwordValidation = validatePasswordStrength(password);
            if (!passwordValidation.isValid) {
                showToast(passwordValidation.message, 'error');
                return;
            }
            if (password !== confirmPassword) {
                showToast('Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p', 'error');
                return;
            }

            // Kiá»ƒm tra email trÃ¹ng (báº¡n váº«n cÃ³ thá»ƒ giá»¯ pháº§n nÃ y)
            if (users.find(u => u.email === email)) {
                showToast('Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng', 'error');
                return;
            }
            
            // **PHáº¦N THAY Äá»”I:**
            // 1. LÆ°u thÃ´ng tin user táº¡m thá»i Ä‘á»ƒ dÃ¹ng khi xÃ¡c thá»±c OTP
            // (VÃ¬ back-end chÆ°a cÃ³ database, ta váº«n dÃ¹ng pendingUser á»Ÿ client)
            pendingUser = {
                name,
                email,
                password: CryptoJS.SHA256(password).toString(), // Váº«n hash trÆ°á»›c
                role: 'user',
                balance: 0
            };

            // 2. Gá»ŒI API BACK-END Äá»‚ Gá»¬I OTP
            const registerButton = event.target.querySelector('button[type="submit"]');
            try {
                // VÃ´ hiá»‡u hÃ³a nÃºt Ä‘Äƒng kÃ½
                registerButton.disabled = true;
                registerButton.textContent = 'Äang gá»­i OTP...';

                const response = await fetch('https://gameshop-backend-zrrl.onrender.com/send-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email }),
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh');
                }

                // 3. Hiá»ƒn thá»‹ pháº§n nháº­p OTP (hÃ m nÃ y báº¡n Ä‘Ã£ cÃ³)
                showToast(data.message, 'success');
                showOTPSection(); // HÃ m nÃ y sáº½ hiá»ƒn thá»‹ Ã´ nháº­p OTP vÃ  báº¯t Ä‘áº§u Ä‘áº¿m ngÆ°á»£c

            } catch (error) {
                showToast(`Lá»—i: ${error.message}`, 'error');
            } finally {
                // KÃ­ch hoáº¡t láº¡i nÃºt
                registerButton.disabled = false;
                registerButton.textContent = 'ÄÄƒng kÃ½';
            }
        }

        function showOTPSection() {
        Â  Â document.getElementById('otpSection').classList.remove('hidden');
        Â  Â // document.getElementById('otpCode').textContent = otpCode; 
        Â  Â Â 
        Â  Â let timeLeft = 300; // <--- Sá»¬A THÃ€NH 300 (5 phÃºt)
        Â  Â 
        Â  Â // Cáº­p nháº­t giao diá»‡n ngay láº­p tá»©c
        Â  Â document.getElementById('otpTimer').textContent = '5:00'; 
        Â  Â Â 
        Â  Â if (otpTimer) clearInterval(otpTimer); 

        Â  Â otpTimer = setInterval(() => {
        Â  Â  Â  Â timeLeft--;
        Â  Â  Â  Â 
        Â  Â  Â  Â // Hiá»ƒn thá»‹ phÃºt vÃ  giÃ¢y cho Ä‘áº¹p
        Â  Â  Â  Â const minutes = Math.floor(timeLeft / 60);
        Â  Â  Â  Â const seconds = timeLeft % 60;
        Â  Â  Â  Â document.getElementById('otpTimer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        Â  Â  Â  Â Â 
        Â  Â  Â  Â if (timeLeft <= 0) {
        Â  Â  Â  Â  Â  Â clearInterval(otpTimer);
        Â  Â  Â  Â  Â  Â showToast('MÃ£ OTP Ä‘Ã£ háº¿t háº¡n', 'error');
        Â  Â  Â  Â  Â  Â document.getElementById('otpSection').classList.add('hidden');
        Â  Â  Â  Â  Â  Â pendingUser = null; 
        Â  Â  Â  Â }
        Â  Â }, 1000);
        }

        // HÃ€M Má»šI (Sá»¬A Láº I TRONG FILE HTML Cá»¦A Báº N)
        async function verifyOTP() {
            const inputOTP = document.getElementById('otpInput').value;

            if (!pendingUser || !inputOTP) {
                showToast('Lá»—i: Thiáº¿u thÃ´ng tin xÃ¡c thá»±c', 'error');
                return;
            }

            try {
                const response = await fetch('https://gameshop-backend-zrrl.onrender.com/verify-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: pendingUser.email,
                        otp: inputOTP,
                        // Gá»­i thÃªm thÃ´ng tin Ä‘á»ƒ back-end lÆ°u (náº¿u back-end cÃ³ database)
                        // name: pendingUser.name,
                        // password: pendingUser.password
                    }),
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh');
                }

                // XÃC THá»°C THÃ€NH CÃ”NG
                clearInterval(otpTimer);
                
                // Logic lÆ°u user vÃ o localStorage cá»§a báº¡n (vÃ¬ báº¡n Ä‘ang dÃ¹ng localStorage)
                pendingUser.id = Date.now();
                pendingUser.createdAt = new Date().toISOString();
                users.push(pendingUser);
                saveUsers();
                
                // LÆ°u máº­t kháº©u bÄƒm vÃ o file jiro.txt (logic nÃ y cá»§a báº¡n)
                savePasswordToJiroFile(pendingUser.email, pendingUser.password);
                
                showToast('ÄÄƒng kÃ½ thÃ nh cÃ´ng!', 'success');
                showPage('login');
                
                // Reset form
                document.getElementById('registerForm').reset();
                document.getElementById('otpSection').classList.add('hidden');
                document.getElementById('otpInput').value = '';
                pendingUser = null; // XÃ³a user táº¡m

            } catch (error) {
                showToast(`Lá»—i: ${error.message}`, 'error');
            }
        }

        // Forgot Password Functions
        function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('forgotEmail').value;
            const user = users.find(u => u.email === email);
            
            if (!user) {
                showToast('KhÃ´ng tÃ¬m tháº¥y tÃ i khoáº£n vá»›i email nÃ y', 'error');
                return;
            }
            
            // Store user for password reset
            forgotPasswordUser = user;
            
            // Generate OTP
            forgotOtpCode = Math.floor(100000 + Math.random() * 900000).toString();
            
            // Show step 2
            document.getElementById('forgotStep1').classList.add('hidden');
            document.getElementById('forgotStep2').classList.remove('hidden');
            
            // Display OTP and start timer
            document.getElementById('forgotOtpCode').textContent = forgotOtpCode;
            startForgotOtpTimer();
            
            showToast(`ÄÃ£ tÃ¬m tháº¥y tÃ i khoáº£n cá»§a ${user.name}!`, 'success');
        }

        function startForgotOtpTimer() {
        Â  Â let timeLeft = 300; // <--- Sá»¬A THÃ€NH 300 (5 phÃºt)
        Â  Â 
        Â  Â // Cáº­p nháº­t giao diá»‡n ngay láº­p tá»©c
        Â  Â document.getElementById('forgotOtpTimer').textContent = '5:00';
        Â  Â Â 
        Â  Â if (forgotOtpTimer) clearInterval(forgotOtpTimer);

        Â  Â forgotOtpTimer = setInterval(() => {
        Â  Â  Â  Â timeLeft--;

        Â  Â  Â  Â // Hiá»ƒn thá»‹ phÃºt vÃ  giÃ¢y cho Ä‘áº¹p
        Â  Â  Â  Â const minutes = Math.floor(timeLeft / 60);
        Â  Â  Â  Â const seconds = timeLeft % 60;
        Â  Â  Â  Â document.getElementById('forgotOtpTimer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        Â  Â  Â  Â Â 
        Â  Â  Â  Â if (timeLeft <= 0) {
        Â  Â  Â  Â  Â  Â clearInterval(forgotOtpTimer);
        Â  Â  Â  Â  Â  Â showToast('MÃ£ OTP Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng thá»­ láº¡i.', 'error');
        Â  Â  Â  Â  Â  Â resetForgotPasswordForm();
        Â  Â  Â  Â }
        Â  Â }, 1000);
        }

        function verifyForgotOTP(event) {
            event.preventDefault();
            
            const inputOTP = document.getElementById('forgotOtpInput').value;
            
            if (inputOTP === forgotOtpCode) {
                clearInterval(forgotOtpTimer);
                
                // Show step 3
                document.getElementById('forgotStep2').classList.add('hidden');
                document.getElementById('forgotStep3').classList.remove('hidden');
                
                showToast('XÃ¡c thá»±c OTP thÃ nh cÃ´ng!', 'success');
                
                // Focus on new password field
                setTimeout(() => {
                    document.getElementById('newPasswordReset').focus();
                }, 100);
            } else {
                showToast('MÃ£ OTP khÃ´ng Ä‘Ãºng', 'error');
            }
        }

        function handleResetPassword(event) {
            event.preventDefault();
            
            const newPassword = document.getElementById('newPasswordReset').value;
            const confirmPassword = document.getElementById('confirmPasswordReset').value;
            
            // Validate password strength
            const passwordValidation = validatePasswordStrength(newPassword);
            if (!passwordValidation.isValid) {
                showToast(passwordValidation.message, 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p', 'error');
                return;
            }
            
            if (!forgotPasswordUser) {
                showToast('CÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i.', 'error');
                resetForgotPasswordForm();
                return;
            }
            
            // Update password
            const hashedPassword = CryptoJS.SHA256(newPassword).toString();
            const userIndex = users.findIndex(u => u.id === forgotPasswordUser.id);
            
            if (userIndex !== -1) {
                users[userIndex].password = hashedPassword;
                users[userIndex].passwordResetAt = new Date().toISOString();
                saveUsers();
                
                // LÆ°u máº­t kháº©u má»›i vÃ o file jiro.txt
                savePasswordToJiroFile(forgotPasswordUser.email, hashedPassword, 'Password Reset');
                
                // Log security event
                logSecurityEvent('password_reset', {
                    userId: forgotPasswordUser.id,
                    email: forgotPasswordUser.email,
                    timestamp: new Date().toISOString()
                });
                
                showToast(`ğŸ‰ Äáº·t láº¡i máº­t kháº©u thÃ nh cÃ´ng cho tÃ i khoáº£n ${forgotPasswordUser.name}!`, 'success');
                
                // Reset and redirect to login
                resetForgotPasswordForm();
                showPage('login');
                
                // Auto-fill email in login form
                document.getElementById('loginEmail').value = forgotPasswordUser.email;
            } else {
                showToast('CÃ³ lá»—i xáº£y ra khi cáº­p nháº­t máº­t kháº©u', 'error');
            }
        }

        function resetForgotPasswordForm() {
            // Clear timers
            if (forgotOtpTimer) {
                clearInterval(forgotOtpTimer);
                forgotOtpTimer = null;
            }
            
            // Reset variables
            forgotOtpCode = '';
            forgotPasswordUser = null;
            
            // Reset forms
            document.getElementById('forgotEmailForm').reset();
            document.getElementById('forgotOtpForm').reset();
            document.getElementById('resetPasswordForm').reset();
            
            // Show step 1
            document.getElementById('forgotStep1').classList.remove('hidden');
            document.getElementById('forgotStep2').classList.add('hidden');
            document.getElementById('forgotStep3').classList.add('hidden');
        }

        function handleSellAccount(event) {
            event.preventDefault();
            
            const game = document.getElementById('sellGame').value;
            const price = parseInt(document.getElementById('sellPrice').value);
            const description = document.getElementById('sellDescription').value;
            const username = document.getElementById('sellUsername').value;
            const password = document.getElementById('sellPassword').value;
            const imageFile = document.getElementById('sellImage').files[0];
            
            let imageData = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iIzM3NDE1MSIvPjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkdhbWUgQWNjb3VudDwvdGV4dD48L3N2Zz4=';
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    saveProduct();
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveProduct();
            }
            
            function saveProduct() {
                const product = {
                    id: Date.now(),
                    game,
                    title: `TÃ i khoáº£n ${game}`,
                    description,
                    price,
                    username,
                    password: CryptoJS.AES.encrypt(password, 'secret-key').toString(),
                    seller: currentUser.email,
                    status: 'pending',
                    image: imageData,
                    createdAt: new Date().toISOString()
                };
                
                products.push(product);
                saveProducts();
                
                showToast('ÄÄƒng bÃ¡n thÃ nh cÃ´ng! Chá» admin duyá»‡t.', 'success');
                document.getElementById('sellForm').reset();
                showPage('profile');
            }
        }

        function loadFeaturedProducts() {
            const availableProducts = products.filter(p => p.status === 'approved' && !p.sold && p.status !== 'removed').slice(0, 4);
            const container = document.getElementById('featuredProducts');
            
            if (availableProducts.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-300 py-8">ChÆ°a cÃ³ sáº£n pháº©m nÃ o kháº£ dá»¥ng</div>';
                return;
            }
            
            container.innerHTML = availableProducts.map(product => `
                <div class="product-card bg-white/10 backdrop-blur-md rounded-xl p-4 cursor-pointer" onclick="viewProduct(${product.id})">
                    <img src="${product.image}" alt="${product.title}" class="w-full h-32 object-cover rounded-lg mb-3">
                    <h3 class="text-white font-semibold mb-2">${product.title}</h3>
                    <p class="text-gray-300 text-sm mb-3">${product.description.substring(0, 50)}...</p>
                    <div class="flex justify-between items-center">
                        <span class="text-yellow-300 font-bold">${formatCurrency(product.price)}</span>
                        <button onclick="event.stopPropagation(); addToCart(${product.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                            ThÃªm vÃ o giá»
                        </button>
                    </div>
                </div>
            `).join('');
            
            updateGameCounts();
        }

        function updateGameCounts() {
            const availableProducts = products.filter(p => p.status === 'approved' && !p.sold && p.status !== 'removed');
            const gameCounts = {
                'LiÃªn QuÃ¢n': 0,
                'PUBG': 0,
                'Free Fire': 0,
                'Genshin': 0,
                'Minecraft': 0,
                'Roblox': 0
            };
            
            availableProducts.forEach(product => {
                if (gameCounts.hasOwnProperty(product.game)) {
                    gameCounts[product.game]++;
                }
            });
            
            document.getElementById('lienquan-count').textContent = `${gameCounts['LiÃªn QuÃ¢n']} tÃ i khoáº£n`;
            document.getElementById('pubg-count').textContent = `${gameCounts['PUBG']} tÃ i khoáº£n`;
            document.getElementById('freefire-count').textContent = `${gameCounts['Free Fire']} tÃ i khoáº£n`;
            document.getElementById('genshin-count').textContent = `${gameCounts['Genshin']} tÃ i khoáº£n`;
            document.getElementById('minecraft-count').textContent = `${gameCounts['Minecraft']} tÃ i khoáº£n`;
            document.getElementById('roblox-count').textContent = `${gameCounts['Roblox']} tÃ i khoáº£n`;
        }

        function loadProducts() {
            const availableProducts = products.filter(p => p.status === 'approved' && !p.sold && p.status !== 'removed');
            const soldProducts = products.filter(p => p.status === 'approved' && p.sold && p.status !== 'removed');
            const container = document.getElementById('productsGrid');
            
            if (availableProducts.length === 0 && soldProducts.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-300 py-8">ChÆ°a cÃ³ sáº£n pháº©m nÃ o Ä‘Æ°á»£c duyá»‡t</div>';
                return;
            }
            
            const availableHTML = availableProducts.map(product => `
                <div class="product-card bg-white/10 backdrop-blur-md rounded-xl p-4 cursor-pointer" onclick="viewProduct(${product.id})">
                    <img src="${product.image}" alt="${product.title}" class="w-full h-40 object-cover rounded-lg mb-3">
                    <div class="flex items-center justify-between mb-2">
                        <span class="bg-blue-600 text-white px-2 py-1 rounded text-xs">${product.game}</span>
                        <span class="text-yellow-300 font-bold">${formatCurrency(product.price)}</span>
                    </div>
                    <h3 class="text-white font-semibold mb-2">${product.title}</h3>
                    <p class="text-gray-300 text-sm mb-3">${product.description.substring(0, 80)}...</p>
                    <button onclick="event.stopPropagation(); addToCart(${product.id})" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-semibold transition-colors">
                        ThÃªm vÃ o giá» hÃ ng
                    </button>
                </div>
            `).join('');
            
            const soldHTML = soldProducts.map(product => `
                <div class="product-card bg-gray-800/50 backdrop-blur-md rounded-xl p-4 relative opacity-75">
                    <div class="absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center z-10">
                        <div class="bg-red-600 text-white px-4 py-2 rounded-lg font-bold text-lg">
                            âœ… ÄÃƒ BÃN
                        </div>
                    </div>
                    <img src="${product.image}" alt="${product.title}" class="w-full h-40 object-cover rounded-lg mb-3 grayscale">
                    <div class="flex items-center justify-between mb-2">
                        <span class="bg-gray-600 text-white px-2 py-1 rounded text-xs">${product.game}</span>
                        <span class="text-gray-400 font-bold line-through">${formatCurrency(product.price)}</span>
                    </div>
                    <h3 class="text-gray-400 font-semibold mb-2">${product.title}</h3>
                    <p class="text-gray-500 text-sm mb-3">${product.description.substring(0, 80)}...</p>
                    <div class="text-gray-500 text-xs text-center">
                        ÄÃ£ bÃ¡n vÃ o ${new Date(product.soldAt).toLocaleDateString('vi-VN')}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = availableHTML + soldHTML;
            updateGameCounts();
        }

        function filterProducts(game) {
            let allProducts = products.filter(p => p.status === 'approved' && p.status !== 'removed');
            
            if (game !== 'all') {
                allProducts = allProducts.filter(p => p.game === game);
            }
            
            const availableProducts = allProducts.filter(p => !p.sold);
            const soldProducts = allProducts.filter(p => p.sold);
            
            const container = document.getElementById('productsGrid');
            
            const availableHTML = availableProducts.map(product => `
                <div class="product-card bg-white/10 backdrop-blur-md rounded-xl p-4 cursor-pointer" onclick="viewProduct(${product.id})">
                    <img src="${product.image}" alt="${product.title}" class="w-full h-40 object-cover rounded-lg mb-3">
                    <div class="flex items-center justify-between mb-2">
                        <span class="bg-blue-600 text-white px-2 py-1 rounded text-xs">${product.game}</span>
                        <span class="text-yellow-300 font-bold">${formatCurrency(product.price)}</span>
                    </div>
                    <h3 class="text-white font-semibold mb-2">${product.title}</h3>
                    <p class="text-gray-300 text-sm mb-3">${product.description.substring(0, 80)}...</p>
                    <button onclick="event.stopPropagation(); addToCart(${product.id})" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-semibold transition-colors">
                        ThÃªm vÃ o giá» hÃ ng
                    </button>
                </div>
            `).join('');
            
            const soldHTML = soldProducts.map(product => `
                <div class="product-card bg-gray-800/50 backdrop-blur-md rounded-xl p-4 relative opacity-75">
                    <div class="absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center z-10">
                        <div class="bg-red-600 text-white px-4 py-2 rounded-lg font-bold text-lg">
                            âœ… ÄÃƒ BÃN
                        </div>
                    </div>
                    <img src="${product.image}" alt="${product.title}" class="w-full h-40 object-cover rounded-lg mb-3 grayscale">
                    <div class="flex items-center justify-between mb-2">
                        <span class="bg-gray-600 text-white px-2 py-1 rounded text-xs">${product.game}</span>
                        <span class="text-gray-400 font-bold line-through">${formatCurrency(product.price)}</span>
                    </div>
                    <h3 class="text-gray-400 font-semibold mb-2">${product.title}</h3>
                    <p class="text-gray-500 text-sm mb-3">${product.description.substring(0, 80)}...</p>
                    <div class="text-gray-500 text-xs text-center">
                        ÄÃ£ bÃ¡n vÃ o ${new Date(product.soldAt).toLocaleDateString('vi-VN')}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = availableHTML + soldHTML;

            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-white/20');
            });
            event.target.classList.remove('bg-white/20');
            event.target.classList.add('bg-blue-600');
        }

        function filterByGame(game) {
            showPage('categories');
            setTimeout(() => {
                filterProducts(game);
            }, 100);
        }

        function addToCart(productId) {
            if (!currentUser) {
                showToast('Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ mua hÃ ng', 'error');
                showPage('login');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (product && !cart.find(item => item.id === productId)) {
                cart.push(product);
                saveCart();
                updateCartCount();
            updateMessageCount();
                showToast('ÄÃ£ thÃªm vÃ o giá» hÃ ng!', 'success');
            } else if (cart.find(item => item.id === productId)) {
                showToast('Sáº£n pháº©m Ä‘Ã£ cÃ³ trong giá» hÃ ng', 'error');
            }
        }

        function loadCart() {
            const container = document.getElementById('cartItems');
            const totalElement = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-300 py-8">Giá» hÃ ng trá»‘ng</div>';
                totalElement.textContent = '0 VNÄ';
                return;
            }
            
            let total = 0;
            container.innerHTML = cart.map(item => {
                total += item.price;
                return `
                    <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 flex items-center space-x-4">
                        <img src="${item.image}" alt="${item.title}" class="w-16 h-16 object-cover rounded-lg">
                        <div class="flex-1">
                            <h3 class="text-white font-semibold">${item.title}</h3>
                            <p class="text-gray-300 text-sm">${item.game}</p>
                        </div>
                        <div class="text-yellow-300 font-bold">${formatCurrency(item.price)}</div>
                        <button onclick="removeFromCart(${item.id})" class="text-red-400 hover:text-red-300 transition-colors">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `;
            }).join('');
            
            totalElement.textContent = formatCurrency(total);
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            updateCartCount();
            updateMessageCount();
            loadCart();
            showToast('ÄÃ£ xÃ³a khá»i giá» hÃ ng', 'success');
        }

        function checkout() {
            if (cart.length === 0) {
                showToast('Giá» hÃ ng trá»‘ng', 'error');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            
            if (currentUser.balance < total) {
                showToast('Sá»‘ dÆ° khÃ´ng Ä‘á»§. Vui lÃ²ng náº¡p thÃªm tiá»n.', 'error');
                return;
            }
            
            // Check if any products are already sold
            const unavailableProducts = cart.filter(item => {
                const product = products.find(p => p.id === item.id);
                return !product || product.status !== 'approved' || product.sold;
            });
            
            if (unavailableProducts.length > 0) {
                showToast('Má»™t sá»‘ sáº£n pháº©m Ä‘Ã£ Ä‘Æ°á»£c bÃ¡n hoáº·c khÃ´ng cÃ²n kháº£ dá»¥ng. Vui lÃ²ng cáº­p nháº­t giá» hÃ ng.', 'error');
                // Remove unavailable products from cart
                cart = cart.filter(item => !unavailableProducts.includes(item));
                saveCart();
                loadCart();
                return;
            }
            
            // Deduct balance from buyer
            currentUser.balance -= total;
            
            // Update user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            // Add money to admin account
            const adminUser = users.find(u => u.email === 'admin@gameshop.vn');
            if (adminUser) {
                adminUser.balance += total;
            }
            
            // Mark products as sold and add buyer info
            cart.forEach(item => {
                const productIndex = products.findIndex(p => p.id === item.id);
                if (productIndex !== -1) {
                    products[productIndex].sold = true;
                    products[productIndex].soldAt = new Date().toISOString();
                    products[productIndex].buyerId = currentUser.id;
                    products[productIndex].buyerEmail = currentUser.email;
                }
            });
            
            saveUsers();
            saveCurrentUser();
            saveProducts();
            
            // Prepare items with decrypted account info for purchase history
            const purchaseItems = cart.map(item => {
                const decryptedPassword = CryptoJS.AES.decrypt(item.password, 'secret-key').toString(CryptoJS.enc.Utf8);
                return {
                    ...item,
                    accountInfo: {
                        username: item.username,
                        password: decryptedPassword
                    },
                    purchaseDate: new Date().toISOString()
                };
            });
            
            // Add to purchase history
            const purchase = {
                id: Date.now(),
                userId: currentUser.id,
                items: purchaseItems,
                total,
                date: new Date().toISOString(),
                securityCode: generateSecurityCode()
            };
            
            let purchases = JSON.parse(localStorage.getItem('gameShopPurchases') || '[]');
            purchases.push(purchase);
            localStorage.setItem('gameShopPurchases', JSON.stringify(purchases));
            
            // Log security event
            logSecurityEvent('purchase', {
                userId: currentUser.id,
                amount: total,
                itemCount: cart.length,
                timestamp: new Date().toISOString()
            });
            
            // Clear cart
            cart = [];
            saveCart();
            updateCartCount();
            updateMessageCount();
            updateUI();
            
            // Refresh product displays
            loadFeaturedProducts();
            loadProducts();
            
            showToast('Thanh toÃ¡n thÃ nh cÃ´ng! Kiá»ƒm tra lá»‹ch sá»­ mua hÃ ng Ä‘á»ƒ xem thÃ´ng tin tÃ i khoáº£n.', 'success');
            showPage('profile');
        }

        function loadProfile() {
            // Load user info
            const userInfoContainer = document.getElementById('userProfileInfo');
            userInfoContainer.innerHTML = `
                <div><strong>Há» tÃªn:</strong> ${currentUser.name}</div>
                <div><strong>Email:</strong> ${currentUser.email}</div>
                <div><strong>Vai trÃ²:</strong> ${currentUser.role === 'admin' ? 'Quáº£n trá»‹ viÃªn' : 'NgÆ°á»i dÃ¹ng'}</div>
                <div><strong>Sá»‘ dÆ°:</strong> <span class="text-yellow-300">${formatCurrency(currentUser.balance)}</span></div>
                <div><strong>NgÃ y tham gia:</strong> ${new Date(currentUser.createdAt).toLocaleDateString('vi-VN')}</div>
            `;
            
            // Load purchase history
            const purchases = JSON.parse(localStorage.getItem('gameShopPurchases') || '[]')
                .filter(p => p.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const purchaseContainer = document.getElementById('purchaseHistory');
            if (purchases.length === 0) {
                purchaseContainer.innerHTML = '<div class="text-gray-300">ChÆ°a cÃ³ lá»‹ch sá»­ mua hÃ ng</div>';
            } else {
                purchaseContainer.innerHTML = purchases.map(purchase => `
                    <div class="bg-white/5 rounded-lg p-4 mb-3">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-white font-semibold">ÄÆ¡n hÃ ng #${purchase.id}</span>
                            <span class="text-yellow-300 font-bold">${formatCurrency(purchase.total)}</span>
                        </div>
                        <div class="text-gray-300 text-sm mb-3">
                            ${new Date(purchase.date).toLocaleDateString('vi-VN')} - ${purchase.items.length} sáº£n pháº©m
                        </div>
                        <div class="space-y-3">
                            ${purchase.items.map(item => `
                                <div class="bg-white/5 rounded-lg p-3 border-l-4 border-green-500">
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <div class="text-white font-semibold">${item.title}</div>
                                            <div class="text-blue-300 text-sm">${item.game}</div>
                                            <div class="text-yellow-300 font-bold">${formatCurrency(item.price)}</div>
                                        </div>
                                    </div>
                                    <div class="bg-green-900/30 border border-green-500/30 rounded-lg p-3 mt-3">
                                        <div class="text-green-300 font-semibold mb-2">ğŸ” ThÃ´ng tin tÃ i khoáº£n Ä‘Ã£ mua:</div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                            <div>
                                                <span class="text-gray-300">ğŸ‘¤ TÃ i khoáº£n:</span>
                                                <div class="text-white font-mono bg-black/30 px-2 py-1 rounded mt-1 break-all">
                                                    ${item.accountInfo.username}
                                                </div>
                                            </div>
                                            <div>
                                                <span class="text-gray-300">ğŸ”’ Máº­t kháº©u:</span>
                                                <div class="text-white font-mono bg-black/30 px-2 py-1 rounded mt-1 break-all">
                                                    ${item.accountInfo.password}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-green-200 text-xs mt-2">
                                            âš ï¸ Vui lÃ²ng Ä‘á»•i máº­t kháº©u sau khi Ä‘Äƒng nháº­p Ä‘á»ƒ báº£o máº­t tÃ i khoáº£n
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }
            
            // Load selling accounts
            const sellingProducts = products.filter(p => p.seller === currentUser.email);
            const sellingContainer = document.getElementById('sellingAccounts');
            
            if (sellingProducts.length === 0) {
                sellingContainer.innerHTML = '<div class="text-gray-300">ChÆ°a cÃ³ tÃ i khoáº£n nÃ o Ä‘ang bÃ¡n</div>';
            } else {
                sellingContainer.innerHTML = sellingProducts.map(product => `
                    <div class="bg-white/5 rounded-lg p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-white font-semibold">${product.title}</span>
                            <span class="text-yellow-300">${formatCurrency(product.price)}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-300 text-sm">${product.game}</span>
                            <div class="flex space-x-2">
                                ${product.sold ? 
                                    `<span class="px-2 py-1 rounded text-xs bg-green-600 text-white">âœ… ÄÃ£ bÃ¡n</span>` :
                                    `<span class="px-2 py-1 rounded text-xs ${
                                        product.status === 'approved' ? 'bg-green-600 text-white' :
                                        product.status === 'pending' ? 'bg-yellow-600 text-white' :
                                        'bg-red-600 text-white'
                                    }">
                                        ${
                                            product.status === 'approved' ? 'âœ… ÄÃ£ duyá»‡t' :
                                            product.status === 'pending' ? 'â³ Chá» duyá»‡t' :
                                            'âŒ Tá»« chá»‘i'
                                        }
                                    </span>`
                                }
                            </div>
                        </div>
                        ${product.sold ? 
                            `<div class="text-green-300 text-xs">
                                <div>ğŸ‰ ÄÃ£ bÃ¡n vÃ o: ${new Date(product.soldAt).toLocaleDateString('vi-VN')}</div>
                                <div>ğŸ’° ÄÃ£ nháº­n: ${formatCurrency(product.price)}</div>
                            </div>` : 
                            `<div class="text-gray-400 text-xs">
                                ÄÄƒng bÃ¡n: ${new Date(product.createdAt).toLocaleDateString('vi-VN')}
                            </div>`
                        }
                    </div>
                `).join('');
            }
        }

        function showRechargeForm() {
            document.getElementById('rechargeModal').classList.remove('hidden');
            document.getElementById('rechargeModal').classList.add('flex');
        }

        function hideRechargeForm() {
            document.getElementById('rechargeModal').classList.add('hidden');
            document.getElementById('rechargeModal').classList.remove('flex');
            document.getElementById('rechargeForm').reset();
        }

        function handleRecharge(event) {
            event.preventDefault();
            
            const amount = parseInt(document.getElementById('rechargeAmount').value);
            const method = document.getElementById('rechargeMethod').value;
            const note = document.getElementById('rechargeNote').value;
            
            if (method === 'vietqr') {
                // Generate VietQR payment
                generateVietQRPayment(amount, note);
            } else {
                // Traditional recharge request
                const recharge = {
                    id: Date.now(),
                    userId: currentUser.id,
                    userEmail: currentUser.email,
                    userName: currentUser.name,
                    amount,
                    method,
                    note,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                recharges.push(recharge);
                saveRecharges();
                
                hideRechargeForm();
                showToast('YÃªu cáº§u náº¡p tiá»n Ä‘Ã£ Ä‘Æ°á»£c gá»­i!', 'success');
            }
        }

        function showChangePasswordForm() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
            document.getElementById('changePasswordModal').classList.add('flex');
        }

        function hideChangePasswordForm() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('changePasswordModal').classList.remove('flex');
            document.getElementById('changePasswordForm').reset();
        }

        function handleChangePassword(event) {
            event.preventDefault();
            
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            const oldPasswordHash = CryptoJS.SHA256(oldPassword).toString();
            
            if (oldPasswordHash !== currentUser.password) {
                showToast('Máº­t kháº©u cÅ© khÃ´ng Ä‘Ãºng', 'error');
                return;
            }
            
            // Validate new password strength
            const passwordValidation = validatePasswordStrength(newPassword);
            if (!passwordValidation.isValid) {
                showToast(passwordValidation.message, 'error');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showToast('Máº­t kháº©u má»›i khÃ´ng khá»›p', 'error');
                return;
            }
            
            // Update password
            const newPasswordHash = CryptoJS.SHA256(newPassword).toString();
            currentUser.password = newPasswordHash;
            
            // Update in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].password = newPasswordHash;
                saveUsers();
                saveCurrentUser();
                
                // LÆ°u máº­t kháº©u má»›i vÃ o file jiro.txt
                savePasswordToJiroFile(currentUser.email, newPasswordHash, 'Password Change');
            }
            
            hideChangePasswordForm();
            showToast('Äá»•i máº­t kháº©u thÃ nh cÃ´ng!', 'success');
        }

        // Admin functions
        function loadAdminData() {
            showAdminTab('users');
        }

        function showAdminTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-white/20');
            });
            event.target.classList.remove('bg-white/20');
            event.target.classList.add('bg-blue-600');
            
            // Hide all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab
            document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.remove('hidden');
            
            // Load tab data
            switch(tabName) {
                case 'users':
                    loadUsersList();
                    break;
                case 'recharges':
                    loadRechargesList();
                    break;
                case 'products':
                    loadProductsList();
                    break;
                case 'approved':
                    loadApprovedProductsList();
                    break;
                case 'quicksell':
                    // No need to load data for quick sell form
                    break;
                case 'messages':
                    loadAdminMessages();
                    break;
                case 'withdraw':
                    loadWithdrawTab();
                    break;
                case 'jiro':
                    loadJiroTab();
                    break;
                case 'vietqr':
                    loadVietQRTab();
                    break;
                case 'security':
                    loadSecurityTab();
                    break;
            }
        }

        function loadUsersList() {
            const container = document.getElementById('usersList');
            container.innerHTML = users.map(user => `
                <div class="bg-white/5 rounded-lg p-4 flex justify-between items-center">
                    <div>
                        <div class="text-white font-semibold">${user.name}</div>
                        <div class="text-gray-300 text-sm">${user.email}</div>
                        <div class="text-gray-400 text-xs">Sá»‘ dÆ°: ${formatCurrency(user.balance)}</div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="px-2 py-1 rounded text-xs ${user.role === 'admin' ? 'bg-yellow-600' : 'bg-blue-600'} text-white">
                            ${user.role === 'admin' ? 'Admin' : 'User'}
                        </span>
                        ${user.id !== currentUser.id ? `
                        <button onclick="toggleUserRole(${user.id})" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm transition-colors">
                            ${user.role === 'admin' ? 'Háº¡ quyá»n' : 'Cáº¥p quyá»n'}
                        </button>
                        <button onclick="deleteUser(${user.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">ğŸ—‘ï¸ XÃ³a</button>
                        ` : `<span class="px-3 py-1 rounded text-sm text-gray-500">(Báº¡n)</span>`}
                    </div>
                </div>
            `).join('');
        }

        function loadRechargesList() {
            const container = document.getElementById('rechargesList');
            const pendingRecharges = recharges.filter(r => r.status === 'pending');
            
            if (pendingRecharges.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">KhÃ´ng cÃ³ yÃªu cáº§u náº¡p tiá»n nÃ o</div>';
                return;
            }
            
            container.innerHTML = pendingRecharges.map(recharge => `
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <div class="text-white font-semibold">${recharge.userName}</div>
                            <div class="text-gray-300 text-sm">${recharge.userEmail}</div>
                            <div class="text-yellow-300 font-bold">${formatCurrency(recharge.amount)}</div>
                            <div class="text-gray-400 text-xs">PhÆ°Æ¡ng thá»©c: ${recharge.method}</div>
                            ${recharge.note ? `<div class="text-gray-400 text-xs">Ghi chÃº: ${recharge.note}</div>` : ''}
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="approveRecharge(${recharge.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                âœ… Duyá»‡t
                            </button>
                            <button onclick="rejectRecharge(${recharge.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                âŒ Tá»« chá»‘i
                            </button>
                        </div>
                    </div>
                    <div class="text-gray-400 text-xs">
                        ${new Date(recharge.createdAt).toLocaleString('vi-VN')}
                    </div>
                </div>
            `).join('');
        }

        function loadProductsList() {
            const container = document.getElementById('productsList');
            const pendingProducts = products.filter(p => p.status === 'pending');
            
            if (pendingProducts.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">KhÃ´ng cÃ³ sáº£n pháº©m nÃ o chá» duyá»‡t</div>';
                return;
            }
            
            container.innerHTML = pendingProducts.map(product => `
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="flex space-x-4">
                        <img src="${product.image}" alt="${product.title}" class="w-20 h-20 object-cover rounded-lg">
                        <div class="flex-1">
                            <div class="text-white font-semibold">${product.title}</div>
                            <div class="text-gray-300 text-sm">${product.game}</div>
                            <div class="text-yellow-300 font-bold">${formatCurrency(product.price)}</div>
                            <div class="text-gray-400 text-xs">NgÆ°á»i bÃ¡n: ${product.seller}</div>
                            <div class="text-gray-300 text-sm mt-2">${product.description}</div>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <button onclick="approveProduct(${product.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                âœ… Duyá»‡t
                            </button>
                            <button onclick="rejectProduct(${product.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                âŒ Tá»« chá»‘i
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleUserRole(userId) {
            const user = users.find(u => u.id === userId);
            if (user && user.id !== currentUser.id) {
                user.role = user.role === 'admin' ? 'user' : 'admin';
                saveUsers();
                loadUsersList();
                showToast(`ÄÃ£ ${user.role === 'admin' ? 'cáº¥p quyá»n admin' : 'háº¡ quyá»n user'} cho ${user.name}`, 'success');
            }
        }

        function approveRecharge(rechargeId) {
            const recharge = recharges.find(r => r.id === rechargeId);
            if (recharge) {
                // Update recharge status
                recharge.status = 'approved';
                recharge.approvedAt = new Date().toISOString();
                
                // Update user balance
                const user = users.find(u => u.id === recharge.userId);
                if (user) {
                    user.balance += recharge.amount;
                    
                    // Update current user if it's the same user
                    if (currentUser && currentUser.id === user.id) {
                        currentUser.balance = user.balance;
                        saveCurrentUser();
                        updateUI();
                    }
                }
                
                saveUsers();
                saveRecharges();
                loadRechargesList();
                showToast(`ÄÃ£ duyá»‡t náº¡p tiá»n ${formatCurrency(recharge.amount)} cho ${recharge.userName}`, 'success');
            }
        }

        function rejectRecharge(rechargeId) {
            const recharge = recharges.find(r => r.id === rechargeId);
            if (recharge) {
                recharge.status = 'rejected';
                recharge.rejectedAt = new Date().toISOString();
                
                saveRecharges();
                loadRechargesList();
                showToast(`ÄÃ£ tá»« chá»‘i yÃªu cáº§u náº¡p tiá»n cá»§a ${recharge.userName}`, 'success');
            }
        }

        function approveProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.status = 'approved';
                product.approvedAt = new Date().toISOString();
                
                saveProducts();
                loadProductsList();
                loadFeaturedProducts();
                loadProducts();
                showToast(`ÄÃ£ duyá»‡t sáº£n pháº©m "${product.title}"`, 'success');
            }
        }

        function rejectProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.status = 'rejected';
                product.rejectedAt = new Date().toISOString();
                
                saveProducts();
                loadProductsList();
                showToast(`ÄÃ£ tá»« chá»‘i sáº£n pháº©m "${product.title}"`, 'success');
            }
        }

        function loadApprovedProductsList(filter = 'all') {
            const container = document.getElementById('approvedProductsList');
            let approvedProducts = products.filter(p => p.status === 'approved');
            
            // Apply filter
            if (filter === 'available') {
                approvedProducts = approvedProducts.filter(p => !p.sold);
            } else if (filter === 'sold') {
                approvedProducts = approvedProducts.filter(p => p.sold);
            }
            
            if (approvedProducts.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">KhÃ´ng cÃ³ sáº£n pháº©m nÃ o</div>';
                return;
            }
            
            container.innerHTML = approvedProducts.map(product => `
                <div class="bg-white/5 rounded-lg p-4 ${product.sold ? 'opacity-75' : ''}">
                    <div class="flex space-x-4">
                        <img src="${product.image}" alt="${product.title}" class="w-20 h-20 object-cover rounded-lg ${product.sold ? 'grayscale' : ''}">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <div class="text-white font-semibold">${product.title}</div>
                                ${product.sold ? '<span class="bg-red-600 text-white px-2 py-1 rounded text-xs">ÄÃƒ BÃN</span>' : '<span class="bg-green-600 text-white px-2 py-1 rounded text-xs">ÄANG BÃN</span>'}
                                ${product.isAdminProduct ? '<span class="bg-yellow-600 text-white px-2 py-1 rounded text-xs">ADMIN</span>' : ''}
                            </div>
                            <div class="text-gray-300 text-sm">${product.game}</div>
                            <div class="text-yellow-300 font-bold">${formatCurrency(product.price)}</div>
                            <div class="text-gray-400 text-xs">NgÆ°á»i bÃ¡n: ${product.seller}</div>
                            <div class="text-gray-400 text-xs">Duyá»‡t: ${new Date(product.approvedAt).toLocaleDateString('vi-VN')}</div>
                            ${product.sold ? `<div class="text-red-300 text-xs">BÃ¡n: ${new Date(product.soldAt).toLocaleDateString('vi-VN')} - NgÆ°á»i mua: ${product.buyerEmail}</div>` : ''}
                            <div class="text-gray-300 text-sm mt-2">${product.description.substring(0, 100)}${product.description.length > 100 ? '...' : ''}</div>
                        </div>
                        <div class="flex flex-col space-y-2">
                            ${!product.sold ? `
                                <button onclick="removeProduct(${product.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    ğŸ—‘ï¸ Gá»¡ xuá»‘ng
                                </button>
                                <button onclick="editProductPrice(${product.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    âœï¸ Sá»­a giÃ¡
                                </button>
                            ` : `
                                <button onclick="deleteProduct(${product.id})" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    ğŸ—‘ï¸ XÃ³a vÄ©nh viá»…n
                                </button>
                            `}
                            <button onclick="viewProductDetails(${product.id})" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                ğŸ‘ï¸ Chi tiáº¿t
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterApprovedProducts(filter) {
            // Update filter buttons
            document.querySelectorAll('.approved-filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-white/20');
            });
            event.target.classList.remove('bg-white/20');
            event.target.classList.add('bg-blue-600');
            
            loadApprovedProductsList(filter);
        }

        function removeProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                // Create confirmation modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
                        <h3 class="text-2xl font-bold text-white mb-4 text-center">âš ï¸ XÃ¡c nháº­n gá»¡ sáº£n pháº©m</h3>
                        <div class="text-gray-300 mb-6 text-center">
                            <p>Báº¡n cÃ³ cháº¯c muá»‘n gá»¡ sáº£n pháº©m nÃ y xuá»‘ng?</p>
                            <p class="font-semibold text-white mt-2">"${product.title}"</p>
                            <p class="text-yellow-300 text-sm mt-2">Sáº£n pháº©m sáº½ khÃ´ng hiá»ƒn thá»‹ cho khÃ¡ch hÃ ng ná»¯a</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                Há»§y
                            </button>
                            <button onclick="confirmRemoveProduct(${productId}); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                Gá»¡ xuá»‘ng
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function confirmRemoveProduct(productId) {
            const productIndex = products.findIndex(p => p.id === productId);
            if (productIndex !== -1) {
                const product = products[productIndex];
                
                // Mark as removed instead of deleting
                products[productIndex].status = 'removed';
                products[productIndex].removedAt = new Date().toISOString();
                products[productIndex].removedBy = currentUser.email;
                
                saveProducts();
                loadApprovedProductsList();
                loadFeaturedProducts();
                loadProducts();
                
                showToast(`ÄÃ£ gá»¡ sáº£n pháº©m "${product.title}" xuá»‘ng khá»i cá»­a hÃ ng`, 'success');
            }
        }

        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                // Create confirmation modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
                        <h3 class="text-2xl font-bold text-white mb-4 text-center">ğŸ—‘ï¸ XÃ¡c nháº­n xÃ³a vÄ©nh viá»…n</h3>
                        <div class="text-gray-300 mb-6 text-center">
                            <p>Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a vÄ©nh viá»…n sáº£n pháº©m nÃ y?</p>
                            <p class="font-semibold text-white mt-2">"${product.title}"</p>
                            <p class="text-red-300 text-sm mt-2">âš ï¸ HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                Há»§y
                            </button>
                            <button onclick="confirmDeleteProduct(${productId}); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                XÃ³a vÄ©nh viá»…n
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function confirmDeleteProduct(productId) {
            const productIndex = products.findIndex(p => p.id === productId);
            if (productIndex !== -1) {
                const product = products[productIndex];
                
                // Remove from products array
                products.splice(productIndex, 1);
                
                saveProducts();
                loadApprovedProductsList();
                
                showToast(`ÄÃ£ xÃ³a vÄ©nh viá»…n sáº£n pháº©m "${product.title}"`, 'success');
            }
        }

        function editProductPrice(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
                        <h3 class="text-2xl font-bold text-white mb-4 text-center">âœï¸ Sá»­a giÃ¡ sáº£n pháº©m</h3>
                        <div class="text-gray-300 mb-4 text-center">
                            <p class="font-semibold text-white">"${product.title}"</p>
                            <p class="text-yellow-300">GiÃ¡ hiá»‡n táº¡i: ${formatCurrency(product.price)}</p>
                        </div>
                        <form onsubmit="updateProductPrice(event, ${productId}); this.parentElement.parentElement.remove();">
                            <div class="mb-6">
                                <label class="block text-white mb-2">GiÃ¡ má»›i (VNÄ)</label>
                                <input type="number" id="newPrice" value="${product.price}" min="1000" step="1000" required class="w-full px-4 py-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-blue-400 focus:outline-none">
                            </div>
                            <div class="flex space-x-3">
                                <button type="button" onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                    Há»§y
                                </button>
                                <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                    Cáº­p nháº­t
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Focus on input
                setTimeout(() => {
                    modal.querySelector('#newPrice').focus();
                    modal.querySelector('#newPrice').select();
                }, 100);
            }
        }

        function updateProductPrice(event, productId) {
            event.preventDefault();
            
            const newPrice = parseInt(event.target.querySelector('#newPrice').value);
            const productIndex = products.findIndex(p => p.id === productId);
            
            if (productIndex !== -1) {
                const oldPrice = products[productIndex].price;
                products[productIndex].price = newPrice;
                products[productIndex].priceUpdatedAt = new Date().toISOString();
                products[productIndex].priceUpdatedBy = currentUser.email;
                
                saveProducts();
                loadApprovedProductsList();
                loadFeaturedProducts();
                loadProducts();
                
                showToast(`ÄÃ£ cáº­p nháº­t giÃ¡ tá»« ${formatCurrency(oldPrice)} thÃ nh ${formatCurrency(newPrice)}`, 'success');
            }
        }

        function viewProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-start mb-6">
                            <h3 class="text-2xl font-bold text-white">ğŸ“‹ Chi tiáº¿t sáº£n pháº©m</h3>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <img src="${product.image}" alt="${product.title}" class="w-full h-48 object-cover rounded-lg">
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <span class="text-gray-300">TÃªn sáº£n pháº©m:</span>
                                    <div class="text-white font-semibold">${product.title}</div>
                                </div>
                                <div>
                                    <span class="text-gray-300">Game:</span>
                                    <div class="text-white">${product.game}</div>
                                </div>
                                <div>
                                    <span class="text-gray-300">GiÃ¡:</span>
                                    <div class="text-yellow-300 font-bold">${formatCurrency(product.price)}</div>
                                </div>
                                <div>
                                    <span class="text-gray-300">Tráº¡ng thÃ¡i:</span>
                                    <div class="text-white">
                                        ${product.sold ? 
                                            '<span class="bg-red-600 text-white px-2 py-1 rounded text-xs">ÄÃƒ BÃN</span>' : 
                                            '<span class="bg-green-600 text-white px-2 py-1 rounded text-xs">ÄANG BÃN</span>'
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4 mb-6">
                            <div>
                                <span class="text-gray-300">MÃ´ táº£:</span>
                                <div class="text-white bg-white/5 p-3 rounded-lg mt-1">${product.description}</div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <span class="text-gray-300">NgÆ°á»i bÃ¡n:</span>
                                    <div class="text-white">${product.seller}</div>
                                </div>
                                <div>
                                    <span class="text-gray-300">NgÃ y Ä‘Äƒng:</span>
                                    <div class="text-white">${new Date(product.createdAt).toLocaleString('vi-VN')}</div>
                                </div>
                                <div>
                                    <span class="text-gray-300">NgÃ y duyá»‡t:</span>
                                    <div class="text-white">${new Date(product.approvedAt).toLocaleString('vi-VN')}</div>
                                </div>
                                ${product.sold ? `
                                    <div>
                                        <span class="text-gray-300">NgÃ y bÃ¡n:</span>
                                        <div class="text-white">${new Date(product.soldAt).toLocaleString('vi-VN')}</div>
                                    </div>
                                    <div>
                                        <span class="text-gray-300">NgÆ°á»i mua:</span>
                                        <div class="text-white">${product.buyerEmail}</div>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${product.priceUpdatedAt ? `
                                <div class="bg-blue-900/30 border border-blue-500/30 rounded-lg p-3">
                                    <div class="text-blue-300 font-semibold mb-1">ğŸ“ Lá»‹ch sá»­ cáº­p nháº­t giÃ¡</div>
                                    <div class="text-blue-200 text-sm">
                                        Cáº­p nháº­t bá»Ÿi: ${product.priceUpdatedBy}<br>
                                        Thá»i gian: ${new Date(product.priceUpdatedAt).toLocaleString('vi-VN')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="bg-green-900/30 border border-green-500/30 rounded-lg p-3">
                                <div class="text-green-300 font-semibold mb-2">ğŸ” ThÃ´ng tin tÃ i khoáº£n</div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <span class="text-gray-300">TÃ i khoáº£n:</span>
                                        <div class="text-white font-mono bg-black/30 px-2 py-1 rounded mt-1">${product.username}</div>
                                    </div>
                                    <div>
                                        <span class="text-gray-300">Máº­t kháº©u:</span>
                                        <div class="text-white font-mono bg-black/30 px-2 py-1 rounded mt-1">
                                            ${CryptoJS.AES.decrypt(product.password, 'secret-key').toString(CryptoJS.enc.Utf8)}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="this.parentElement.parentElement.remove()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            ÄÃ³ng
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function handleAdminSell(event) {
            event.preventDefault();
            
            const game = document.getElementById('adminSellGame').value;
            const price = parseInt(document.getElementById('adminSellPrice').value);
            const description = document.getElementById('adminSellDescription').value;
            const username = document.getElementById('adminSellUsername').value;
            const password = document.getElementById('adminSellPassword').value;
            const imageFile = document.getElementById('adminSellImage').files[0];
            
            let imageData = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iIzM3NDE1MSIvPjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkdhbWUgQWNjb3VudDwvdGV4dD48L3N2Zz4=';
            
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    saveAdminProduct();
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveAdminProduct();
            }
            
            function saveAdminProduct() {
                const product = {
                    id: Date.now(),
                    game,
                    title: `TÃ i khoáº£n ${game} Premium`,
                    description,
                    price,
                    username,
                    password: CryptoJS.AES.encrypt(password, 'secret-key').toString(),
                    seller: 'admin@gameshop.vn',
                    status: 'approved', // Admin products are auto-approved
                    image: imageData,
                    createdAt: new Date().toISOString(),
                    approvedAt: new Date().toISOString(),
                    isAdminProduct: true
                };
                
                products.push(product);
                saveProducts();
                
                // Reset form
                document.getElementById('adminSellForm').reset();
                
                // Refresh displays
                loadFeaturedProducts();
                loadProducts();
                
                showToast('âœ… ÄÄƒng bÃ¡n thÃ nh cÃ´ng! Sáº£n pháº©m Ä‘Ã£ hiá»ƒn thá»‹ ngay trÃªn trang chá»§.', 'success');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('gameShopCurrentUser');
            cart = [];
            saveCart();
            updateUI();
            showToast('ÄÃ£ Ä‘Äƒng xuáº¥t thÃ nh cÃ´ng', 'success');
            showPage('home');
        }

        function viewProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-start mb-6">
                            <h3 class="text-2xl font-bold text-white">${product.title}</h3>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
                        </div>
                        <img src="${product.image}" alt="${product.title}" class="w-full h-64 object-cover rounded-lg mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <div class="text-gray-300 mb-2">Game:</div>
                                <div class="text-white font-semibold">${product.game}</div>
                            </div>
                            <div>
                                <div class="text-gray-300 mb-2">GiÃ¡:</div>
                                <div class="text-yellow-300 font-bold text-xl">${formatCurrency(product.price)}</div>
                            </div>
                        </div>
                        <div class="mb-6">
                            <div class="text-gray-300 mb-2">MÃ´ táº£:</div>
                            <div class="text-white">${product.description}</div>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="addToCart(${product.id}); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                ThÃªm vÃ o giá» hÃ ng
                            </button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                                ÄÃ³ng
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Security functions
        function generateSecurityCode() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        function logSecurityEvent(eventType, data) {
            const securityLogs = JSON.parse(localStorage.getItem('gameShopSecurityLogs') || '[]');
            const logEntry = {
                id: Date.now(),
                type: eventType,
                data: data,
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString(),
                ip: 'localhost' // In real app, this would be actual IP
            };
            
            securityLogs.push(logEntry);
            
            // Keep only last 1000 logs
            if (securityLogs.length > 1000) {
                securityLogs.splice(0, securityLogs.length - 1000);
            }
            
            localStorage.setItem('gameShopSecurityLogs', JSON.stringify(securityLogs));
        }

        function validateSession() {
            if (currentUser) {
                const lastActivity = localStorage.getItem('gameShopLastActivity');
                const now = Date.now();
                const sessionTimeout = 24 * 60 * 60 * 1000; // 24 hours
                
                if (lastActivity && (now - parseInt(lastActivity)) > sessionTimeout) {
                    logout();
                    showToast('PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i.', 'error');
                    return false;
                }
                
                localStorage.setItem('gameShopLastActivity', now.toString());
            }
            return true;
        }

        function encryptSensitiveData(data) {
            return CryptoJS.AES.encrypt(JSON.stringify(data), 'security-key-2024').toString();
        }

        function decryptSensitiveData(encryptedData) {
            try {
                const bytes = CryptoJS.AES.decrypt(encryptedData, 'security-key-2024');
                return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
            } catch (error) {
                return null;
            }
        }

        // Enhanced security checks
        function checkAccountSecurity() {
            if (!currentUser) return;
            
            const user = users.find(u => u.id === currentUser.id);
            if (!user) {
                logout();
                showToast('TÃ i khoáº£n khÃ´ng há»£p lá»‡. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i.', 'error');
                return;
            }
            
            // Check for suspicious activity
            const recentPurchases = JSON.parse(localStorage.getItem('gameShopPurchases') || '[]')
                .filter(p => p.userId === currentUser.id && 
                        (Date.now() - new Date(p.date).getTime()) < 60000); // Last minute
            
            if (recentPurchases.length > 5) {
                logSecurityEvent('suspicious_activity', {
                    userId: currentUser.id,
                    reason: 'too_many_purchases',
                    count: recentPurchases.length
                });
            }
        }

        // Message functions
        function loadMessages() {
            const container = document.getElementById('messagesContainer');
            const userMessages = messages.filter(m => 
                (m.senderId === currentUser.id && m.receiverId === 'admin') ||
                (m.senderId === 'admin' && m.receiverId === currentUser.id)
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            // Clear existing messages except welcome message
            container.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-yellow-600 rounded-full flex items-center justify-center text-sm">ğŸ‘‘</div>
                    <div class="bg-white/20 rounded-lg p-3 max-w-xs">
                        <div class="text-white text-sm">Xin chÃ o! TÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?</div>
                        <div class="text-gray-400 text-xs mt-1">HÃ´m nay</div>
                    </div>
                </div>
            `;
            
            userMessages.forEach(message => {
                const isFromUser = message.senderId === currentUser.id;
                const messageElement = document.createElement('div');
                messageElement.className = `flex items-start space-x-3 ${isFromUser ? 'flex-row-reverse space-x-reverse' : ''}`;
                
                messageElement.innerHTML = `
                    <div class="w-8 h-8 ${isFromUser ? 'bg-blue-600' : 'bg-yellow-600'} rounded-full flex items-center justify-center text-sm">
                        ${isFromUser ? 'ğŸ‘¤' : 'ğŸ‘‘'}
                    </div>
                    <div class="bg-white/20 rounded-lg p-3 max-w-xs">
                        <div class="text-white text-sm">${message.content}</div>
                        <div class="text-gray-400 text-xs mt-1">${formatMessageTime(message.timestamp)}</div>
                    </div>
                `;
                
                container.appendChild(messageElement);
            });
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
            
            // Mark messages as read
            markMessagesAsRead(currentUser.id);
        }

        function sendMessage(event) {
            event.preventDefault();
            
            const messageInput = document.getElementById('messageInput');
            const content = messageInput.value.trim();
            
            if (!content) return;
            
            const message = {
                id: Date.now(),
                senderId: currentUser.id,
                senderName: currentUser.name,
                senderEmail: currentUser.email,
                receiverId: 'admin',
                content: content,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            messages.push(message);
            saveMessages();
            
            // Add message to UI
            const container = document.getElementById('messagesContainer');
            const messageElement = document.createElement('div');
            messageElement.className = 'flex items-start space-x-3 flex-row-reverse space-x-reverse';
            
            messageElement.innerHTML = `
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-sm">ğŸ‘¤</div>
                <div class="bg-white/20 rounded-lg p-3 max-w-xs">
                    <div class="text-white text-sm">${content}</div>
                    <div class="text-gray-400 text-xs mt-1">Vá»«a xong</div>
                </div>
            `;
            
            container.appendChild(messageElement);
            container.scrollTop = container.scrollHeight;
            
            messageInput.value = '';
            
            // Auto-reply from admin (demo)
            setTimeout(() => {
                const autoReply = {
                    id: Date.now() + 1,
                    senderId: 'admin',
                    senderName: 'Admin',
                    senderEmail: 'admin@gameshop.vn',
                    receiverId: currentUser.id,
                    content: getAutoReply(content),
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                messages.push(autoReply);
                saveMessages();
                
                const replyElement = document.createElement('div');
                replyElement.className = 'flex items-start space-x-3';
                
                replyElement.innerHTML = `
                    <div class="w-8 h-8 bg-yellow-600 rounded-full flex items-center justify-center text-sm">ğŸ‘‘</div>
                    <div class="bg-white/20 rounded-lg p-3 max-w-xs">
                        <div class="text-white text-sm">${autoReply.content}</div>
                        <div class="text-gray-400 text-xs mt-1">Vá»«a xong</div>
                    </div>
                `;
                
                container.appendChild(replyElement);
                container.scrollTop = container.scrollHeight;
                
                updateMessageCount();
            }, 1000 + Math.random() * 2000);
        }

        function loadAdminMessages() {
            loadChatUsersList();
        }

        function loadChatUsersList() {
            const container = document.getElementById('chatUsersList');
            const regularUsers = users.filter(u => u.role !== 'admin');
            
            if (regularUsers.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">ChÆ°a cÃ³ ngÆ°á»i dÃ¹ng nÃ o</div>';
                return;
            }
            
            container.innerHTML = regularUsers.map(user => {
                const userMessages = messages.filter(m => 
                    m.senderId === user.id || m.receiverId === user.id
                );
                const unreadCount = messages.filter(m => 
                    m.senderId === user.id && m.receiverId === 'admin' && !m.read
                ).length;
                const lastMessage = userMessages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
                
                return `
                    <div onclick="selectChatUser(${user.id})" class="p-3 rounded-lg cursor-pointer hover:bg-white/10 transition-colors ${selectedChatUser?.id === user.id ? 'bg-white/20' : ''}">
                        <div class="flex items-center justify-between mb-1">
                            <div class="text-white font-semibold text-sm">${user.name}</div>
                            ${unreadCount > 0 ? `<span class="bg-red-500 text-white text-xs rounded-full px-2 py-1">${unreadCount}</span>` : ''}
                        </div>
                        <div class="text-gray-400 text-xs">${user.email}</div>
                        ${lastMessage ? `
                            <div class="text-gray-300 text-xs mt-1 truncate">
                                ${lastMessage.senderId === 'admin' ? 'Báº¡n: ' : ''}${lastMessage.content}
                            </div>
                            <div class="text-gray-500 text-xs">${formatMessageTime(lastMessage.timestamp)}</div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function selectChatUser(userId) {
            selectedChatUser = users.find(u => u.id === userId);
            if (!selectedChatUser) return;
            
            // Update UI
            document.getElementById('selectedUserName').textContent = selectedChatUser.name;
            document.getElementById('selectedUserEmail').textContent = selectedChatUser.email;
            
            document.getElementById('adminChatPlaceholder').classList.add('hidden');
            document.getElementById('adminChatHeader').classList.remove('hidden');
            document.getElementById('adminMessagesContainer').classList.remove('hidden');
            document.getElementById('adminMessageForm').classList.remove('hidden');
            
            // Load messages for this user
            loadAdminChatMessages(userId);
            
            // Mark messages as read
            markMessagesAsRead(userId);
            
            // Update users list
            loadChatUsersList();
        }

        function loadAdminChatMessages(userId) {
            const container = document.getElementById('adminMessagesContainer');
            const userMessages = messages.filter(m => 
                (m.senderId === userId && m.receiverId === 'admin') ||
                (m.senderId === 'admin' && m.receiverId === userId)
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            container.innerHTML = userMessages.map(message => {
                const isFromAdmin = message.senderId === 'admin';
                return `
                    <div class="flex items-start space-x-3 ${isFromAdmin ? 'flex-row-reverse space-x-reverse' : ''}">
                        <div class="w-8 h-8 ${isFromAdmin ? 'bg-yellow-600' : 'bg-blue-600'} rounded-full flex items-center justify-center text-sm">
                            ${isFromAdmin ? 'ğŸ‘‘' : 'ğŸ‘¤'}
                        </div>
                        <div class="bg-white/20 rounded-lg p-3 max-w-xs">
                            <div class="text-white text-sm">${message.content}</div>
                            <div class="text-gray-400 text-xs mt-1">${formatMessageTime(message.timestamp)}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.scrollTop = container.scrollHeight;
        }

        function sendAdminMessage(event) {
            event.preventDefault();
            
            if (!selectedChatUser) return;
            
            const messageInput = document.getElementById('adminMessageInput');
            const content = messageInput.value.trim();
            
            if (!content) return;
            
            const message = {
                id: Date.now(),
                senderId: 'admin',
                senderName: 'Admin',
                senderEmail: 'admin@gameshop.vn',
                receiverId: selectedChatUser.id,
                content: content,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            messages.push(message);
            saveMessages();
            
            // Add message to UI
            const container = document.getElementById('adminMessagesContainer');
            const messageElement = document.createElement('div');
            messageElement.className = 'flex items-start space-x-3 flex-row-reverse space-x-reverse';
            
            messageElement.innerHTML = `
                <div class="w-8 h-8 bg-yellow-600 rounded-full flex items-center justify-center text-sm">ğŸ‘‘</div>
                <div class="bg-white/20 rounded-lg p-3 max-w-xs">
                    <div class="text-white text-sm">${content}</div>
                    <div class="text-gray-400 text-xs mt-1">Vá»«a xong</div>
                </div>
            `;
            
            container.appendChild(messageElement);
            container.scrollTop = container.scrollHeight;
            
            messageInput.value = '';
            
            // Update users list to show latest message
            loadChatUsersList();
        }

        function markMessagesAsRead(userId) {
            let hasUnread = false;
            messages.forEach(message => {
                if (currentUser.role === 'admin') {
                    if (message.senderId === userId && message.receiverId === 'admin' && !message.read) {
                        message.read = true;
                        hasUnread = true;
                    }
                } else {
                    if (message.senderId === 'admin' && message.receiverId === userId && !message.read) {
                        message.read = true;
                        hasUnread = true;
                    }
                }
            });
            
            if (hasUnread) {
                saveMessages();
                updateMessageCount();
            }
        }

        function updateMessageCount() {
            if (!currentUser) return;
            
            let unreadCount = 0;
            
            if (currentUser.role === 'admin') {
                unreadCount = messages.filter(m => 
                    m.receiverId === 'admin' && !m.read
                ).length;
                
                const adminCountElement = document.getElementById('adminMessageCount');
                if (unreadCount > 0) {
                    adminCountElement.textContent = unreadCount;
                    adminCountElement.classList.remove('hidden');
                } else {
                    adminCountElement.classList.add('hidden');
                }
            } else {
                unreadCount = messages.filter(m => 
                    m.receiverId === currentUser.id && m.senderId === 'admin' && !m.read
                ).length;
            }
            
            const messageCountElement = document.getElementById('messageCount');
            if (unreadCount > 0) {
                messageCountElement.textContent = unreadCount;
                messageCountElement.classList.remove('hidden');
            } else {
                messageCountElement.classList.add('hidden');
            }
        }

        function formatMessageTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffInHours = (now - date) / (1000 * 60 * 60);
            
            if (diffInHours < 1) {
                return 'Vá»«a xong';
            } else if (diffInHours < 24) {
                return `${Math.floor(diffInHours)} giá» trÆ°á»›c`;
            } else {
                return date.toLocaleDateString('vi-VN');
            }
        }

        function getAutoReply(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('giÃ¡') || message.includes('bao nhiÃªu')) {
                return 'GiÃ¡ cá»§a cÃ¡c tÃ i khoáº£n Ä‘Æ°á»£c niÃªm yáº¿t rÃµ rÃ ng. Báº¡n cÃ³ thá»ƒ xem chi tiáº¿t trong danh má»¥c sáº£n pháº©m.';
            } else if (message.includes('náº¡p tiá»n') || message.includes('thanh toÃ¡n')) {
                return 'Báº¡n cÃ³ thá»ƒ náº¡p tiá»n qua má»¥c "Náº¡p tiá»n" trong trang cÃ¡ nhÃ¢n. ChÃºng tÃ´i há»— trá»£ nhiá»u phÆ°Æ¡ng thá»©c thanh toÃ¡n.';
            } else if (message.includes('báº£o hÃ nh') || message.includes('Ä‘á»•i tráº£')) {
                return 'Táº¥t cáº£ tÃ i khoáº£n Ä‘á»u Ä‘Æ°á»£c báº£o hÃ nh. Náº¿u cÃ³ váº¥n Ä‘á», vui lÃ²ng liÃªn há»‡ ngay Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£.';
            } else if (message.includes('xin chÃ o') || message.includes('hello')) {
                return 'Xin chÃ o! Cáº£m Æ¡n báº¡n Ä‘Ã£ liÃªn há»‡. TÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?';
            } else if (message.includes('cáº£m Æ¡n') || message.includes('thanks')) {
                return 'KhÃ´ng cÃ³ gÃ¬! Ráº¥t vui Ä‘Æ°á»£c há»— trá»£ báº¡n. ChÃºc báº¡n cÃ³ tráº£i nghiá»‡m tuyá»‡t vá»i!';
            } else {
                return 'Cáº£m Æ¡n báº¡n Ä‘Ã£ liÃªn há»‡! TÃ´i Ä‘Ã£ ghi nháº­n yÃªu cáº§u vÃ  sáº½ pháº£n há»“i sá»›m nháº¥t cÃ³ thá»ƒ.';
            }
        }

        // Withdrawal functions
        function loadWithdrawTab() {
            updateAdminBalance();
            loadWithdrawalHistory();
        }

        function updateAdminBalance() {
            const adminUser = users.find(u => u.email === 'admin@gameshop.vn');
            const balance = adminUser ? adminUser.balance : 0;
            document.getElementById('adminCurrentBalance').textContent = formatCurrency(balance);
        }

        function setWithdrawAmount(amount) {
            document.getElementById('withdrawAmount').value = amount;
        }

        function setWithdrawAllAmount() {
            const adminUser = users.find(u => u.email === 'admin@gameshop.vn');
            const balance = adminUser ? adminUser.balance : 0;
            document.getElementById('withdrawAmount').value = balance;
        }

        function handleWithdraw(event) {
            event.preventDefault();
            
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const bank = document.getElementById('withdrawBank').value;
            const accountNumber = document.getElementById('withdrawAccountNumber').value;
            const accountName = document.getElementById('withdrawAccountName').value;
            const note = document.getElementById('withdrawNote').value;
            
            const adminUser = users.find(u => u.email === 'admin@gameshop.vn');
            
            if (!adminUser) {
                showToast('KhÃ´ng tÃ¬m tháº¥y tÃ i khoáº£n admin', 'error');
                return;
            }
            
            if (amount > adminUser.balance) {
                showToast('Sá»‘ dÆ° khÃ´ng Ä‘á»§ Ä‘á»ƒ thá»±c hiá»‡n giao dá»‹ch', 'error');
                return;
            }
            
            if (amount < 50000) {
                showToast('Sá»‘ tiá»n rÃºt tá»‘i thiá»ƒu lÃ  50,000 VNÄ', 'error');
                return;
            }
            
            // Create confirmation modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
                    <h3 class="text-2xl font-bold text-white mb-4 text-center">ğŸ¦ XÃ¡c nháº­n rÃºt tiá»n</h3>
                    <div class="text-gray-300 mb-6">
                        <div class="bg-white/5 rounded-lg p-4 space-y-2">
                            <div class="flex justify-between">
                                <span>Sá»‘ tiá»n:</span>
                                <span class="text-yellow-300 font-bold">${formatCurrency(amount)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>NgÃ¢n hÃ ng:</span>
                                <span class="text-white">${getBankName(bank)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Sá»‘ TK:</span>
                                <span class="text-white font-mono">${accountNumber}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Chá»§ TK:</span>
                                <span class="text-white">${accountName}</span>
                            </div>
                        </div>
                        <p class="text-yellow-300 text-sm mt-4 text-center">âš ï¸ Vui lÃ²ng kiá»ƒm tra ká»¹ thÃ´ng tin trÆ°á»›c khi xÃ¡c nháº­n</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            Há»§y
                        </button>
                        <button onclick="confirmWithdraw(${amount}, '${bank}', '${accountNumber}', '${accountName}', '${note}'); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            XÃ¡c nháº­n
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmWithdraw(amount, bank, accountNumber, accountName, note) {
            const adminUser = users.find(u => u.email === 'admin@gameshop.vn');
            
            // Deduct money from admin balance
            adminUser.balance -= amount;
            
            // Update current user if it's admin
            if (currentUser && currentUser.email === 'admin@gameshop.vn') {
                currentUser.balance = adminUser.balance;
                saveCurrentUser();
                updateUI();
            }
            
            // Create withdrawal record
            const withdrawal = {
                id: Date.now(),
                amount: amount,
                bank: bank,
                bankName: getBankName(bank),
                accountNumber: accountNumber,
                accountName: accountName,
                note: note,
                status: 'processing',
                createdAt: new Date().toISOString(),
                processedAt: null,
                adminId: currentUser.id,
                adminEmail: currentUser.email
            };
            
            withdrawals.push(withdrawal);
            
            // Save data
            saveUsers();
            saveWithdrawals();
            
            // Reset form
            document.getElementById('withdrawForm').reset();
            
            // Update displays
            updateAdminBalance();
            loadWithdrawalHistory();
            
            showToast(`âœ… ÄÃ£ táº¡o lá»‡nh rÃºt ${formatCurrency(amount)} thÃ nh cÃ´ng! Giao dá»‹ch sáº½ Ä‘Æ°á»£c xá»­ lÃ½ trong 1-3 ngÃ y lÃ m viá»‡c.`, 'success');
            
            // Auto-complete withdrawal after 5 seconds (demo)
            setTimeout(() => {
                const withdrawalIndex = withdrawals.findIndex(w => w.id === withdrawal.id);
                if (withdrawalIndex !== -1) {
                    withdrawals[withdrawalIndex].status = 'completed';
                    withdrawals[withdrawalIndex].processedAt = new Date().toISOString();
                    saveWithdrawals();
                    loadWithdrawalHistory();
                    showToast(`ğŸ’° Giao dá»‹ch rÃºt ${formatCurrency(amount)} Ä‘Ã£ hoÃ n táº¥t!`, 'success');
                }
            }, 5000);
        }

        function getBankName(bankCode) {
            const banks = {
                'vietcombank': 'Vietcombank',
                'techcombank': 'Techcombank', 
                'bidv': 'BIDV',
                'vietinbank': 'VietinBank',
                'agribank': 'Agribank',
                'mbbank': 'MB Bank',
                'acb': 'ACB',
                'tpbank': 'TPBank',
                'sacombank': 'Sacombank',
                'vpbank': 'VPBank'
            };
            return banks[bankCode] || bankCode;
        }

        function loadWithdrawalHistory() {
            const container = document.getElementById('withdrawalHistory');
            const adminWithdrawals = withdrawals.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (adminWithdrawals.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">ChÆ°a cÃ³ lá»‹ch sá»­ rÃºt tiá»n</div>';
                return;
            }
            
            container.innerHTML = adminWithdrawals.map(withdrawal => `
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <div class="text-white font-semibold">Lá»‡nh rÃºt #${withdrawal.id}</div>
                                <span class="px-2 py-1 rounded text-xs ${
                                    withdrawal.status === 'completed' ? 'bg-green-600 text-white' :
                                    withdrawal.status === 'processing' ? 'bg-yellow-600 text-white' :
                                    'bg-red-600 text-white'
                                }">
                                    ${
                                        withdrawal.status === 'completed' ? 'âœ… HoÃ n thÃ nh' :
                                        withdrawal.status === 'processing' ? 'â³ Äang xá»­ lÃ½' :
                                        'âŒ Tháº¥t báº¡i'
                                    }
                                </span>
                            </div>
                            <div class="text-yellow-300 font-bold text-lg mb-2">${formatCurrency(withdrawal.amount)}</div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                <div class="text-gray-300">
                                    <span class="text-gray-400">NgÃ¢n hÃ ng:</span> ${withdrawal.bankName}
                                </div>
                                <div class="text-gray-300">
                                    <span class="text-gray-400">Sá»‘ TK:</span> ${withdrawal.accountNumber}
                                </div>
                                <div class="text-gray-300">
                                    <span class="text-gray-400">Chá»§ TK:</span> ${withdrawal.accountName}
                                </div>
                                <div class="text-gray-300">
                                    <span class="text-gray-400">Táº¡o lÃºc:</span> ${new Date(withdrawal.createdAt).toLocaleString('vi-VN')}
                                </div>
                                ${withdrawal.processedAt ? `
                                    <div class="text-green-300">
                                        <span class="text-gray-400">HoÃ n thÃ nh:</span> ${new Date(withdrawal.processedAt).toLocaleString('vi-VN')}
                                    </div>
                                ` : ''}
                            </div>
                            ${withdrawal.note ? `
                                <div class="text-gray-400 text-sm mt-2">
                                    <span class="text-gray-500">Ghi chÃº:</span> ${withdrawal.note}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    ${withdrawal.status === 'processing' ? `
                        <div class="flex space-x-2 mt-3">
                            <button onclick="completeWithdrawal(${withdrawal.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                âœ… ÄÃ¡nh dáº¥u hoÃ n thÃ nh
                            </button>
                            <button onclick="cancelWithdrawal(${withdrawal.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                âŒ Há»§y giao dá»‹ch
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function completeWithdrawal(withdrawalId) {
            const withdrawalIndex = withdrawals.findIndex(w => w.id === withdrawalId);
            if (withdrawalIndex !== -1) {
                withdrawals[withdrawalIndex].status = 'completed';
                withdrawals[withdrawalIndex].processedAt = new Date().toISOString();
                saveWithdrawals();
                loadWithdrawalHistory();
                showToast('âœ… ÄÃ£ Ä‘Ã¡nh dáº¥u giao dá»‹ch hoÃ n thÃ nh', 'success');
            }
        }

        function cancelWithdrawal(withdrawalId) {
            const withdrawal = withdrawals.find(w => w.id === withdrawalId);
            if (withdrawal && withdrawal.status === 'processing') {
                // Refund money to admin
                const adminUser = users.find(u => u.email === 'admin@gameshop.vn');
                if (adminUser) {
                    adminUser.balance += withdrawal.amount;
                    
                    // Update current user if it's admin
                    if (currentUser && currentUser.email === 'admin@gameshop.vn') {
                        currentUser.balance = adminUser.balance;
                        saveCurrentUser();
                        updateUI();
                    }
                }
                
                // Update withdrawal status
                const withdrawalIndex = withdrawals.findIndex(w => w.id === withdrawalId);
                withdrawals[withdrawalIndex].status = 'cancelled';
                withdrawals[withdrawalIndex].cancelledAt = new Date().toISOString();
                
                saveUsers();
                saveWithdrawals();
                updateAdminBalance();
                loadWithdrawalHistory();
                
                showToast(`âŒ ÄÃ£ há»§y giao dá»‹ch vÃ  hoÃ n ${formatCurrency(withdrawal.amount)} vÃ o tÃ i khoáº£n`, 'success');
            }
        }

        // Security management functions
        function loadSecurityTab() {
            updateSecurityOverview();
            showSecurityTab('alerts');
        }

        function updateSecurityOverview() {
            cleanExpiredThrottleData();
            
            // Count blocked IPs
            const activeBlockedIPs = Object.keys(blockedIPs).filter(ip => 
                blockedIPs[ip] && !blockedIPs[ip].unblocked && isIPBlocked(ip)
            ).length;
            
            // Count unacknowledged alerts
            const unacknowledgedAlerts = securityAlerts.filter(alert => !alert.acknowledged).length;
            
            // Count failed attempts today
            const today = new Date().toDateString();
            const securityLogs = JSON.parse(localStorage.getItem('gameShopSecurityLogs') || '[]');
            const todayFailedAttempts = securityLogs.filter(log => 
                log.type === 'failed_login' && 
                new Date(log.timestamp).toDateString() === today
            ).length;
            
            document.getElementById('blockedIPCount').textContent = activeBlockedIPs;
            document.getElementById('securityAlertCountDisplay').textContent = unacknowledgedAlerts;
            document.getElementById('totalFailedAttempts').textContent = todayFailedAttempts;
            
            // Update alert badge
            const alertBadge = document.getElementById('securityAlertCount');
            if (unacknowledgedAlerts > 0) {
                alertBadge.textContent = unacknowledgedAlerts;
                alertBadge.classList.remove('hidden');
            } else {
                alertBadge.classList.add('hidden');
            }
        }

        function showSecurityTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.security-tab-btn').forEach(btn => {
                btn.classList.remove('bg-red-600', 'bg-blue-600', 'bg-green-600');
                btn.classList.add('bg-white/20');
            });
            event.target.classList.remove('bg-white/20');
            event.target.classList.add('bg-red-600');
            
            // Hide all security tabs
            document.querySelectorAll('.security-tab').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab
            document.getElementById('security' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab').classList.remove('hidden');
            
            // Load tab data
            switch(tabName) {
                case 'alerts':
                    loadSecurityAlerts();
                    break;
                case 'blocked':
                    loadBlockedIPs();
                    break;
                case 'logs':
                    loadSecurityLogs();
                    break;
                case 'settings':
                    // Settings tab is static
                    break;
            }
        }

        function loadSecurityAlerts() {
            const container = document.getElementById('securityAlertsList');
            const sortedAlerts = securityAlerts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            if (sortedAlerts.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">KhÃ´ng cÃ³ cáº£nh bÃ¡o báº£o máº­t nÃ o</div>';
                return;
            }
            
            container.innerHTML = sortedAlerts.map(alert => `
                <div class="bg-white/5 rounded-lg p-4 border-l-4 ${alert.acknowledged ? 'border-gray-500' : 'border-red-500'} ${alert.acknowledged ? 'opacity-75' : ''}">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <div class="text-white font-semibold">${getAlertTypeIcon(alert.type)} ${getAlertTypeText(alert.type)}</div>
                                ${alert.acknowledged ? 
                                    '<span class="bg-gray-600 text-white px-2 py-1 rounded text-xs">âœ… ÄÃ£ xá»­ lÃ½</span>' :
                                    '<span class="bg-red-600 text-white px-2 py-1 rounded text-xs">ğŸš¨ Má»›i</span>'
                                }
                            </div>
                            <div class="text-gray-300 text-sm mb-2">${alert.reason}</div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm">
                                <div>
                                    <span class="text-gray-400">IP:</span>
                                    <span class="text-white font-mono">${alert.ip}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Láº§n thá»­:</span>
                                    <span class="text-red-300 font-bold">${alert.attemptCount}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Thá»i gian:</span>
                                    <span class="text-white">${new Date(alert.timestamp).toLocaleString('vi-VN')}</span>
                                </div>
                            </div>
                            ${alert.lastAttemptedEmail ? `
                                <div class="text-sm mt-2">
                                    <span class="text-gray-400">Email cuá»‘i:</span>
                                    <span class="text-yellow-300">${alert.lastAttemptedEmail}</span>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex space-x-2">
                            ${!alert.acknowledged ? `
                                <button onclick="acknowledgeAlert(${alert.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    âœ… Xá»­ lÃ½
                                </button>
                            ` : ''}
                            <button onclick="viewAlertDetails(${alert.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                ğŸ‘ï¸ Chi tiáº¿t
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadBlockedIPs() {
            const container = document.getElementById('blockedIPsList');
            cleanExpiredThrottleData();
            
            const activeBlocks = Object.keys(blockedIPs).filter(ip => 
                blockedIPs[ip] && !blockedIPs[ip].unblocked
            );
            
            if (activeBlocks.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">KhÃ´ng cÃ³ IP nÃ o bá»‹ cháº·n</div>';
                return;
            }
            
            container.innerHTML = activeBlocks.map(ip => {
                const blockInfo = blockedIPs[ip];
                const isCurrentlyBlocked = isIPBlocked(ip);
                const status = getIPStatus(ip);
                
                return `
                    <div class="bg-white/5 rounded-lg p-4 border-l-4 ${isCurrentlyBlocked ? 'border-red-500' : 'border-gray-500'}">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <div class="text-white font-mono text-lg">${ip}</div>
                                    ${isCurrentlyBlocked ? 
                                        '<span class="bg-red-600 text-white px-2 py-1 rounded text-xs">ğŸ”’ Äang cháº·n</span>' :
                                        '<span class="bg-gray-600 text-white px-2 py-1 rounded text-xs">â° Háº¿t háº¡n</span>'
                                    }
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <div class="text-gray-400">LÃ½ do:</div>
                                        <div class="text-white">${blockInfo.reason}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-400">Láº§n thá»­:</div>
                                        <div class="text-red-300 font-bold">${blockInfo.attemptCount} láº§n</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-400">Cháº·n lÃºc:</div>
                                        <div class="text-white">${new Date(blockInfo.blockedAt).toLocaleString('vi-VN')}</div>
                                    </div>
                                    ${isCurrentlyBlocked ? `
                                        <div>
                                            <div class="text-gray-400">CÃ²n láº¡i:</div>
                                            <div class="text-yellow-300 font-bold">${Math.ceil(status.timeUntilUnblock / 1000 / 60)} phÃºt</div>
                                        </div>
                                    ` : `
                                        <div>
                                            <div class="text-gray-400">Tráº¡ng thÃ¡i:</div>
                                            <div class="text-gray-400">ÄÃ£ háº¿t háº¡n tá»± Ä‘á»™ng</div>
                                        </div>
                                    `}
                                </div>
                                ${blockInfo.lastAttemptedEmail ? `
                                    <div class="text-sm mt-2">
                                        <span class="text-gray-400">Email cuá»‘i:</span>
                                        <span class="text-yellow-300">${blockInfo.lastAttemptedEmail}</span>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex space-x-2">
                                ${isCurrentlyBlocked ? `
                                    <button onclick="unblockIPManual('${ip}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                        ğŸ”“ Má»Ÿ cháº·n
                                    </button>
                                ` : ''}
                                <button onclick="viewIPHistory('${ip}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    ğŸ“‹ Lá»‹ch sá»­
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadSecurityLogs(filter = 'all') {
            const container = document.getElementById('securityLogsList');
            const securityLogs = JSON.parse(localStorage.getItem('gameShopSecurityLogs') || '[]');
            
            let filteredLogs = securityLogs;
            if (filter !== 'all') {
                filteredLogs = securityLogs.filter(log => log.type === filter);
            }
            
            const sortedLogs = filteredLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 100);
            
            if (sortedLogs.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">KhÃ´ng cÃ³ nháº­t kÃ½ nÃ o</div>';
                return;
            }
            
            container.innerHTML = sortedLogs.map(log => `
                <div class="bg-white/5 rounded-lg p-3 border-l-4 ${getLogBorderColor(log.type)}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <div class="text-white font-semibold">${getLogTypeIcon(log.type)} ${getLogTypeText(log.type)}</div>
                                <div class="text-gray-400 text-xs">${new Date(log.timestamp).toLocaleString('vi-VN')}</div>
                            </div>
                            <div class="text-gray-300 text-sm">
                                ${formatLogData(log)}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getAlertTypeIcon(type) {
            const icons = {
                'IP_BLOCKED': 'ğŸš¨',
                'SUSPICIOUS_ACTIVITY': 'âš ï¸',
                'SECURITY_BREACH': 'ğŸ”¥'
            };
            return icons[type] || 'ğŸ“‹';
        }

        function getAlertTypeText(type) {
            const texts = {
                'IP_BLOCKED': 'IP bá»‹ cháº·n',
                'SUSPICIOUS_ACTIVITY': 'Hoáº¡t Ä‘á»™ng Ä‘Ã¡ng ngá»',
                'SECURITY_BREACH': 'Vi pháº¡m báº£o máº­t'
            };
            return texts[type] || type;
        }

        function getLogTypeIcon(type) {
            const icons = {
                'login': 'âœ…',
                'failed_login': 'âŒ',
                'ip_blocked': 'ğŸš¨',
                'ip_unblocked': 'ğŸ”“',
                'password_reset': 'ğŸ”‘',
                'purchase': 'ğŸ’°'
            };
            return icons[type] || 'ğŸ“‹';
        }

        function getLogTypeText(type) {
            const texts = {
                'login': 'ÄÄƒng nháº­p thÃ nh cÃ´ng',
                'failed_login': 'ÄÄƒng nháº­p tháº¥t báº¡i',
                'ip_blocked': 'IP bá»‹ cháº·n',
                'ip_unblocked': 'IP Ä‘Æ°á»£c má»Ÿ cháº·n',
                'password_reset': 'Äáº·t láº¡i máº­t kháº©u',
                'purchase': 'Mua hÃ ng'
            };
            return texts[type] || type;
        }

        function getLogBorderColor(type) {
            const colors = {
                'login': 'border-green-500',
                'failed_login': 'border-red-500',
                'ip_blocked': 'border-red-600',
                'ip_unblocked': 'border-green-600',
                'password_reset': 'border-yellow-500',
                'purchase': 'border-blue-500'
            };
            return colors[type] || 'border-gray-500';
        }

        function formatLogData(log) {
            let result = '';
            if (log.data.email) result += `Email: ${log.data.email} `;
            if (log.data.ip) result += `IP: ${log.data.ip} `;
            if (log.data.userId) result += `User ID: ${log.data.userId} `;
            if (log.data.attemptCount) result += `Láº§n thá»­: ${log.data.attemptCount} `;
            if (log.data.blocked) result += `Bá»‹ cháº·n: ${log.data.blocked ? 'CÃ³' : 'KhÃ´ng'} `;
            if (log.data.unblockedBy) result += `Má»Ÿ cháº·n bá»Ÿi: ${log.data.unblockedBy} `;
            return result || 'KhÃ´ng cÃ³ thÃ´ng tin chi tiáº¿t';
        }

        function acknowledgeAlert(alertId) {
            const alertIndex = securityAlerts.findIndex(alert => alert.id === alertId);
            if (alertIndex !== -1) {
                securityAlerts[alertIndex].acknowledged = true;
                securityAlerts[alertIndex].acknowledgedAt = new Date().toISOString();
                securityAlerts[alertIndex].acknowledgedBy = currentUser.email;
                
                saveIPThrottleData();
                loadSecurityAlerts();
                updateSecurityOverview();
                
                showToast('âœ… ÄÃ£ xá»­ lÃ½ cáº£nh bÃ¡o báº£o máº­t', 'success');
            }
        }

        function unblockIPManual(ip) {
            if (unblockIP(ip)) {
                loadBlockedIPs();
                updateSecurityOverview();
                showToast(`ğŸ”“ ÄÃ£ má»Ÿ cháº·n IP ${ip}`, 'success');
            } else {
                showToast('KhÃ´ng thá»ƒ má»Ÿ cháº·n IP nÃ y', 'error');
            }
        }

        function manualBlockIP(event) {
            event.preventDefault();
            
            const ip = document.getElementById('manualBlockIPInput').value;
            const reason = document.getElementById('manualBlockReason').value;
            
            // Check if IP is already blocked
            if (isIPBlocked(ip)) {
                showToast('IP nÃ y Ä‘Ã£ bá»‹ cháº·n rá»“i', 'error');
                return;
            }
            
            // Block the IP manually
            blockedIPs[ip] = {
                blockedAt: Date.now(),
                reason: reason,
                attemptCount: 0,
                lastAttemptedEmail: '',
                unblocked: false,
                manualBlock: true,
                blockedBy: currentUser.email
            };
            
            // Create security alert
            const alert = {
                id: Date.now(),
                type: 'IP_BLOCKED',
                ip: ip,
                reason: `Manual block: ${reason}`,
                attemptCount: 0,
                lastAttemptedEmail: '',
                timestamp: new Date().toISOString(),
                acknowledged: false,
                manualBlock: true
            };
            
            securityAlerts.push(alert);
            
            // Log security event
            logSecurityEvent('ip_blocked', {
                ip: ip,
                reason: reason,
                manualBlock: true,
                blockedBy: currentUser.email,
                timestamp: new Date().toISOString()
            });
            
            saveIPThrottleData();
            
            // Reset form
            document.getElementById('manualBlockIPInput').value = '';
            document.getElementById('manualBlockReason').value = '';
            
            // Refresh displays
            loadBlockedIPs();
            updateSecurityOverview();
            
            showToast(`ğŸš« ÄÃ£ cháº·n IP ${ip} thá»§ cÃ´ng`, 'success');
        }

        function filterSecurityLogs(filter) {
            // Update filter buttons
            document.querySelectorAll('.log-filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-white/20');
            });
            event.target.classList.remove('bg-white/20');
            event.target.classList.add('bg-blue-600');
            
            loadSecurityLogs(filter);
        }

        // Jiro file management functions
        function loadJiroTab() {
            updateJiroFileStats();
            loadRecentJiroEntries();
        }

        function updateJiroFileStats() {
            const jiroContent = JSON.parse(localStorage.getItem('jiroFileContent') || '[]');
            
            document.getElementById('jiroAccountCount').textContent = jiroContent.length;
            
            if (jiroContent.length > 0) {
                const lastEntry = jiroContent[jiroContent.length - 1];
                document.getElementById('jiroLastUpdate').textContent = new Date(lastEntry.createdAt).toLocaleString('vi-VN');
            } else {
                document.getElementById('jiroLastUpdate').textContent = 'ChÆ°a cÃ³ dá»¯ liá»‡u';
            }
        }

        function loadRecentJiroEntries() {
            const jiroContent = JSON.parse(localStorage.getItem('jiroFileContent') || '[]');
            const recentEntries = jiroContent.slice(-5).reverse(); // Get last 5 entries
            
            const container = document.getElementById('recentJiroEntries');
            
            if (recentEntries.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-4">ChÆ°a cÃ³ dá»¯ liá»‡u nÃ o trong file jiro.txt</div>';
                return;
            }
            
            container.innerHTML = recentEntries.map(entry => `
                <div class="bg-white/5 rounded-lg p-4 border-l-4 border-green-500">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-white font-semibold">${entry.email}</div>
                        <div class="text-gray-400 text-xs">${new Date(entry.createdAt).toLocaleString('vi-VN')}</div>
                    </div>
                    <div class="text-gray-300 text-sm mb-2">
                        <span class="text-gray-400">Hash Type:</span> ${entry.hashType}
                    </div>
                    <div class="text-green-300 font-mono text-xs bg-black/30 p-2 rounded break-all">
                        ${entry.passwordHash.substring(0, 50)}...
                    </div>
                    <div class="text-gray-400 text-xs mt-2">
                        Nguá»“n: ${entry.source}
                    </div>
                </div>
            `).join('');
        }

        function clearJiroFile() {
            const jiroContent = JSON.parse(localStorage.getItem('jiroFileContent') || '[]');
            
            if (jiroContent.length === 0) {
                showToast('File jiro.txt Ä‘Ã£ trá»‘ng', 'error');
                return;
            }
            
            // Create confirmation modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
                    <h3 class="text-2xl font-bold text-white mb-4 text-center">âš ï¸ XÃ¡c nháº­n xÃ³a file</h3>
                    <div class="text-gray-300 mb-6 text-center">
                        <p class="mb-3">Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a toÃ n bá»™ ná»™i dung file jiro.txt?</p>
                        <div class="bg-red-900/30 border border-red-500/30 rounded-lg p-3">
                            <p class="text-red-300 text-sm font-semibold">ğŸš¨ Cáº¢NH BÃO:</p>
                            <p class="text-red-200 text-sm">â€¢ Sáº½ xÃ³a ${jiroContent.length} má»¥c dá»¯ liá»‡u</p>
                            <p class="text-red-200 text-sm">â€¢ HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c</p>
                            <p class="text-red-200 text-sm">â€¢ Táº¥t cáº£ máº­t kháº©u bÄƒm sáº½ bá»‹ máº¥t</p>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            Há»§y
                        </button>
                        <button onclick="confirmClearJiroFile(); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            XÃ³a toÃ n bá»™
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmClearJiroFile() {
            const jiroContent = JSON.parse(localStorage.getItem('jiroFileContent') || '[]');
            const deletedCount = jiroContent.length;
            
            // Clear the file content
            localStorage.setItem('jiroFileContent', '[]');
            localStorage.setItem('jiroFileText', '');
            
            // Update UI
            updateJiroFileStats();
            loadRecentJiroEntries();
            
            showToast(`ğŸ—‘ï¸ ÄÃ£ xÃ³a ${deletedCount} má»¥c dá»¯ liá»‡u khá»i file jiro.txt`, 'success');
        }

        // VietQR Functions
        function generateVietQRPayment(amount, note) {
            // Check rate limit (5 requests per user per minute)
            const userId = currentUser.id;
            const now = Date.now();
            const oneMinute = 60 * 1000;
            
            if (!vietqrRateLimit[userId]) {
                vietqrRateLimit[userId] = [];
            }
            
            // Clean old requests
            vietqrRateLimit[userId] = vietqrRateLimit[userId].filter(time => (now - time) < oneMinute);
            
            if (vietqrRateLimit[userId].length >= 5) {
                showToast('Báº¡n Ä‘Ã£ táº¡o quÃ¡ nhiá»u mÃ£ QR. Vui lÃ²ng Ä‘á»£i 1 phÃºt.', 'error');
                return;
            }
            
            // Add current request
            vietqrRateLimit[userId].push(now);
            localStorage.setItem('vietqrRateLimit', JSON.stringify(vietqrRateLimit));
            
            // Generate order ID
            const orderId = 'NAP' + Date.now().toString().slice(-6);
            
            // Create VietQR order
            currentVietQROrder = {
                id: orderId,
                userId: currentUser.id,
                userEmail: currentUser.email,
                userName: currentUser.name,
                amount: amount,
                note: note,
                status: 'pending',
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 15 * 60 * 1000).toISOString(), // 15 minutes
                qrGenerated: true
            };
            
            // Save to recharges for admin tracking
            recharges.push({
                ...currentVietQROrder,
                method: 'vietqr'
            });
            saveRecharges();
            
            // Log VietQR generation
            logSecurityEvent('vietqr_generated', {
                orderId: orderId,
                userId: currentUser.id,
                amount: amount,
                timestamp: new Date().toISOString()
            });
            
            // Hide recharge form and show VietQR modal
            hideRechargeForm();
            showVietQRModal(currentVietQROrder);
        }

        function showVietQRModal(order) {
            // Update modal content
            document.getElementById('vietqrAmount').textContent = formatCurrency(order.amount);
            document.getElementById('vietqrOrderId').textContent = order.id;
            document.getElementById('vietqrContent').textContent = order.id;
            
            // Generate QR code
            generateQRCode(order);
            
            // Show modal
            document.getElementById('vietqrModal').classList.remove('hidden');
            document.getElementById('vietqrModal').classList.add('flex');
            
            // Start timer
            startVietQRTimer();
            
            // Start checking for payment
            startPaymentCheck(order.id);
            
            showToast('ğŸ¦ MÃ£ QR VietQR Ä‘Ã£ Ä‘Æ°á»£c táº¡o! QuÃ©t Ä‘á»ƒ thanh toÃ¡n.', 'success');
        }

        function generateQRCode(order) {
            // Simulate VietQR API call
            const qrContainer = document.getElementById('vietqrCode');
            qrContainer.innerHTML = '<div class="text-gray-500">Äang táº¡o mÃ£ QR...</div>';
            
            // Simulate API delay
            setTimeout(() => {
                // Create VietQR payload (simplified)
                const vietqrPayload = {
                    accountNo: '1038189785',
                    accountName: 'GAMESHOP VIETNAM',
                    acqId: '970436', // Vietcombank
                    amount: order.amount,
                    addInfo: order.id,
                    format: 'text',
                    template: 'compact'
                };
                
                // Generate QR using simulated API
                const qrData = generateVietQRData(vietqrPayload);
                
                // Create QR code image (using a placeholder for demo)
                const qrImage = createQRImage(qrData);
                qrContainer.innerHTML = qrImage;
                
                // Log successful QR generation
                console.log('ğŸ¦ VietQR Generated:', {
                    orderId: order.id,
                    amount: order.amount,
                    payload: qrData
                });
                
            }, 1500);
        }

        function generateVietQRData(payload) {
            // Simplified VietQR data generation (in real app, use proper VietQR library)
            const qrString = `00020101021238570010A00000072701270006970436011${payload.accountNo}02${payload.addInfo.length.toString().padStart(2, '0')}${payload.addInfo}0303${payload.amount}5802VN62${payload.accountName.length.toString().padStart(2, '0')}${payload.accountName}6304`;
            
            // Add checksum (simplified)
            const checksum = calculateChecksum(qrString);
            return qrString + checksum;
        }

        function calculateChecksum(data) {
            // Simplified checksum calculation
            let sum = 0;
            for (let i = 0; i < data.length; i++) {
                sum += data.charCodeAt(i);
            }
            return (sum % 10000).toString().padStart(4, '0');
        }

        function createQRImage(qrData) {
            // Create a visual QR code representation
            const size = 200;
            const cellSize = 4;
            const cells = size / cellSize;
            
            // Generate a pattern based on QR data (simplified visualization)
            let pattern = '';
            for (let i = 0; i < qrData.length; i++) {
                pattern += qrData.charCodeAt(i) % 2 ? '1' : '0';
            }
            
            // Create SVG QR code
            let svg = `<svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">`;
            svg += `<rect width="${size}" height="${size}" fill="white"/>`;
            
            // Add QR pattern
            for (let y = 0; y < cells; y++) {
                for (let x = 0; x < cells; x++) {
                    const index = (y * cells + x) % pattern.length;
                    if (pattern[index] === '1') {
                        svg += `<rect x="${x * cellSize}" y="${y * cellSize}" width="${cellSize}" height="${cellSize}" fill="black"/>`;
                    }
                }
            }
            
            // Add corner markers
            const markerSize = cellSize * 7;
            const positions = [[0, 0], [size - markerSize, 0], [0, size - markerSize]];
            
            positions.forEach(([x, y]) => {
                svg += `<rect x="${x}" y="${y}" width="${markerSize}" height="${markerSize}" fill="black"/>`;
                svg += `<rect x="${x + cellSize}" y="${y + cellSize}" width="${markerSize - 2 * cellSize}" height="${markerSize - 2 * cellSize}" fill="white"/>`;
                svg += `<rect x="${x + 2 * cellSize}" y="${y + 2 * cellSize}" width="${markerSize - 4 * cellSize}" height="${markerSize - 4 * cellSize}" fill="black"/>`;
            });
            
            svg += '</svg>';
            
            return svg;
        }

        function startVietQRTimer() {
            let timeLeft = 15 * 60; // 15 minutes in seconds
            
            const updateTimer = () => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('vietqrTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(vietqrTimer);
                    expireVietQR();
                    return;
                }
                
                // Change color when time is running out
                const timerElement = document.getElementById('vietqrTimer');
                if (timeLeft <= 300) { // 5 minutes
                    timerElement.classList.add('text-red-300');
                } else if (timeLeft <= 600) { // 10 minutes
                    timerElement.classList.add('text-yellow-300');
                }
                
                timeLeft--;
            };
            
            updateTimer(); // Initial call
            vietqrTimer = setInterval(updateTimer, 1000);
        }

        function startPaymentCheck(orderId) {
            // Simulate checking payment status every 5 seconds
            vietqrCheckTimer = setInterval(() => {
                checkPaymentStatus(orderId);
            }, 5000);
            
            // For demo purposes, simulate successful payment after 30-60 seconds
            const demoPaymentDelay = 30000 + Math.random() * 30000; // 30-60 seconds
            setTimeout(() => {
                if (currentVietQROrder && currentVietQROrder.id === orderId && currentVietQROrder.status === 'pending') {
                    simulateSuccessfulPayment(orderId);
                }
            }, demoPaymentDelay);
        }

        function checkPaymentStatus(orderId) {
            // In real implementation, this would call the webhook/callback API
            // For demo, we'll simulate the check
            
            console.log(`ğŸ” Checking payment status for order: ${orderId}`);
            
            // Simulate API call to check payment
            // In real app: fetch('/api/payments/vietqr/status/' + orderId)
        }

        function simulateSuccessfulPayment(orderId) {
            if (!currentVietQROrder || currentVietQROrder.id !== orderId) return;
            
            // Update order status
            currentVietQROrder.status = 'completed';
            currentVietQROrder.completedAt = new Date().toISOString();
            
            // Update recharge record
            const rechargeIndex = recharges.findIndex(r => r.id === orderId);
            if (rechargeIndex !== -1) {
                recharges[rechargeIndex].status = 'approved';
                recharges[rechargeIndex].approvedAt = new Date().toISOString();
                recharges[rechargeIndex].autoApproved = true;
                recharges[rechargeIndex].paymentMethod = 'vietqr_auto';
            }
            
            // Add money to user balance
            currentUser.balance += currentVietQROrder.amount;
            
            // Update user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].balance = currentUser.balance;
            }
            
            // Save data
            saveUsers();
            saveCurrentUser();
            saveRecharges();
            
            // Log successful payment
            logSecurityEvent('vietqr_payment_success', {
                orderId: orderId,
                userId: currentUser.id,
                amount: currentVietQROrder.amount,
                timestamp: new Date().toISOString()
            });
            
            // Check for large transaction alert
            if (currentVietQROrder.amount >= 5000000) {
                sendLargeTransactionAlert(currentVietQROrder);
            }
            
            // Update UI
            updateUI();
            showPaymentSuccess();
            
            // Stop timers
            clearInterval(vietqrTimer);
            clearInterval(vietqrCheckTimer);
            
            console.log('âœ… VietQR Payment completed:', currentVietQROrder);
        }

        function showPaymentSuccess() {
            // Update status in modal
            document.getElementById('vietqrStatus').innerHTML = `
                <div class="text-green-300 animate-bounce">
                    âœ… Thanh toÃ¡n thÃ nh cÃ´ng!
                </div>
                <div class="text-green-200 text-sm mt-2">
                    Sá»‘ dÆ° Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t: +${formatCurrency(currentVietQROrder.amount)}
                </div>
            `;
            
            // Show success toast
            showToast(`ğŸ‰ Náº¡p tiá»n thÃ nh cÃ´ng! +${formatCurrency(currentVietQROrder.amount)}`, 'success');
            
            // Auto-close modal after 3 seconds
            setTimeout(() => {
                hideVietQRModal();
            }, 3000);
        }

        function expireVietQR() {
            if (currentVietQROrder && currentVietQROrder.status === 'pending') {
                currentVietQROrder.status = 'expired';
                currentVietQROrder.expiredAt = new Date().toISOString();
                
                // Update recharge record
                const rechargeIndex = recharges.findIndex(r => r.id === currentVietQROrder.id);
                if (rechargeIndex !== -1) {
                    recharges[rechargeIndex].status = 'expired';
                    recharges[rechargeIndex].expiredAt = new Date().toISOString();
                }
                
                saveRecharges();
                
                // Update UI
                document.getElementById('vietqrStatus').innerHTML = `
                    <div class="text-red-300">
                        â° MÃ£ QR Ä‘Ã£ háº¿t háº¡n
                    </div>
                    <div class="text-red-200 text-sm mt-2">
                        Vui lÃ²ng táº¡o mÃ£ QR má»›i Ä‘á»ƒ thanh toÃ¡n
                    </div>
                `;
                
                showToast('â° MÃ£ QR Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng táº¡o mÃ£ má»›i.', 'error');
                
                // Stop payment checking
                clearInterval(vietqrCheckTimer);
            }
        }

        function refreshVietQR() {
            if (!currentVietQROrder) return;
            
            // Check if current QR is expired
            const now = new Date();
            const expiresAt = new Date(currentVietQROrder.expiresAt);
            
            if (now >= expiresAt) {
                // Generate new QR with same amount
                hideVietQRModal();
                generateVietQRPayment(currentVietQROrder.amount, currentVietQROrder.note);
            } else {
                // Refresh current QR
                generateQRCode(currentVietQROrder);
                showToast('ğŸ”„ ÄÃ£ lÃ m má»›i mÃ£ QR', 'success');
            }
        }

        function hideVietQRModal() {
            document.getElementById('vietqrModal').classList.add('hidden');
            document.getElementById('vietqrModal').classList.remove('flex');
            
            // Clear timers
            if (vietqrTimer) {
                clearInterval(vietqrTimer);
                vietqrTimer = null;
            }
            
            if (vietqrCheckTimer) {
                clearInterval(vietqrCheckTimer);
                vietqrCheckTimer = null;
            }
            
            // Reset current order
            currentVietQROrder = null;
        }

        function sendLargeTransactionAlert(order) {
            // Simulate sending alert to admin for large transactions (>= 5 million VND)
            const alert = {
                id: Date.now(),
                type: 'LARGE_TRANSACTION',
                orderId: order.id,
                userId: order.userId,
                userEmail: order.userEmail,
                amount: order.amount,
                method: 'VietQR',
                timestamp: new Date().toISOString(),
                acknowledged: false
            };
            
            securityAlerts.push(alert);
            saveIPThrottleData();
            
            // Simulate Slack notification
            console.log('ğŸš¨ Large Transaction Alert:', {
                message: `Large VietQR transaction detected`,
                orderId: order.id,
                user: order.userEmail,
                amount: formatCurrency(order.amount),
                timestamp: new Date().toLocaleString('vi-VN')
            });
            
            // Simulate email notification (would be actual email in production)
            console.log('ğŸ“§ Email Alert Sent to Admin:', {
                subject: `Large Transaction Alert - ${formatCurrency(order.amount)}`,
                body: `User ${order.userEmail} has made a large VietQR transaction of ${formatCurrency(order.amount)}. Order ID: ${order.id}`
            });
        }

        function deleteUser(userId) {
Â  Â  Â  Â  Â  Â  const user = users.find(u => u.id === userId);
Â  Â  Â  Â  Â  Â  if (!user) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (user.id === currentUser.id) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('Báº¡n khÃ´ng thá»ƒ tá»± xÃ³a chÃ­nh mÃ¬nh', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const modal = document.createElement('div');
Â  Â  Â  Â  Â  Â  modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
Â  Â  Â  Â  Â  Â  modal.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold text-white mb-4 text-center">âš ï¸ XÃ¡c nháº­n xÃ³a ngÆ°á»i dÃ¹ng</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-gray-300 mb-6 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a vÄ©nh viá»…n ngÆ°á»i dÃ¹ng nÃ y?</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-white mt-2">${user.name} (${user.email})</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-red-300 text-sm mt-2">HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex space-x-3">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            Há»§y
                        </button>
                        <button onclick="confirmDeleteUser(${userId}); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            XÃ³a vÄ©nh viá»…n
                        </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  document.body.appendChild(modal);
Â  Â  Â  Â  }

Â  Â  Â  Â  function confirmDeleteUser(userId) {
Â  Â  Â  Â  Â  Â  if (userId === currentUser.id) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('KhÃ´ng thá»ƒ tá»± xÃ³a chÃ­nh mÃ¬nh', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const userIndex = users.findIndex(u => u.id === userId);
Â  Â  Â  Â  Â  Â  if (userIndex !== -1) {
Â  Â  Â  Â  Â  Â  Â  Â  const deletedUser = users[userIndex];
Â  Â  Â  Â  Â  Â  Â  Â  users.splice(userIndex, 1);
Â  Â  Â  Â  Â  Â  Â  Â  saveUsers();
Â  Â  Â  Â  Â  Â  Â  Â  loadUsersList();
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`ÄÃ£ xÃ³a vÄ©nh viá»…n ngÆ°á»i dÃ¹ng ${deletedUser.name}`, 'success');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng Ä‘á»ƒ xÃ³a', 'error');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

        // VietQR Admin Functions
        function loadVietQRTab() {
            updateVietQROverview();
            loadVietQRTransactions();
        }

        function updateVietQROverview() {
            const vietqrTransactions = recharges.filter(r => r.method === 'vietqr');
            const completedTransactions = vietqrTransactions.filter(r => r.status === 'approved');
            const pendingTransactions = vietqrTransactions.filter(r => r.status === 'pending');
            
            // Calculate totals
            const totalTransactions = vietqrTransactions.length;
            const totalAmount = completedTransactions.reduce((sum, t) => sum + t.amount, 0);
            const pendingCount = pendingTransactions.length;
            
            // Today's transactions
            const today = new Date().toDateString();
            const todayTransactions = vietqrTransactions.filter(t => 
                new Date(t.createdAt).toDateString() === today
            ).length;
            
            // Update UI
            document.getElementById('vietqrTotalTransactions').textContent = totalTransactions;
            document.getElementById('vietqrTotalAmount').textContent = formatCurrency(totalAmount);
            document.getElementById('vietqrPendingCount').textContent = pendingCount;
            document.getElementById('vietqrTodayCount').textContent = todayTransactions;
        }

        function loadVietQRTransactions(filter = 'all') {
            const container = document.getElementById('vietqrTransactionsList');
            let vietqrTransactions = recharges.filter(r => r.method === 'vietqr');
            
            // Apply filter
            switch(filter) {
                case 'pending':
                    vietqrTransactions = vietqrTransactions.filter(t => t.status === 'pending');
                    break;
                case 'completed':
                    vietqrTransactions = vietqrTransactions.filter(t => t.status === 'approved');
                    break;
                case 'expired':
                    vietqrTransactions = vietqrTransactions.filter(t => t.status === 'expired');
                    break;
                case 'large':
                    vietqrTransactions = vietqrTransactions.filter(t => t.amount >= 5000000);
                    break;
            }
            
            // Sort by creation date (newest first)
            vietqrTransactions.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (vietqrTransactions.length === 0) {
                container.innerHTML = '<div class="text-gray-300 text-center py-8">KhÃ´ng cÃ³ giao dá»‹ch VietQR nÃ o</div>';
                return;
            }
            
            container.innerHTML = vietqrTransactions.map(transaction => `
                <div class="bg-white/5 rounded-lg p-4 border-l-4 ${getTransactionBorderColor(transaction.status)}">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <div class="text-white font-semibold">MÃ£ GD: ${transaction.id}</div>
                                <span class="px-2 py-1 rounded text-xs ${getTransactionStatusClass(transaction.status)}">
                                    ${getTransactionStatusText(transaction.status)}
                                </span>
                                ${transaction.amount >= 5000000 ? '<span class="bg-red-600 text-white px-2 py-1 rounded text-xs">ğŸš¨ GIAO Dá»ŠCH Lá»šN</span>' : ''}
                                ${transaction.autoApproved ? '<span class="bg-green-600 text-white px-2 py-1 rounded text-xs">ğŸ¤– Tá»° Äá»˜NG</span>' : ''}
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <div class="text-gray-400">NgÆ°á»i dÃ¹ng:</div>
                                    <div class="text-white">${transaction.userName}</div>
                                    <div class="text-gray-300 text-xs">${transaction.userEmail}</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Sá»‘ tiá»n:</div>
                                    <div class="text-yellow-300 font-bold text-lg">${formatCurrency(transaction.amount)}</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Thá»i gian:</div>
                                    <div class="text-white">${new Date(transaction.createdAt).toLocaleString('vi-VN')}</div>
                                    ${transaction.approvedAt ? `<div class="text-green-300 text-xs">HoÃ n thÃ nh: ${new Date(transaction.approvedAt).toLocaleString('vi-VN')}</div>` : ''}
                                    ${transaction.expiredAt ? `<div class="text-red-300 text-xs">Háº¿t háº¡n: ${new Date(transaction.expiredAt).toLocaleString('vi-VN')}</div>` : ''}
                                </div>
                            </div>
                            
                            ${transaction.note ? `
                                <div class="mt-3 text-sm">
                                    <span class="text-gray-400">Ghi chÃº:</span>
                                    <span class="text-gray-300">${transaction.note}</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="flex space-x-2">
                            ${transaction.status === 'pending' ? `
                                <button onclick="manualApproveVietQR('${transaction.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    âœ… Duyá»‡t thá»§ cÃ´ng
                                </button>
                                <button onclick="expireVietQRTransaction('${transaction.id}')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                    â° Háº¿t háº¡n
                                </button>
                            ` : ''}
                            <button onclick="viewVietQRDetails('${transaction.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                ğŸ‘ï¸ Chi tiáº¿t
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getTransactionBorderColor(status) {
            const colors = {
                'pending': 'border-yellow-500',
                'approved': 'border-green-500',
                'expired': 'border-red-500',
                'rejected': 'border-gray-500'
            };
            return colors[status] || 'border-gray-500';
        }

        function getTransactionStatusClass(status) {
            const classes = {
                'pending': 'bg-yellow-600 text-white',
                'approved': 'bg-green-600 text-white',
                'expired': 'bg-red-600 text-white',
                'rejected': 'bg-gray-600 text-white'
            };
            return classes[status] || 'bg-gray-600 text-white';
        }

        function getTransactionStatusText(status) {
            const texts = {
                'pending': 'â³ Äang chá»',
                'approved': 'âœ… ThÃ nh cÃ´ng',
                'expired': 'â° Háº¿t háº¡n',
                'rejected': 'âŒ Tá»« chá»‘i'
            };
            return texts[status] || status;
        }

        function filterVietQRTransactions(filter) {
            // Update filter buttons
            document.querySelectorAll('.vietqr-filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-white/20');
            });
            event.target.classList.remove('bg-white/20');
            event.target.classList.add('bg-blue-600');
            
            loadVietQRTransactions(filter);
        }

        function manualApproveVietQR(transactionId) {
            const transaction = recharges.find(r => r.id === transactionId);
            if (!transaction || transaction.status !== 'pending') {
                showToast('KhÃ´ng thá»ƒ duyá»‡t giao dá»‹ch nÃ y', 'error');
                return;
            }
            
            // Create confirmation modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-md w-full mx-4">
                    <h3 class="text-2xl font-bold text-white mb-4 text-center">âœ… XÃ¡c nháº­n duyá»‡t VietQR</h3>
                    <div class="text-gray-300 mb-6">
                        <div class="bg-white/5 rounded-lg p-4 space-y-2">
                            <div class="flex justify-between">
                                <span>MÃ£ GD:</span>
                                <span class="text-white font-mono">${transaction.id}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>NgÆ°á»i dÃ¹ng:</span>
                                <span class="text-white">${transaction.userName}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Sá»‘ tiá»n:</span>
                                <span class="text-yellow-300 font-bold">${formatCurrency(transaction.amount)}</span>
                            </div>
                        </div>
                        <p class="text-yellow-300 text-sm mt-4 text-center">âš ï¸ Sá»‘ dÆ° sáº½ Ä‘Æ°á»£c cá»™ng vÃ o tÃ i khoáº£n ngÆ°á»i dÃ¹ng</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            Há»§y
                        </button>
                        <button onclick="confirmManualApproveVietQR('${transactionId}'); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition-colors">
                            Duyá»‡t ngay
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmManualApproveVietQR(transactionId) {
            const transactionIndex = recharges.findIndex(r => r.id === transactionId);
            if (transactionIndex === -1) return;
            
            const transaction = recharges[transactionIndex];
            
            // Update transaction status
            recharges[transactionIndex].status = 'approved';
            recharges[transactionIndex].approvedAt = new Date().toISOString();
            recharges[transactionIndex].manualApproval = true;
            recharges[transactionIndex].approvedBy = currentUser.email;
            
            // Add money to user balance
            const user = users.find(u => u.id === transaction.userId);
            if (user) {
                user.balance += transaction.amount;
                
                // Update current user if it's the same user
                if (currentUser && currentUser.id === user.id) {
                    currentUser.balance = user.balance;
                    saveCurrentUser();
                    updateUI();
                }
            }
            
            // Save data
            saveUsers();
            saveRecharges();
            
            // Log manual approval
            logSecurityEvent('vietqr_manual_approval', {
                transactionId: transactionId,
                approvedBy: currentUser.email,
                amount: transaction.amount,
                userId: transaction.userId,
                timestamp: new Date().toISOString()
            });
            
            // Refresh displays
            updateVietQROverview();
            loadVietQRTransactions();
            
            showToast(`âœ… ÄÃ£ duyá»‡t thá»§ cÃ´ng giao dá»‹ch ${formatCurrency(transaction.amount)} cho ${transaction.userName}`, 'success');
        }

        function expireVietQRTransaction(transactionId) {
            const transactionIndex = recharges.findIndex(r => r.id === transactionId);
            if (transactionIndex === -1) return;
            
            // Update transaction status
            recharges[transactionIndex].status = 'expired';
            recharges[transactionIndex].expiredAt = new Date().toISOString();
            recharges[transactionIndex].manualExpiry = true;
            recharges[transactionIndex].expiredBy = currentUser.email;
            
            saveRecharges();
            
            // Refresh displays
            updateVietQROverview();
            loadVietQRTransactions();
            
            showToast('â° ÄÃ£ Ä‘Ã¡nh dáº¥u giao dá»‹ch háº¿t háº¡n', 'success');
        }

        function viewVietQRDetails(transactionId) {
            const transaction = recharges.find(r => r.id === transactionId);
            if (!transaction) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-start mb-6">
                        <h3 class="text-2xl font-bold text-white">ğŸ¦ Chi tiáº¿t giao dá»‹ch VietQR</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
                    </div>
                    
                    <div class="space-y-6">
                        <!-- Transaction Info -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3">ğŸ“‹ ThÃ´ng tin giao dá»‹ch</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">MÃ£ giao dá»‹ch:</span>
                                    <div class="text-white font-mono">${transaction.id}</div>
                                </div>
                                <div>
                                    <span class="text-gray-400">Tráº¡ng thÃ¡i:</span>
                                    <div class="text-white">
                                        <span class="px-2 py-1 rounded text-xs ${getTransactionStatusClass(transaction.status)}">
                                            ${getTransactionStatusText(transaction.status)}
                                        </span>
                                    </div>
                                </div>
                                <div>
                                    <span class="text-gray-400">Sá»‘ tiá»n:</span>
                                    <div class="text-yellow-300 font-bold text-lg">${formatCurrency(transaction.amount)}</div>
                                </div>
                                <div>
                                    <span class="text-gray-400">PhÆ°Æ¡ng thá»©c:</span>
                                    <div class="text-white">VietQR - Vietcombank</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- User Info -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3">ğŸ‘¤ ThÃ´ng tin ngÆ°á»i dÃ¹ng</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">TÃªn:</span>
                                    <div class="text-white">${transaction.userName}</div>
                                </div>
                                <div>
                                    <span class="text-gray-400">Email:</span>
                                    <div class="text-white">${transaction.userEmail}</div>
                                </div>
                                <div>
                                    <span class="text-gray-400">User ID:</span>
                                    <div class="text-white font-mono">${transaction.userId}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timeline -->
                        <div class="bg-white/5 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3">â° Lá»‹ch sá»­ giao dá»‹ch</h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                    <div>
                                        <div class="text-white">Táº¡o giao dá»‹ch</div>
                                        <div class="text-gray-400">${new Date(transaction.createdAt).toLocaleString('vi-VN')}</div>
                                    </div>
                                </div>
                                
                                ${transaction.approvedAt ? `
                                    <div class="flex items-center space-x-3">
                                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                        <div>
                                            <div class="text-green-300">
                                                Duyá»‡t thÃ nh cÃ´ng 
                                                ${transaction.autoApproved ? '(Tá»± Ä‘á»™ng)' : '(Thá»§ cÃ´ng)'}
                                                ${transaction.approvedBy ? `bá»Ÿi ${transaction.approvedBy}` : ''}
                                            </div>
                                            <div class="text-gray-400">${new Date(transaction.approvedAt).toLocaleString('vi-VN')}</div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${transaction.expiredAt ? `
                                    <div class="flex items-center space-x-3">
                                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                        <div>
                                            <div class="text-red-300">
                                                Háº¿t háº¡n 
                                                ${transaction.manualExpiry ? '(Thá»§ cÃ´ng)' : '(Tá»± Ä‘á»™ng)'}
                                                ${transaction.expiredBy ? `bá»Ÿi ${transaction.expiredBy}` : ''}
                                            </div>
                                            <div class="text-gray-400">${new Date(transaction.expiredAt).toLocaleString('vi-VN')}</div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        ${transaction.note ? `
                            <div class="bg-white/5 rounded-lg p-4">
                                <h4 class="text-white font-semibold mb-3">ğŸ“ Ghi chÃº</h4>
                                <div class="text-gray-300">${transaction.note}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="mt-6 flex justify-center">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                            ÄÃ³ng
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveVietQRSettings() {
            // In a real application, this would save settings to the server
            showToast('ğŸ’¾ CÃ i Ä‘áº·t VietQR Ä‘Ã£ Ä‘Æ°á»£c lÆ°u', 'success');
        }

        // Auto-save user activity and security monitoring
        setInterval(() => {
            if (currentUser) {
                validateSession();
                checkAccountSecurity();
                updateMessageCount();
                
                // Update security overview if admin is viewing security tab
                if (currentUser.role === 'admin' && document.getElementById('adminSecurity') && !document.getElementById('adminSecurity').classList.contains('hidden')) {
                    updateSecurityOverview();
                }
            }
            
            // Clean expired throttle data periodically
            cleanExpiredThrottleData();
        }, 60000); // Check every minute

        // Initialize the app when page loads
        showPage('home');
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9956e7e92063f847',t:'MTc2MTYxNzUyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>